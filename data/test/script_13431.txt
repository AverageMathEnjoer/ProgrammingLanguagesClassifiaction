b'package lyons.dao;\n\nimport java.io.IOException;\nimport java.io.PrintWriter;\nimport java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.HttpSession;\n\nimport com.sun.rowset.CachedRowSetImpl;\n\nimport lyons.db.DbClose;\nimport lyons.db.DbConn;\nimport lyons.entity.Goods;\nimport lyons.entity.Login;\n\npublic class GoodsDao extends HttpServlet\n{\n\t/**\n     * serialVersionUID\n     */\n    private static final long serialVersionUID = 135785434567L;\n \n\t/**\n\t * Constructor of the object.\n\t */\n\tpublic GoodsDao()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * Destruction of the servlet. <br>\n\t */\n\tpublic void destroy()\n\t{\n\t\tsuper.destroy(); // Just puts "destroy" string in log\n\t\t// Put your code here\n\t}\n\n\tpublic void doGet(HttpServletRequest request, HttpServletResponse response)\n\t\t\tthrows ServletException, IOException\n\t{\n\t\tdoPost(request, response);\n\t}\n\n\tpublic void doPost(HttpServletRequest request, HttpServletResponse response)\n\t\t\tthrows ServletException, IOException\n\t{\n\n\t\tresponse.setContentType("text/html;chartset=UTF-8");\n\t\trequest.setCharacterEncoding("UTF-8");\n\t\tString value = "";\n\t\tvalue = request.getParameter("key");\n\t\tint key = Integer.parseInt(value);\n\t\tSystem.out.println("\xbc\xec\xb2\xe2\xca\xc7\xb7\xf1\xd3\xd0key:"+key);\n\t\t\n\t\tString keyWord = "";\n\t\tkeyWord = request.getParameter("keyWord");\n\t\tSystem.out.println(keyWord);\n\t\tqueryGoods(request, response, key,keyWord);\n\t}\n\n\tpublic void init() throws ServletException\n\t{\n\t\t// Put your code here\n\t}\n\t\n\t/**\n\t * \xc9\xcc\xc6\xb7\xb2\xe9\xd1\xaf\n\t * @param request\n\t * @param response\n\t * @param key \xb2\xe9\xd1\xaf\xb5\xc4\xcc\xf5\xbc\xfe/int:4(\xbc\xf2\xb5\xa5\xb2\xe9\xd1\xaf)\n\t * @return \xc9\xcc\xc6\xb7\xd0\xc5\xcf\xa2\xca\xfd\xd7\xe9\n\t * @throws ServletException\n\t * @throws IOException\n\t */\n\tpublic void queryGoods(HttpServletRequest request, HttpServletResponse response,int key,String keyWord)\n\t\t\tthrows ServletException, IOException\n\t{\n\t    response.setContentType("text/html;charset=UTF-8");\n        PrintWriter out = response.getWriter();\n        CachedRowSetImpl rowSet = null;//\xd0\xd0\xbc\xaf\xb6\xd4\xcf\xf3\n\t\tConnection conn = null;\n\t\tPreparedStatement pstmt = null;\n\t\tResultSet rs = null;\n\t\tGoods goods = null;\n\t\tLogin username = null;\n//\t\tOrderForm orderForm = null;\n\t\t\n\t\tHttpSession session = request.getSession(true);\n\t\tusername = (Login)session.getAttribute("loginBean");\n\t\tgoods = (Goods)session.getAttribute("goods");\n//\t\torderForm = (OrderForm)session.getAttribute("orderForm");\n//\t\tArrayList<Goods> goodsList = new ArrayList<Goods>();\n\t\tif (goods==null)\n\t\t{\n\t\t\tgoods = new Goods();\n\t\t\tsession.setAttribute("goods", goods);\n\t\t}\n\t\tif (username==null)\n\t\t{\n\t\t    username = new Login();\n\t\t    session.setAttribute("username", username);\n\t\t}\n//\t\tif (orderForm==null)\n//\t\t{\n//\t\t    orderForm = new OrderForm();\n//\t\t    session.setAttribute("orderForm", orderForm);\n//\t\t}\n\t\t  //\xc5\xd0\xb6\xcf\xd3\xc3\xbb\xa7\xca\xc7\xb7\xf1\xb5\xc7\xc2\xbd\n\t\t  String user = "";\n          user = username.getUsername();//\xb5\xc7\xc2\xbd\xd5\xdf\xb5\xc4\xd3\xc3\xbb\xa7\xc3\xfb\n          System.out.println("\xce\xd2\xca\xc7\xd3\xc3\xbb\xa7\xa3\xba"+user);\n          if (user.equals("userNull"))\n          {\n              out.print("<br>");\n              out.print("<center><font color=#008B8B> \xb5\xc7\xc2\xbd\xd6\xae\xba\xf3\xb2\xc5\xc4\xdc\xbf\xb4\xb6\xa9\xb5\xa5\xc5\xb6  </font>");\n              out.print("<a href=/lyons.eaby/jsp/join/login.jsp><font color=red size=6>\xb5\xc7\xc2\xbd</font></a></center>");\n              return;\n          }\n\t\t\n\t\tconn = DbConn.getConn();\t\n\n\t\tswitch (key)\n\t\t{\n\t\t\tcase 1:\n\t\t\t\t\t/*//\tkey=1\xc9\xcc\xc6\xb7 \xca\xfd\xc1\xbf \xc9\xfd\xd0\xf2\xb2\xe9\xd1\xaf\n\t\t\t\t\tString sqlGnum = "SELECT * FROM GOODS ORDER BY GNUM ASC";\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tpstmt = conn.prepareStatement(sqlGnum);\n\t\t\t\t\t\trs = pstmt.executeQuery();\n\t\t\t\t\t\twhile (rs.next())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (SQLException e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.printStackTrace();\n\t\t\t\t\t}finally\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tDbClose.allClose(pstmt, rs, conn);\n\t\t\t\t\t\t\t}*/\n\t\t\t\tbreak;\n\t\t\tcase 2:\n        \t\t\t  //key=2 \xb0\xb4\xd5\xd5\xb9\xd8\xbc\xfc\xd7\xd6\xb2\xe9\xd1\xaf \xc9\xcc\xc6\xb7\xd0\xc5\xcf\xa2\n                      \n                        String sqlShowGoodsByKey =  \n                        "select * from commodity WHERE commodity_name LIKE \'%\'||?||\'%\'";\n                        try\n                        {\n                            pstmt = conn.prepareStatement(sqlShowGoodsByKey);\n                            pstmt.setString(1, keyWord);\n                            rs = pstmt.executeQuery();\n                            System.out.println("--2\xb2\xe9\xbf\xb4\xb6\xa9\xb5\xa5\xd6\xb4\xd0\xd0\xca\xfd\xbe\xdd\xbf\xe2\xb2\xd9\xd7\xf7--");\n                            if(rs.next())\n                            {\n                                rs = pstmt.executeQuery();//\xd6\xd8\xd0\xc2\xb2\xe9\xd1\xaf\xb5\xc4\xd4\xad\xd2\xf2\xca\xc7rs.next\xca\xb1\xb9\xe2\xb1\xea\xc6\xab\xd2\xc6\xba\xf3\xa3\xac\xb6\xaa\xb5\xf4\xbc\xc7\xc2\xbc\xa1\xa3\n                                rowSet = new CachedRowSetImpl();\n                                rowSet.populate(rs); \n                                goods.setRowSet(rowSet);\n                                System.out.println("2\xd2\xd1\xbe\xad\xb4\xd3\xca\xfd\xbe\xdd\xbf\xe2\xd6\xd0\xbb\xf1\xc8\xa1\xb5\xbd\xd6\xb5\xa3\xac\xb2\xa2\xc8\xfb\xbd\xf8\xd0\xd0\xbc\xaf");\n                                request.getRequestDispatcher("/jsp/browse/showGoods.jsp").forward(request, response);\n                            }else \n                                {\n                                    out.print("<br><br><br><center>");\n                                    out.print("<font color=green> \xc7\xd7,\xb2\xe9\xd1\xaf\xb3\xf6\xb4\xed\xc0\xb2.\xb8\xfc\xbb\xbb\xb9\xd8\xbc\xfc\xd7\xd6\xd4\xd9\xb4\xce </font>");\n                                    out.print("<a href=/lyons.eaby/jsp/browse/searchByKeyWord.jsp><font color=red size=6>\xb2\xe9\xd1\xaf</font></a>");\n                                    out.print("</center>");     \n                                }\n                        } catch (SQLException e)\n                        {\n                            System.out.println("key=3\xb2\xe9\xbf\xb4\xb6\xa9\xb5\xa5\xd2\xec\xb3\xa3\xa3\xba"+e);\n                            \n                        }finally\n                                {\n                                    System.out.println("\xb2\xe9\xbf\xb4\xb6\xa9\xb5\xa5\xd6\xb4\xd0\xd0\xb9\xd8\xb1\xd5\xc1\xf7");\n                                    DbClose.allClose(pstmt, rs, conn);\n                                }\n        \t\t\t\tbreak;\n\t\t\tcase 3:\n                    //key=3 \xb0\xb4\xd5\xd5\xb5\xc7\xc2\xbc\xc8\xcb\xb2\xe9\xd1\xaf\xb6\xa9\xb5\xa5 \xc9\xcc\xc6\xb7\xc3\xfb\xd7\xd6+\xca\xfd\xc1\xbf\n\t\t\t      \n                    String sqlOrder= \n                    "select commodity_name,sum(sum) from orderform where username=? group by commodity_name having sum(sum)>0";\n                    try\n                    {\n                        pstmt = conn.prepareStatement(sqlOrder);\n                        pstmt.setString(1, user);\n                        rs = pstmt.executeQuery();\n                        System.out.println("--\xb2\xe9\xbf\xb4\xb6\xa9\xb5\xa5\xd6\xb4\xd0\xd0\xca\xfd\xbe\xdd\xbf\xe2\xb2\xd9\xd7\xf7--");\n                        if(rs.next())\n                        {\n                            rs = pstmt.executeQuery();//\xd6\xd8\xd0\xc2\xb2\xe9\xd1\xaf\xb5\xc4\xd4\xad\xd2\xf2\xca\xc7rs.next\xca\xb1\xb9\xe2\xb1\xea\xc6\xab\xd2\xc6\xba\xf3\xa3\xac\xb6\xaa\xb5\xf4\xbc\xc7\xc2\xbc\xa1\xa3\n                            rowSet = new CachedRowSetImpl();\n                            rowSet.populate(rs); \n                            goods.setRowSet(rowSet);\n                            System.out.println("3\xd2\xd1\xbe\xad\xb4\xd3\xca\xfd\xbe\xdd\xbf\xe2\xd6\xd0\xbb\xf1\xc8\xa1\xb5\xbd\xd6\xb5\xa3\xac\xb2\xa2\xc8\xfb\xbd\xf8\xd0\xd0\xbc\xaf");\n                            request.getRequestDispatcher("/jsp/order/lookOrderForm.jsp").forward(request, response);\n                        }else \n                            {\n                                out.print("<br><br><br><center>");\n                                out.print("<font color=green> \xc7\xd7,\xb6\xa9\xb5\xa5\xca\xc7\xbf\xd5\xb5\xc4\xc4\xd8 </font>");\n                                out.print("<a href=/lyons.eaby/lyons.dao/GoodsDao?key=4><font color=red size=6>Go Shopping</font></a>");\n                                out.print("</center>");\t\t\n                            }\n                    } catch (SQLException e)\n                    {\n                        System.out.println("key=3\xb2\xe9\xbf\xb4\xb6\xa9\xb5\xa5\xd2\xec\xb3\xa3\xa3\xba"+e);\n                        \n                    }finally\n                            {\n                                System.out.println("\xb2\xe9\xbf\xb4\xb6\xa9\xb5\xa5\xd6\xb4\xd0\xd0\xb9\xd8\xb1\xd5\xc1\xf7");\n                                DbClose.allClose(pstmt, rs, conn);\n                            }\n                    break;\n\t\t\tcase 4:\n\t\t\t        StringBuffer url = request.getRequestURL();\n\t\t\t        System.out.println("4324234=========="+url.toString());\n\t\t\t\t\t//key=4 \xe4\xaf\xc0\xc0\xc9\xcc\xc6\xb7\n\t\t\t\t\tString sqlList= "select * from commodity";\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tpstmt = conn.prepareStatement(sqlList);\n\t\t\t\t\t\trs = pstmt.executeQuery();\n\t\t\t\t\t\tSystem.out.println("--4\xe4\xaf\xc0\xc0\xc9\xcc\xc6\xb7\xd6\xb4\xd0\xd0\xca\xfd\xbe\xdd\xbf\xe2\xb2\xd9\xd7\xf7--");\n\t\t\t\t\t\tif(rs.next())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    rs = pstmt.executeQuery();//\xd6\xd8\xd0\xc2\xb2\xe9\xd1\xaf\xb5\xc4\xd4\xad\xd2\xf2\xca\xc7rs.next\xca\xb1\xb9\xe2\xb1\xea\xc6\xab\xd2\xc6\xba\xf3\xa3\xac\xb6\xaa\xb5\xf4\xbc\xc7\xc2\xbc\xa1\xa3\n\t\t\t\t\t\t\trowSet = new CachedRowSetImpl();\n\t\t\t\t\t\t\trowSet.populate(rs);\n\t\t\t\t\t\t\tgoods.setRowSet(rowSet);\n\t\t\t\t\t\t\tSystem.out.println("4\xe4\xaf\xc0\xc0\xc9\xcc\xc6\xb7\xd2\xd1\xbe\xad\xb4\xd3\xca\xfd\xbe\xdd\xbf\xe2\xd6\xd0\xbb\xf1\xc8\xa1\xb5\xbd\xd6\xb5\xa3\xac\xb2\xa2\xc8\xfb\xbd\xf8\xd0\xd0\xbc\xaf");\n\t\t\t\t\t\t\trequest.getRequestDispatcher("/jsp/browse/showGoods.jsp").forward(request, response);\n\t\t\t\t\t\t}else \n                        {\n                                out.print("<br><br><br><center>");\n                                out.print("<font color=green> \xc7\xd7,\xc2\xf4\xbc\xd2\xbb\xb9\xc3\xbb\xc9\xcf\xbb\xf5\xc4\xd8 </font>");\n                                out.print("<a href=/lyons.eaby/lyons.dao/GoodsDao?key=4><font color=red size=6>\xbd\xf8\xc8\xeb\xca\xd7\xd2\xb3</font></a>");\n                                out.print("</center>");     \n                            }\n\t\t\t\t\t} catch (SQLException e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.printStackTrace();\n\t\t\t\t\t\tresponse.sendRedirect("/lyons.eaby/jsp/browse/showGoods.jsp");\n\t\t\t\t\t}finally\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tDbClose.allClose(pstmt, rs, conn);\n\t\t\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n}'