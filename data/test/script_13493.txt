b'package com.codeest.geeknews.component;\n\nimport android.app.DownloadManager;\nimport android.app.Service;\nimport android.content.BroadcastReceiver;\nimport android.content.Context;\nimport android.content.Intent;\nimport android.content.IntentFilter;\nimport android.net.Uri;\nimport android.os.Build;\nimport android.os.Environment;\nimport android.os.IBinder;\nimport android.support.annotation.Nullable;\n\nimport com.codeest.geeknews.model.http.api.MyApis;\nimport com.codeest.geeknews.util.ToastUtil;\n\nimport java.io.File;\n\n/**\n * Created by codeest on 16/10/10.\n */\n\npublic class UpdateService extends Service {\n    private BroadcastReceiver receiver;\n\n    @Nullable\n    @Override\n    public IBinder onBind(Intent intent) {\n        return null;\n    }\n\n    @Override\n    public int onStartCommand(Intent intent, int flags, int startId) {\n        receiver = new BroadcastReceiver() {\n            @Override\n            public void onReceive(Context context, Intent intent) {\n                unregisterReceiver(receiver);\n                intent = new Intent(Intent.ACTION_VIEW);\n                intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n                intent.setDataAndType(Uri.fromFile(new File(Environment.getExternalStorageDirectory() + "/download/geeknews.apk")),\n                        "application/vnd.android.package-archive");\n                startActivity(intent);\n                stopSelf();\n            }\n        };\n        registerReceiver(receiver, new IntentFilter(DownloadManager.ACTION_DOWNLOAD_COMPLETE));\n        startDownload();\n        return Service.START_STICKY;\n    }\n\n    private void startDownload() {\n        DownloadManager dm = (DownloadManager) getSystemService(DOWNLOAD_SERVICE);\n        DownloadManager.Request request = new DownloadManager.Request(\n                Uri.parse(MyApis.APK_DOWNLOAD_URL));\n        request.setTitle("GeekNews");\n        request.setDescription("\xe6\x96\xb0\xe7\x89\x88\xe6\x9c\xac\xe4\xb8\x8b\xe8\xbd\xbd\xe4\xb8\xad");\n        request.setMimeType("application/vnd.android.package-archive");\n        request.setDestinationInExternalPublicDir(Environment.DIRECTORY_DOWNLOADS, "geeknews.apk");\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.HONEYCOMB) {\n            request.allowScanningByMediaScanner();\n            request.setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE_NOTIFY_COMPLETED);\n        }\n        dm.enqueue(request);\n        ToastUtil.shortShow("\xe5\x90\x8e\xe5\x8f\xb0\xe4\xb8\x8b\xe8\xbd\xbd\xe4\xb8\xad\xef\xbc\x8c\xe8\xaf\xb7\xe7\xa8\x8d\xe5\x80\x99...");\n    }\n}\n'