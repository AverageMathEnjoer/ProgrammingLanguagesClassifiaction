b'{-# LANGUAGE DeriveGeneric #-}\n{-# LANGUAGE OverloadedStrings #-}\n{-# LANGUAGE QuasiQuotes #-}\n{-# LANGUAGE RecordWildCards #-}\n{-# LANGUAGE TypeFamilies #-}\n\n-- | [ZOHO oauth overview](https://www.zoho.com/crm/developer/docs/api/v2/oauth-overview.html)\nmodule Network.OAuth2.Provider.ZOHO where\n\nimport Data.Aeson\nimport Data.Map.Strict qualified as Map\nimport Data.Set qualified as Set\nimport Data.Text.Lazy (Text)\nimport GHC.Generics\nimport Network.OAuth.OAuth2\nimport Network.OAuth2.Experiment\nimport URI.ByteString.QQ\n\ndata ZOHO = ZOHO deriving (Eq, Show)\n\ntype instance IdpUserInfo ZOHO = ZOHOUserResp\n\ndefaultZohoApp :: IdpApplication \'AuthorizationCode ZOHO\ndefaultZohoApp =\n  AuthorizationCodeIdpApplication\n    { idpAppClientId = ""\n    , idpAppClientSecret = ""\n    , idpAppScope = Set.fromList ["ZohoCRM.users.READ"]\n    , idpAppAuthorizeExtraParams = Map.fromList [("access_type", "offline"), ("prompt", "consent")]\n    , idpAppAuthorizeState = "CHANGE_ME"\n    , idpAppRedirectUri = [uri|http://localhost/oauth2/callback|]\n    , idpAppName = "default-zoho-App"\n    , idpAppTokenRequestAuthenticationMethod = ClientSecretBasic\n    , idp = defaultZohoIdp\n    }\n\ndefaultZohoIdp :: Idp ZOHO\ndefaultZohoIdp =\n  Idp\n    { idpFetchUserInfo = authGetJSON @(IdpUserInfo ZOHO)\n    , idpUserInfoEndpoint = [uri|https://www.zohoapis.com/crm/v2/users|]\n    , idpAuthorizeEndpoint = [uri|https://accounts.zoho.com/oauth/v2/auth|]\n    , idpTokenEndpoint = [uri|https://accounts.zoho.com/oauth/v2/token|]\n    }\n\n-- `oauth/user/info` url does not work and find answer from\n-- https://help.zoho.com/portal/community/topic/oauth2-api-better-document-oauth-user-info\ndata ZOHOUser = ZOHOUser\n  { email :: Text\n  , fullName :: Text\n  }\n  deriving (Show, Generic)\n\nnewtype ZOHOUserResp = ZOHOUserResp {users :: [ZOHOUser]}\n  deriving (Show, Generic)\n\ninstance FromJSON ZOHOUserResp\n\ninstance FromJSON ZOHOUser where\n  parseJSON = genericParseJSON defaultOptions {fieldLabelModifier = camelTo2 \'_\'}\n'