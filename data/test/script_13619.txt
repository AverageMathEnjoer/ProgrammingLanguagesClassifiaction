b'{-# LANGUAGE QuasiQuotes #-}\n\n-- | [AzureAD oauth2 flow](https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow)\nmodule Network.OAuth2.Provider.AzureAD where\n\nimport Data.Aeson\nimport Data.Map.Strict qualified as Map\nimport Data.Set qualified as Set\nimport Data.Text.Lazy (Text)\nimport GHC.Generics\nimport Network.OAuth.OAuth2\nimport Network.OAuth2.Experiment\nimport URI.ByteString.QQ\n\ndata AzureAD = AzureAD deriving (Eq, Show)\n\ntype instance IdpUserInfo AzureAD = AzureADUser\n\n-- create app at https://go.microsoft.com/fwlink/?linkid=2083908\n--\n-- also be aware to find the right client id.\n-- see https://stackoverflow.com/a/70670961\ndefaultAzureADApp :: IdpApplication \'AuthorizationCode AzureAD\ndefaultAzureADApp =\n  AuthorizationCodeIdpApplication\n    { idpAppClientId = ""\n    , idpAppClientSecret = ""\n    , idpAppScope = Set.fromList ["openid", "profile", "email"]\n    , idpAppAuthorizeState = "CHANGE_ME"\n    , idpAppAuthorizeExtraParams = Map.empty\n    , idpAppRedirectUri = [uri|http://localhost|]\n    , idpAppName = "default-azure-app"\n    , idpAppTokenRequestAuthenticationMethod = ClientSecretBasic\n    , idp = defaultAzureADIdp\n    }\n\n-- | https://login.microsoftonline.com/common/v2.0/.well-known/openid-configuration\ndefaultAzureADIdp :: Idp AzureAD\ndefaultAzureADIdp =\n  Idp\n    { idpFetchUserInfo = authGetJSON @(IdpUserInfo AzureAD)\n    , idpUserInfoEndpoint = [uri|https://graph.microsoft.com/oidc/userinfo|]\n    , idpAuthorizeEndpoint = [uri|https://login.microsoftonline.com/common/oauth2/v2.0/authorize|]\n    , idpTokenEndpoint = [uri|https://login.microsoftonline.com/common/oauth2/v2.0/token|]\n    }\n\n-- | https://learn.microsoft.com/en-us/azure/active-directory/develop/userinfo\ndata AzureADUser = AzureADUser\n  { sub :: Text\n  , email :: Text\n  , familyName :: Text\n  , givenName :: Text\n  , name :: Text\n  }\n  deriving (Show, Generic)\n\ninstance FromJSON AzureADUser where\n  parseJSON = genericParseJSON defaultOptions {fieldLabelModifier = camelTo2 \'_\'}\n'