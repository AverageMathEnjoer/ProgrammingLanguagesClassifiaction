b'\xef\xbb\xbfusing System;\nusing System.Collections.Generic;\nusing System.IO;\nusing System.Linq;\nusing System.Net;\nusing System.Text;\nusing System.Threading;\nusing System.Threading.Tasks;\n\nnamespace Test.Download\n{\n    class DownloadThread\n    {\n        public int ID { get; set; }\n        /// <summary>\n        /// \xe4\xb8\x8b\xe8\xbd\xbd\xe9\x93\xbe\xe6\x8e\xa5\n        /// </summary>\n        public string DownloadUrl { get; set; }\n        /// <summary>\n        /// \xe4\xb8\x8b\xe8\xbd\xbd\xe8\xb7\xaf\xe5\xbe\x84\n        /// </summary>\n        public string Path { get; set; }\n        /// <summary>\n        /// \xe4\xb8\x8b\xe8\xbd\xbd\xe5\x9d\x97\xe4\xbf\xa1\xe6\x81\xaf\n        /// </summary>\n        public DownloadBlock Block { get; set; }\n        /// <summary>\n        /// \xe4\xb8\x8b\xe8\xbd\xbd\xe4\xbf\xa1\xe6\x81\xaf\n        /// </summary>\n        public DownloadInfo Info { get; set; }\n\n        public DownloadThread()\n        {\n            WorkThread=new Thread(Start);\n            WorkThread.Start();\n        }\n\n        Thread WorkThread;\n        HttpWebRequest Request;\n\n        public void Start()\n        {\n            try\n            {\n                if (Block.Completed)\n                {\n                    return;\n                }\n                Thread.Sleep(1000);\n                Request = WebRequest.Create(DownloadUrl) as HttpWebRequest;\n                Request.AddRange(Block.From,Block.To);\n                HttpWebResponse Response = Request.GetResponse() as HttpWebResponse;\n                if (!File.Exists(Path))\n                {\n                    Console.WriteLine("\xe5\x87\xba\xe7\x8e\xb0\xe9\x94\x99\xe8\xaf\xaf: \xe6\x9c\xac\xe5\x9c\xb0\xe6\x95\xb0\xe6\x8d\xae\xe6\x96\x87\xe4\xbb\xb6\xe4\xb8\x8d\xe5\xad\x98\xe5\x9c\xa8");\n                    return;\n                }\n                using (Stream ResponseStream = Response.GetResponseStream())\n                {\n                    using (FileStream Stream=new FileStream(Path,FileMode.Open, FileAccess.ReadWrite, FileShare.ReadWrite))\n                    {\n                        Stream.Seek(Block.From, SeekOrigin.Begin);\n                        byte[] Array = new byte[1024];\n                        int i = ResponseStream.Read(Array, 0, Array.Length);\n                        while (i > 0)\n                        {\n                            Stream.Write(Array, 0, i);\n                            Block.From += i;\n                            Block.CompletedLength += i;\n                            Info.CompletedLength += i;\n                            Info.DownloadBlockList[ID] = Block;\n                            i = ResponseStream.Read(Array, 0, Array.Length);\n                        }\n                        Block.Completed = true;\n                    }\n                }\n            }\n            catch(Exception ex)\n            {\n                if(ex is ThreadAbortException)\n                {\n                    return;\n                }\n                if(ex.Message.Contains("\xe7\xbb\x88\xe6\xad\xa2") || ex.Message.Contains("\xe5\x8f\x96\xe6\xb6\x88"))\n                {\n                    return;\n                }\n                Console.WriteLine("\xe5\x87\xba\xe7\x8e\xb0\xe9\x94\x99\xe8\xaf\xaf: "+ex.ToString());\n            }\n        }\n        /// <summary>\n        /// \xe5\x81\x9c\xe6\xad\xa2\n        /// </summary>\n        public void Stop()\n        {\n            WorkThread.Abort();\n            Request?.Abort();\n        }\n    }\n}\n'