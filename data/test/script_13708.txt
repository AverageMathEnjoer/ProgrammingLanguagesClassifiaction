b'package lyons.order.action;\n\nimport java.io.IOException;\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.HttpSession;\n\n\nimport lyons.order.entity.Order;\nimport lyons.order.service.OrderServiceImpl;\nimport lyons.user.service.UserService;\n\n@SuppressWarnings("serial")\npublic class OrderAction extends HttpServlet\n{\n    int keys = -1;                     //\xc4\xac\xc8\xcf\xb5\xc4\xb2\xe9\xd1\xaf\xd6\xb5\xa3\xa8\xbc\xb4\xa3\xbadefault \xa3\xa9\n    String user;                       //\xb5\xb1\xc7\xb0\xd3\xc3\xbb\xa7\n    String key;                        //\xd1\xa1\xd4\xf1\xb2\xe9\xd1\xaf\xcc\xf5\xbc\xfe\n    String keyWord;                    //\xb2\xe9\xd1\xaf\xb5\xc4\xb9\xd8\xbc\xfc\xd7\xd6\n    String queryUserName;              //\xb2\xe9\xd1\xaf\xb5\xc4\xd3\xc3\xbb\xa7\xc3\xfb\n    String id;                         //\xc9\xcc\xc6\xb7\xce\xa8\xd2\xbb\xb1\xea\xca\xb6id \n    String ids[];                      //\xc5\xfa\xc1\xbf\xc9\xbe\xb3\xfd\xc9\xcc\xc6\xb7\xb5\xc4ids\n    List<Order> orderList = new ArrayList<Order>();\n    OrderServiceImpl orderService = new OrderServiceImpl();//\xbb\xf1\xc8\xa1\xb6\xa9\xb5\xa5\xb7\xfe\xce\xf1\xb6\xd4\xcf\xf3\n    \n    public void doGet(HttpServletRequest request, HttpServletResponse response)\n        throws ServletException, IOException\n    {\n        this.doPost(request, response);\n    }\n    \n    public void doPost(HttpServletRequest request, HttpServletResponse response)\n    throws ServletException, IOException\n    {\n        response.setContentType("text/html;charset=UTF-8");\n        request.setCharacterEncoding("UTF-8");\n        //\xc5\xd0\xb6\xcf\xca\xc7\xb7\xf1\xb5\xc7\xc2\xbd\n        user = (new UserService()).isLogin(request, response).trim();\n        if ( "".equals(user) || user == null ){return;}\n        \n        /**\n         *    jsp\xb4\xab\xc0\xb4\xb5\xc4key\xb2\xce\xca\xfd\xcb\xb5\xc3\xf7\n         *      \n         * 1\xa3\xba\xb2\xe9\xd1\xaf\xb5\xb1\xc7\xb0\xd3\xc3\xbb\xa7\xcb\xf9\xd3\xd0\xb6\xa9\xb5\xa5\xc1\xd0\xb1\xed\n         * 2\xa3\xba\xb2\xe9\xd1\xaf\xcb\xf9\xd3\xd0\xd3\xc3\xbb\xa7\xb6\xa9\xb5\xa5\xc1\xd0\xb1\xed\n         * 3\xa3\xba\xb0\xb4\xd5\xd5\xcc\xf5\xbc\xfe\xb2\xe9\xd1\xaf\xb6\xa9\xb5\xa5 \xd3\xc3\xbb\xa7\xc3\xfb+\xc9\xcc\xc6\xb7\xb9\xd8\xbc\xfc\xd7\xd6\n         * \n         * 4\xa3\xba\xc9\xbe\xb3\xfd\xb5\xa5\xb8\xf6\xb6\xa9\xb5\xa5\n         * 5\xa3\xba\xc5\xfa\xc1\xbf\xc9\xbe\xb3\xfd\xb6\xa9\xb5\xa5\n         * 6\xa3\xba\n         */\n        key = request.getParameter("key").trim();\n        System.out.println(key+"---------");\n        if (key.matches("[1-3]"))\n        {\n            keyWord = request.getParameter("keyWord");\n            queryUserName = request.getParameter("queryUserName");\n            String str[] = {key,keyWord,queryUserName,user};\n            queryCondition(str,request,response);//key \xb4\xfa\xb1\xed\xb2\xe9\xd1\xaf\xcc\xf5\xbc\xfe\xa3\xackeyWord\xb4\xfa\xb1\xed\xd2\xaa\xb2\xe9\xd1\xaf\xb5\xc4\xb9\xd8\xbc\xfc\xd7\xd6\n            \n        }else if (key.matches("[4-5]")) {\n            \n            id = request.getParameter("id");        \n            ids = request.getParameterValues("deleteId");\n            String str[] = {key,id};\n            deleteCondition(str,ids,request,response);\n        }\n        \n    }\n    /**\n     * \n     * \xb8\xf9\xbe\xdd\xcc\xf5\xbc\xfe\xd1\xa1\xd4\xf1\xb2\xe9\xd1\xaf\xb5\xc4\xd2\xb5\xce\xf1\n     * @param str\n     * @param request\n     * @param response\n     * @throws IOException\n     * @throws ServletException\n     */\n    public void queryCondition(String str[],HttpServletRequest request, HttpServletResponse response) \n         throws IOException, ServletException\n    {\n        response.setContentType("text/html;charset=UTF-8");\n        HttpSession session = request.getSession(true);\n        \n        key = str[0];               //\xd1\xa1\xd4\xf1\xb2\xe9\xd1\xaf\xcc\xf5\xbc\xfe\n        keyWord = str[1];           //\xb2\xe9\xd1\xaf\xb5\xc4\xb9\xd8\xbc\xfc\xd7\xd6\n        queryUserName = str[2];     //\xb2\xe9\xd1\xaf\xb5\xc4\xd3\xc3\xbb\xa7\xc3\xfb\n        user = str[3];              //\xb5\xb1\xc7\xb0\xd3\xc3\xbb\xa7\n        keys = Integer.parseInt(key);  \n        orderList.clear();\n        Order order = null;\n//        order = new Order();\n        order = (Order)session.getAttribute("order");\n        if (order==null)\n        {\n            order = new Order();\n            session.setAttribute("order", order);\n        }\n        \n        //key=1 \xb2\xe9\xd1\xaf\xb5\xb1\xc7\xb0\xd3\xc3\xbb\xa7\xcb\xf9\xd3\xd0\xb6\xa9\xb5\xa5\xc1\xd0\xb1\xed\n        //key=2 \xb2\xe9\xd1\xaf\xcb\xf9\xd3\xd0\xd3\xc3\xbb\xa7\xb6\xa9\xb5\xa5\xc1\xd0\xb1\xed\n        //key=3 \xb0\xb4\xd5\xd5\xcc\xf5\xbc\xfe\xb2\xe9\xd1\xaf\xb6\xa9\xb5\xa5 \xd3\xc3\xbb\xa7\xc3\xfb+\xc9\xcc\xc6\xb7\xb9\xd8\xbc\xfc\xd7\xd6\n        if ("1".equals(key)){\n            orderList = orderService.orderList(user);\n        }else if ("2".equals(key)) {\n                    orderList = orderService.orderAllList();\n                 }else if ("3".equals(key)) {\n                             //\xbd\xab\xb2\xe9\xd1\xaf\xd0\xc5\xcf\xa2\xb7\xe2\xd7\xb0\xb5\xbd\xb6\xd4\xcf\xf3\xd6\xd0\n                             orderList = orderService.orderListByKeyName(queryUserName,keyWord);\n                         }\n        \n        order.setOrderList(orderList);\n        session.setAttribute("orderAllList", order);\n        request.getRequestDispatcher("/jsp/manageGoods/OrderList.jsp").forward(request, response);\n    }\n    \n    /**\n     * \n     * \xb8\xf9\xbe\xdd\xcc\xf5\xbc\xfe\xd1\xa1\xd4\xf1\xc9\xbe\xb3\xfd\xb6\xa9\xb5\xa5\xb5\xc4\xd2\xb5\xce\xf1\n     * \n     * @param str\n     * @param request\n     * @param response\n     * @throws IOException\n     * @throws ServletException\n     */\n    public void deleteCondition(String str[],String ids[],HttpServletRequest request, HttpServletResponse response) \n    throws IOException, ServletException\n    {\n       response.setContentType("text/html;charset=UTF-8");\n       HttpSession session = request.getSession(true);\n       \n       key = str[0]; \n       id = str[1];\n         \n       Order order = null;\n       order = new Order();\n       orderList.clear();\n       order = (Order)session.getAttribute("order");\n       if (order==null)\n       {\n           order = new Order();\n           session.setAttribute("order", order);\n       }\n       \n        if ("4".equals(key)){\n           orderService.deleteOrderOneById(id);       //\xc9\xbe\xb3\xfd\xb5\xa5\xb8\xf6\xb6\xa9\xb5\xa5\n           orderList = orderService.orderAllList();   //\xd6\xd8\xd0\xc2\xb2\xe9\xd1\xaf\xb6\xa9\xb5\xa5\xc1\xd0\xb1\xed(\xd3\xa6\xb8\xc3\xb8\xf9\xbe\xdd\xd6\xae\xc7\xb0\xb5\xc4\xbc\xec\xcb\xf7\xcc\xf5\xbc\xfe\xb2\xe9\xd1\xaf)\n        }else if ("5".equals(key)) {\n                   orderService.deleteOrderBatch(ids);        //\xc5\xfa\xc1\xbf\xc9\xbe\xb3\xfd\xb6\xa9\xb5\xa5\n                   orderList = orderService.orderAllList();   //\xd6\xd8\xd0\xc2\xb2\xe9\xd1\xaf\xb6\xa9\xb5\xa5\xc1\xd0\xb1\xed(\xd3\xa6\xb8\xc3\xb8\xf9\xbe\xdd\xd6\xae\xc7\xb0\xb5\xc4\xbc\xec\xcb\xf7\xcc\xf5\xbc\xfe\xb2\xe9\xd1\xaf)\n                 }\n        \n        //\xb2\xbb\xb9\xdc\xd3\xd0\xc3\xbb\xd3\xd0\xb2\xe9\xd1\xaf\xb5\xbd\xd6\xb5\xb6\xbc\xd2\xaa\xb7\xb5\xbb\xd8\xb6\xa9\xb5\xa5\xc1\xd0\xb1\xed\n        order.setOrderList(orderList);\n        session.setAttribute("orderAllList", order);\n        request.getRequestDispatcher("/jsp/manageGoods/OrderList.jsp").forward(request, response);\n      \n    }\n}\n'