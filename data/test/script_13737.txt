b'package lyons.user.service;\n\nimport java.io.IOException;\nimport java.io.PrintWriter;\nimport java.net.URLEncoder;\nimport java.util.ArrayList;\nimport java.util.Hashtable;\nimport java.util.List;\nimport java.util.Map;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.Cookie;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport javax.servlet.http.HttpSession;\n\nimport lyons.dao.UserDaoImp;\nimport lyons.user.entity.User;\n\n/**\n * \n * \xd3\xc3\xbb\xa7\xb7\xfe\xce\xf1\xc0\xe0\n * \n * @author  lyons(zhanglei)\n */\n@SuppressWarnings("serial")\npublic class UserService extends HttpServlet\n{\n    \n    UserDaoImp userDao = new UserDaoImp();;\n    List<User> userList = new ArrayList<User>();;\n    \n    /**\n     * \n     * \xd3\xc3\xbb\xa7\xb5\xc7\xc2\xbc\n     * @param request\n     * @param response\n     * @param userMap\n     * @throws ServletException\n     * @throws IOException\n     */\n    public void userLogin(HttpServletRequest request, HttpServletResponse response, Map<String, String> userMap) \n        throws ServletException, IOException\n    {\n        response.setContentType("text/html;charset=UTF-8");\n        request.setCharacterEncoding("UTF-8");\n        \n        handleCookies(request,response,userMap.get("username"),\n        userMap.get("userpass"),userMap.get("isCookie"));//\xb4\xa6\xc0\xedcookies\xd0\xc5\xcf\xa2\n        \n        //\xce\xaa\xc1\xcb\xca\xb9\xd3\xc3map\xa3\xac\xd2\xb2\xca\xc7\xd7\xed\xc1\xcb   \xc1\xed\xcd\xe2\xa3\xbamap\xc8\xa1\xd6\xb5\xca\xb1\xb6\xd4\xb4\xf3\xd0\xa1\xd0\xb4\xc3\xf4\xb8\xd0\n        Map<String, Object> map = new Hashtable<String, Object>();\n        Map<String, String> namePass = new Hashtable<String, String>();\n        namePass.put(userMap.get("username"), userMap.get("userpass"));\n        map.put("userMap", namePass);\n        \n        //\xb5\xc7\xc2\xbc\xbd\xe1\xb9\xfb\n        userList = userDao.queryByuserNamepassWord(map);//get user Info by userName\n        if (userList != null && userList.size() > 0 )\n        {\n            success(request,response,userMap.get("username"));\n            request.getRequestDispatcher("/jsp/join/landing.jsp").forward(request, response);\n        }else {\n            fail(request, response, "\xd3\xc3\xbb\xa7\xc3\xfb\xbb\xf2\xc3\xdc\xc2\xeb\xb4\xed\xce\xf3");\n        }\n\n    }\n    \n\n    /**\n     * \n     * \xd1\xe9\xd6\xa4\xd3\xc3\xbb\xa7\xc3\xfb\xca\xc7\xb7\xf1\xb4\xe6\xd4\xda\n     * @param username\n     * @return Existence:true\n     */\n    public boolean isExistence(String username)\n    {\n        userList = userDao.queryByuserName(username);\n        \n        if (userList != null && userList.size() > 0)\n        {\n            return true;\n        }\n        \n        return false;\n    }\n    \n    \n    /**\n     * \n     * \xc5\xd0\xb6\xcf\xd3\xc3\xbb\xa7\xca\xc7\xb7\xf1\xb5\xc7\xc2\xbd\n     * \n     * @param request\n     * @param response\n     * @return \xd3\xc3\xbb\xa7\xc3\xfbuser\n     * @throws ServletException\n     * @throws IOException\n     */\n    public String isLogin(HttpServletRequest request, HttpServletResponse response) \n           throws ServletException, IOException\n    \n    {\n        response.setContentType("text/html;charset=UTF-8");\n        PrintWriter out = response.getWriter();\n        User username = null;\n        \n        HttpSession session = request.getSession(true);\n        username = (User)session.getAttribute("loginBean");\n       \n        if (username==null)\n        {\n            username = new User();\n            session.setAttribute("username", username);\n        }\n          //\xc5\xd0\xb6\xcf\xd3\xc3\xbb\xa7\xca\xc7\xb7\xf1\xb5\xc7\xc2\xbd\n          String user = "";\n          user = username.getUsername();//\xb5\xc7\xc2\xbd\xd5\xdf\xb5\xc4\xd3\xc3\xbb\xa7\xc3\xfb\n          if ("userNull".equals(user)||user==null)\n          {\n              out.print("<br>");\n              out.print("<center>" +\n                      \t\t"<font color=#008B8B> \xbf\xcd\xb9\xd9\xa3\xac</font>" +\n                      \t\t"<a href=/lyons.eaby.new/jsp/join/login.jsp><font color=red size=6>\xb5\xc7\xc2\xbd</font></a>" +\n                      \t\t"<font color=#008B8B> \xd6\xae\xba\xf3\xb2\xc5\xc4\xdc\xb2\xd9\xd7\xf7\xc5\xb6  </font>" +\n              \t\t   "</center>");\n              return "";\n          }\n          return user;\n    }\n    \n    \n    /**\n     * \xb4\xa6\xc0\xed\xd3\xc3\xbb\xa7cookies\xd0\xc5\xcf\xa2\n     * @param request\n     * @param response\n     * @param username\n     * @param userpass\n     */\n    public void handleCookies(HttpServletRequest request,HttpServletResponse response, \n            String name,String pass,String isCookie)throws ServletException, IOException\n    {\n        if ("isCookie".equals(isCookie))//\xd3\xc3\xbb\xa7\xd1\xa1\xd4\xf1\xc1\xcb\xbc\xc7\xd7\xa1\xc3\xdc\xc2\xeb\n        {\n            String username = URLEncoder.encode(name,"UTF-8");//\xb1\xe0\xc2\xeb\xa3\xac\xbd\xe2\xbe\xf6cookie\xce\xde\xb7\xa8\xb1\xa3\xb4\xe6\xd7\xd6\xb7\xfb\xb4\xae\xb5\xc4\xce\xca\xcc\xe2\n            String userpass = URLEncoder.encode(pass,"UTF-8");\n            \n            Cookie nameCookie = new Cookie("username",username );//\xc9\xe8\xd6\xc3\xd3\xeb\xb5\xc7\xc2\xbd\xca\xb1\xb5\xc4name\xb6\xd4\xd3\xa6\xb5\xc4\xbc\xfc\xd6\xb5\xb6\xd4\n            Cookie passCookie = new Cookie("userpass",userpass );\n            \n            nameCookie.setPath("/");//\xc9\xe8\xd6\xc3\xb5\xc4cookie\xb5\xc4\xb4\xe6\xb4\xa2\xc2\xb7\xbe\xb6\xba\xdc\xd6\xd8\xd2\xaa\xa3\xac\xb2\xbb\xc8\xbb\xc8\xa1\xb2\xbb\xb5\xbd\xd6\xb5\n            passCookie.setPath("/");\n            nameCookie.setMaxAge(864000); //\xc9\xe8\xd6\xc3\xc9\xfa\xc3\xfc\xc6\xda\xcf\xde\xca\xae\xcc\xec \xb5\xa5\xce\xbb\xc3\xeb\n            passCookie.setMaxAge(864000);\n            response.addCookie(nameCookie); //\xb1\xa3\xb4\xe6\xd0\xc5\xcf\xa2\n            response.addCookie(passCookie); \n        }else \n            {\n            //\xd3\xc3\xbb\xa7\xce\xb4\xd1\xa1\xd4\xf1\xbc\xc7\xd7\xa1\xc3\xdc\xc2\xeb\xa3\xac\xc9\xbe\xb3\xfd\xe4\xaf\xc0\xc0\xc6\xf7\xd6\xd0\xbf\xc9\xc4\xdc\xb4\xe6\xd4\xda\xb5\xc4cookie\n                Cookie[] cookies = null;\n                cookies = request.getCookies();\n                if (cookies!=null&&cookies.length>0)\n                {\n                    for (Cookie c : cookies)\n                    {\n                        if ("username".equals(c.getName())||"userpass".equals(c.getName()))\n                        {\n                            c.setMaxAge(0);//\xc9\xe8\xd6\xc3cookie\xca\xa7\xd0\xa7\n                            c.setPath("/");//\xce\xf1\xb1\xd8\xc9\xe8\xd6\xc3\n                            response.addCookie(c);\n                        }\n                    }\n                }\n            }\n    }\n    \n    /**\n     * \xb5\xc7\xc2\xbd\xb3\xc9\xb9\xa6\xa3\xac\xb4\xa2\xb4\xe6\xd3\xc3\xbb\xa7\xd0\xc5\xcf\xa2\n     */\n    public void success(HttpServletRequest request,HttpServletResponse response, String username)\n    {\n        User loginBean = null;\n        HttpSession session = request.getSession(true);\n        \n        try\n        {\n            loginBean = (User) session.getAttribute("loginBean");//\xbb\xf1\xc8\xa1session\xd6\xd0\xbf\xc9\xc4\xdc\xb4\xe6\xd4\xda\xb5\xc4loginBean\xb6\xd4\xcf\xf3\n            if (loginBean == null)\n            {\n                loginBean = new User();\n                session.setAttribute("loginBean", loginBean);//\xd7\xa2\xd2\xe2jsp\xbb\xf1\xc8\xa1\xca\xb1\xd0\xe8\xd2\xaa\xd3\xc3\xb5\xbd\xb8\xc3name\xb5\xc4\xca\xf4\xd0\xd4\xc3\xfb\xd7\xd6\n                session.setMaxInactiveInterval(600);//\xca\xae\xb7\xd6\xd6\xd3\xb5\xc4\xb4\xe6\xbb\xee\xc6\xda \xb5\xa5\xce\xbb\xa3\xba\xc3\xeb\n                loginBean = (User) session.getAttribute("loginBean");\n            }\n            \n            String name = loginBean.getUsername();\n            if (username.equals(name))\n            {\n                loginBean.setBackNews(username + "\xc4\xfa\xd2\xd1\xb5\xc7\xc2\xbd\xa3\xac\xce\xde\xd0\xe8\xd4\xd9\xb4\xce\xb5\xc7\xc2\xbc");\n                loginBean.setUsername(username);\n            } else\n                {\n                    loginBean.setBackNews(username + "\xb5\xc7\xc2\xbd\xb3\xc9\xb9\xa6");\n                    loginBean.setUsername(username);\n                }\n        } catch (Exception e)\n        {\n            String backNews = "\xb5\xc7\xc2\xbc\xca\xa7\xb0\xdc"+e;\n            fail(request, response, backNews);\n        }\n    \n    }\n    \n    /**\n     * \xb5\xc7\xc2\xbd\xca\xa7\xb0\xdc\n     */\n    public void fail(HttpServletRequest request,HttpServletResponse response,String backNews)\n    {\n        try\n        {\n            PrintWriter out = response.getWriter();\n            out.print(backNews+"<br>");\n            out.print("\xb7\xb5\xbb\xd8"+"<a href=/lyons.eaby.new/jsp/join/login.jsp>\xb5\xc7\xc2\xbd\xbd\xe7\xc3\xe6</a>");\n        } catch (IOException e)\n        {\n            e.printStackTrace();\n        }\n    }\n\n}\n'