b'/*\n * Copyright (C) 2015 Naman Dwivedi\n *\n * Licensed under the GNU General Public License v3\n *\n * This is free software: you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * See the GNU General Public License for more details.\n */\n\npackage com.naman14.timber.subfragments;\n\nimport android.content.Context;\nimport android.content.Intent;\nimport android.content.SharedPreferences;\nimport android.os.Bundle;\nimport androidx.annotation.NonNull;\nimport androidx.annotation.Nullable;\nimport androidx.fragment.app.Fragment;\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.widget.ImageView;\nimport android.widget.LinearLayout;\nimport android.widget.TextView;\n\nimport com.afollestad.materialdialogs.DialogAction;\nimport com.afollestad.materialdialogs.MaterialDialog;\nimport com.naman14.timber.R;\nimport com.naman14.timber.activities.DonateActivity;\nimport com.naman14.timber.utils.Constants;\nimport com.naman14.timber.utils.NavigationUtils;\nimport com.naman14.timber.utils.PreferencesUtility;\n\npublic class SubStyleSelectorFragment extends Fragment {\n\n    private static final String ARG_PAGE_NUMBER = "pageNumber";\n    private static final String WHAT = "what";\n    private SharedPreferences.Editor editor;\n    private SharedPreferences preferences;\n    private LinearLayout currentStyle;\n    private View foreground;\n    private ImageView styleImage, imgLock;\n\n    public static SubStyleSelectorFragment newInstance(int pageNumber, String what) {\n        SubStyleSelectorFragment fragment = new SubStyleSelectorFragment();\n        Bundle bundle = new Bundle();\n        bundle.putInt(ARG_PAGE_NUMBER, pageNumber);\n        bundle.putString(WHAT, what);\n        fragment.setArguments(bundle);\n        return fragment;\n    }\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container,\n                             @Nullable Bundle savedInstanceState) {\n        View rootView = inflater.inflate(R.layout.fragment_style_selector_pager, container, false);\n\n        TextView styleName = (TextView) rootView.findViewById(R.id.style_name);\n        styleName.setText(String.valueOf(getArguments().getInt(ARG_PAGE_NUMBER) + 1));\n        preferences = getActivity().getSharedPreferences(Constants.FRAGMENT_ID, Context.MODE_PRIVATE);\n\n        styleImage = (ImageView) rootView.findViewById(R.id.style_image);\n        imgLock = (ImageView) rootView.findViewById(R.id.img_lock);\n\n        styleImage.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                if (getArguments().getInt(ARG_PAGE_NUMBER) >= 4) {\n                    if (isUnlocked()) {\n                        setPreferences();\n                    } else {\n                        showPurchaseDialog();\n                    }\n                } else\n                    setPreferences();\n            }\n        });\n\n        switch (getArguments().getInt(ARG_PAGE_NUMBER)) {\n            case 0:\n                styleImage.setImageResource(R.drawable.timber_1_nowplaying_x);\n                break;\n            case 1:\n                styleImage.setImageResource(R.drawable.timber_2_nowplaying_x);\n                break;\n            case 2:\n                styleImage.setImageResource(R.drawable.timber_3_nowplaying_x);\n                break;\n            case 3:\n                styleImage.setImageResource(R.drawable.timber_4_nowplaying_x);\n                break;\n            case 4:\n                styleImage.setImageResource(R.drawable.timber_5_nowplaying_x);\n                break;\n            case 5:\n                styleImage.setImageResource(R.drawable.timber_6_nowplaying_x);\n                break;\n        }\n\n        currentStyle = (LinearLayout) rootView.findViewById(R.id.currentStyle);\n        foreground = rootView.findViewById(R.id.foreground);\n\n        setCurrentStyle();\n\n        return rootView;\n    }\n\n    private boolean isUnlocked() {\n        return getActivity() != null && PreferencesUtility.getInstance(getActivity()).fullUnlocked();\n    }\n\n    @Override\n    public void onResume() {\n        super.onResume();\n        updateLockedStatus();\n    }\n\n    private void updateLockedStatus() {\n        if (getArguments().getInt(ARG_PAGE_NUMBER) >= 4 && !isUnlocked()) {\n            imgLock.setVisibility(View.VISIBLE);\n            foreground.setVisibility(View.VISIBLE);\n        }\n        else {\n            imgLock.setVisibility(View.GONE);\n            foreground.setVisibility(View.GONE);\n        }\n    }\n    private void showPurchaseDialog() {\n        MaterialDialog dialog = new MaterialDialog.Builder(getActivity())\n                .title("Purchase")\n                .content("This now playing style is available after a one time purchase of any amount. Support development and unlock this style?")\n                .positiveText("Support development")\n                .neutralText("Restore purchases")\n                .onPositive(new MaterialDialog.SingleButtonCallback() {\n                    @Override\n                    public void onClick(@NonNull MaterialDialog dialog, @NonNull DialogAction which) {\n                        startActivity(new Intent(getActivity(), DonateActivity.class));\n                        dialog.dismiss();\n                    }\n                }).onNeutral(new MaterialDialog.SingleButtonCallback() {\n                    @Override\n                    public void onClick(@NonNull MaterialDialog dialog, @NonNull DialogAction which) {\n                        Intent intent = new Intent(getActivity(), DonateActivity.class);\n                        intent.putExtra("title", "Restoring purchases..");\n                        intent.setAction("restore");\n                        startActivity(intent);\n                        dialog.dismiss();\n                    }\n                })\n                .show();\n    }\n\n    public void setCurrentStyle() {\n        String fragmentID = preferences.getString(Constants.NOWPLAYING_FRAGMENT_ID, Constants.TIMBER3);\n\n        if (getArguments().getInt(ARG_PAGE_NUMBER) == NavigationUtils.getIntForCurrentNowplaying(fragmentID)) {\n            currentStyle.setVisibility(View.VISIBLE);\n            foreground.setVisibility(View.VISIBLE);\n        } else {\n            currentStyle.setVisibility(View.GONE);\n            foreground.setVisibility(View.GONE);\n        }\n\n    }\n\n    private void setPreferences() {\n\n        if (getArguments().getString(WHAT).equals(Constants.SETTINGS_STYLE_SELECTOR_NOWPLAYING)) {\n            editor = getActivity().getSharedPreferences(Constants.FRAGMENT_ID, Context.MODE_PRIVATE).edit();\n            editor.putString(Constants.NOWPLAYING_FRAGMENT_ID, getStyleForPageNumber());\n            editor.apply();\n            if (getActivity() != null)\n                PreferencesUtility.getInstance(getActivity()).setNowPlayingThemeChanged(true);\n            setCurrentStyle();\n            ((StyleSelectorFragment) getParentFragment()).updateCurrentStyle();\n        }\n    }\n\n    private String getStyleForPageNumber() {\n        switch (getArguments().getInt(ARG_PAGE_NUMBER)) {\n            case 0:\n                return Constants.TIMBER1;\n            case 1:\n                return Constants.TIMBER2;\n            case 2:\n                return Constants.TIMBER3;\n            case 3:\n                return Constants.TIMBER4;\n            case 4:\n                return Constants.TIMBER5;\n            case 5:\n                return Constants.TIMBER6;\n            default:\n                return Constants.TIMBER3;\n        }\n    }\n\n\n}\n'