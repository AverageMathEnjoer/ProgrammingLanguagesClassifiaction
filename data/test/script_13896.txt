b'package com.github.eprendre.sources_by_eprendre\n\nimport com.github.eprendre.tingshu.sources.AudioUrlDirectExtractor\nimport com.github.eprendre.tingshu.sources.AudioUrlExtractor\nimport com.github.eprendre.tingshu.sources.TingShu\nimport com.github.eprendre.tingshu.utils.*\nimport com.github.kittinunf.fuel.Fuel\nimport com.github.kittinunf.fuel.json.responseJson\nimport java.net.URLEncoder\nimport kotlin.math.ceil\n\nobject KuWo: TingShu() {\n    override fun getSourceId(): String {\n        return "502efedf0613460a9967d9e86ce2b24c"\n    }\n\n    override fun getUrl(): String {\n        return "http://kuwo.cn/downtingshu"\n    }\n\n    override fun getName(): String {\n        return "\xe9\x85\xb7\xe6\x88\x91\xe7\x95\x85\xe5\x90\xac"\n    }\n\n    override fun getDesc(): String {\n        return "\xe6\x8e\xa8\xe8\x8d\x90\xe6\x8c\x87\xe6\x95\xb0:5\xe6\x98\x9f \xe2\xad\x90\xe2\xad\x90\xe2\xad\x90\xe2\xad\x90\xe2\xad\x90"\n    }\n\n    override fun search(keywords: String, page: Int): Pair<List<Book>, Int> {\n        val encodedKeywords = URLEncoder.encode(keywords, "utf-8") //\xe7\xbc\x96\xe7\xa0\x81\n        val url = "http://baby.kuwo.cn/tingshu/api/search/Search?rn=10&type=album&version=8.5.6.1&wd=${encodedKeywords}&pn=${page}&kweexVersion=1.0.2"\n\n        val data = Fuel.get(url)\n            .responseJson()\n            .third.get().obj().getJSONObject("data")\n        val pageCount = ceil(data.getInt("total").toFloat() / 10).toInt()\n        val list = ArrayList<Book>()\n        val iData = data.getJSONArray("data")\n        (0 until iData.length()).forEach { i ->\n            val item = iData.getJSONObject(i)\n            val albumId = item.getInt("albumId")\n            val coverUrl = item.getString("coverImg")\n            val bookUrl = "http://baby.kuwo.cn/tingshu/api/data/album/songs?albumId=${albumId}&online=0&kweexVersion=1.0.2"\n            val title = item.getString("albumName")\n            val author = ""\n            val artist = "\xe6\x92\xad\xe9\x9f\xb3: ${item.getString("artistName")}"\n            val status = "\xe5\x85\xb1 ${item.getInt("songTotal")} \xe7\xab\xa0"\n            val intro = item.getString("title")\n            list.add(Book(coverUrl, bookUrl, title, author, artist).apply {\n                this.status = status\n                this.intro = intro\n                this.sourceId = getSourceId()\n            })\n        }\n\n        return Pair(list, pageCount)\n    }\n\n    override fun isWebViewNotRequired(): Boolean {\n        return true\n    }\n\n    override fun getAudioUrlExtractor(): AudioUrlExtractor {\n        return AudioUrlDirectExtractor\n    }\n\n    override fun getCategoryMenus(): List<CategoryMenu> {\n        val menu1 = CategoryMenu(\n            "\xe5\xb0\x8f\xe8\xaf\xb4", listOf(\n                CategoryTab("\xe4\xbb\x98\xe8\xb4\xb9\xe6\x8e\x92\xe8\xa1\x8c", "http://baby.kuwo.cn/tingshu/api/page/boutique/getBoutiqueData?pt=1&rn=100&version=8.5.6.1&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe5\x85\x8d\xe8\xb4\xb9\xe6\x8e\x92\xe8\xa1\x8c", "http://baby.kuwo.cn/tingshu/api/page/boutique/getBoutiqueData?pt=2&rn=100&version=8.5.6.1&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe9\x83\xbd\xe5\xb8\x82\xe4\xbc\xa0\xe8\xaf\xb4", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=42&rn=20&categoryId=2&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe7\x8e\x84\xe5\xb9\xbb\xe5\xa5\x87\xe5\xb9\xbb", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=44&rn=20&categoryId=2&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe6\x82\xac\xe7\x96\x91\xe6\x8e\xa8\xe7\x90\x86", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=45&rn=20&categoryId=2&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe7\x8e\xb0\xe4\xbb\xa3\xe8\xa8\x80\xe6\x83\x85", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=41&rn=20&categoryId=2&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe6\xad\xa6\xe4\xbe\xa0\xe4\xbb\x99\xe4\xbe\xa0", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=48&rn=20&categoryId=2&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe7\xa9\xbf\xe8\xb6\x8a\xe6\x9e\xb6\xe7\xa9\xba", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=52&rn=20&categoryId=2&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe7\xbb\x8f\xe5\x85\xb8\xe5\xb0\x8f\xe8\xaf\xb4", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=64&rn=20&categoryId=2&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe9\x9d\x92\xe6\x98\xa5\xe6\xa0\xa1\xe5\x9b\xad", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=55&rn=20&categoryId=2&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe5\x8e\x86\xe5\x8f\xb2\xe5\x86\x9b\xe4\xba\x8b", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=56&rn=20&categoryId=2&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe7\xa7\x91\xe5\xb9\xbb\xe7\xab\x9e\xe6\x8a\x80", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=57&rn=20&categoryId=2&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe5\x8f\xa4\xe4\xbb\xa3\xe8\xa8\x80\xe6\x83\x85", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=207&rn=20&categoryId=2&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe8\x83\xbd\xe5\x8a\x9b\xe6\x8f\x90\xe5\x8d\x87", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=82&rn=20&categoryId=4&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe4\xba\xba\xe6\x96\x87\xe8\x89\xba\xe6\x9c\xaf", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=77&rn=20&categoryId=4&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe5\x9b\xbd\xe5\xad\xa6\xe6\x96\x87\xe5\x8c\x96", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=78&rn=20&categoryId=4&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe6\x88\x90\xe5\x8a\x9f\xe6\xb3\x95\xe5\x88\x99", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=79&rn=20&categoryId=4&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe5\xa4\x96\xe8\xaf\xad\xe7\xb2\xbe\xe9\x80\x9a", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=76&rn=20&categoryId=4&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe5\x85\xbb\xe7\x94\x9f\xe5\x81\xa5\xe5\xba\xb7", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=81&rn=20&categoryId=4&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe9\x85\xb7\xe6\x88\x91\xe8\xaf\xbb\xe4\xb9\xa6", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=211&rn=20&categoryId=4&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe5\x9b\xbd\xe5\xad\xa6\xe7\xbb\x8f\xe5\x85\xb8", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=117&rn=20&categoryId=9&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe5\x8e\x86\xe5\x8f\xb2\xe5\xb0\x8f\xe8\xaf\xb4", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=181&rn=20&categoryId=9&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe7\xba\xaa\xe5\xae\x9e\xe6\xa1\xa3\xe6\xa1\x88", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=118&rn=20&categoryId=9&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe5\x8e\x86\xe5\x8f\xb2\xe4\xbc\xa0\xe5\xa5\x87", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=119&rn=20&categoryId=9&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe4\xba\xba\xe7\x89\xa9\xe4\xbc\xa0\xe5\xa5\x87", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=120&rn=20&categoryId=9&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe6\x96\x87\xe5\x8c\x96\xe8\xae\xb2\xe5\xa0\x82", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=121&rn=20&categoryId=9&pn=1&kweexVersion=1.0.2"),\n                CategoryTab("\xe7\x99\xbe\xe5\xae\xb6\xe8\xae\xb2\xe5\x9d\x9b", "http://baby.kuwo.cn/tingshu/api/filter/albums?sortType=tsScore&classifyId=212&rn=20&categoryId=9&pn=1&kweexVersion=1.0.2")\n            )\n        )\n        return listOf(menu1)\n    }\n\n    override fun getCategoryList(url: String): Category {\n        val currentPage = Regex("pn=(\\\\d+)").find(url)!!.groupValues[1].toInt()\n        val pageCount: Int\n        val data = Fuel.get(url).responseJson().third.get().obj().getJSONObject("data")\n        if (data.has("pageInfo")) {\n            val total = data.getJSONObject("pageInfo").getInt("total")\n            pageCount = ceil(total.toFloat() / 100).toInt()\n        } else {\n            val total = data.getInt("total")\n            pageCount = ceil(total.toFloat() / 20).toInt()\n        }\n        val nextUrl = if (currentPage < pageCount) {\n            url.replace(Regex("pn=(\\\\d+)"), "pn=${currentPage + 1}")\n        } else ""\n\n        val list = ArrayList<Book>()\n        if (data.has("topDatas")) {\n            val topDatas = data.getJSONArray("topDatas")\n            (0 until topDatas.length()).forEach { i ->\n                val item = topDatas.getJSONObject(i).getJSONObject("albums")\n                val albumId = item.getInt("albumId")\n                val coverUrl = item.getString("img")\n                val bookUrl = "http://baby.kuwo.cn/tingshu/api/data/album/songs?albumId=${albumId}&online=0&kweexVersion=1.0.2"\n                val title = item.getString("name")\n                val author = ""\n                val artist = ""\n                val status = "\xe5\x85\xb1 ${item.getInt("songTotal")} \xe7\xab\xa0"\n                val intro = item.getString("title")\n                list.add(Book(coverUrl, bookUrl, title, author, artist).apply {\n                    this.status = status\n                    this.intro = intro\n                    this.sourceId = getSourceId()\n                })\n            }\n\n        } else {\n            val iData = data.getJSONArray("data")\n            (0 until iData.length()).forEach { i ->\n                val item = iData.getJSONObject(i)\n                val albumId = item.getInt("albumId")\n                val coverUrl = item.getString("coverImg")\n                val bookUrl = "http://baby.kuwo.cn/tingshu/api/data/album/songs?albumId=${albumId}&online=0&kweexVersion=1.0.2"\n                val title = item.getString("albumName")\n                val author = ""\n                val artist = "\xe6\x92\xad\xe9\x9f\xb3: ${item.getString("artistName")}"\n                val status = "\xe5\x85\xb1 ${item.getInt("songTotal")} \xe7\xab\xa0"\n                val intro = item.getString("title")\n                list.add(Book(coverUrl, bookUrl, title, author, artist).apply {\n                    this.status = status\n                    this.intro = intro\n                    this.sourceId = getSourceId()\n                })\n            }\n        }\n        return Category(list, currentPage, pageCount, url, nextUrl)\n    }\n\n    override fun getBookDetailInfo(bookUrl: String, loadEpisodes: Boolean, loadFullPages: Boolean): BookDetail {\n        val episodes = ArrayList<Episode>()\n        if (loadEpisodes) {\n            val data = Fuel.get(bookUrl).responseJson().third.get().obj().getJSONArray("data")\n            (0 until data.length()).forEach {\n                val item = data.getJSONObject(it)\n                val name = item.getString("name")\n                val musicrid = item.getString("musicrid")\n                val url = "http://antiserver.kuwo.cn/anti.s?useless=/resource/&format=mp3&rid=MUSIC_${musicrid}&response=res&type=convert_url"\n                episodes.add(Episode(name, url))\n            }\n        }\n        return BookDetail(episodes)\n    }\n}'