b'package com.codeest.geeknews.base;\n\nimport android.view.View;\nimport android.view.ViewGroup;\n\nimport com.codeest.geeknews.R;\nimport com.codeest.geeknews.widget.ProgressImageView;\n\n/**\n * @author: Est <codeest.dev@gmail.com>\n * @date: 2017/4/21\n * @desciption:\n */\n\npublic abstract class RootFragment<T extends BasePresenter> extends BaseFragment<T> {\n\n    private static final int STATE_MAIN = 0x00;\n    private static final int STATE_LOADING = 0x01;\n    private static final int STATE_ERROR = 0x02;\n\n    private ProgressImageView ivLoading;\n    private View viewError;\n    private View viewLoading;\n    private ViewGroup viewMain;\n    private ViewGroup mParent;\n\n    private int mErrorResource = R.layout.view_error;\n\n    private int currentState = STATE_MAIN;\n    private boolean isErrorViewAdded = false;\n\n    @Override\n    protected void initEventAndData() {\n        if (getView() == null)\n            return;\n        viewMain = (ViewGroup) getView().findViewById(R.id.view_main);\n        if (viewMain == null) {\n            throw new IllegalStateException(\n                    "The subclass of RootActivity must contain a View named \'view_main\'.");\n        }\n        if (!(viewMain.getParent() instanceof ViewGroup)) {\n            throw new IllegalStateException(\n                    "view_main\'s ParentView should be a ViewGroup.");\n        }\n        mParent = (ViewGroup) viewMain.getParent();\n        View.inflate(mContext, R.layout.view_progress, mParent);\n        viewLoading = mParent.findViewById(R.id.view_loading);\n        ivLoading = (ProgressImageView) viewLoading.findViewById(R.id.iv_progress);\n        viewLoading.setVisibility(View.GONE);\n        viewMain.setVisibility(View.VISIBLE);\n    }\n\n    @Override\n    public void stateError() {\n        if (currentState == STATE_ERROR)\n            return;\n        if (!isErrorViewAdded) {\n            isErrorViewAdded = true;\n            View.inflate(mContext, mErrorResource, mParent);\n            viewError = mParent.findViewById(R.id.view_error);\n            if (viewError == null) {\n                throw new IllegalStateException(\n                        "A View should be named \'view_error\' in ErrorLayoutResource.");\n            }\n        }\n        hideCurrentView();\n        currentState = STATE_ERROR;\n        viewError.setVisibility(View.VISIBLE);\n    }\n\n    @Override\n    public void stateLoading() {\n        if (currentState == STATE_LOADING)\n            return;\n        hideCurrentView();\n        currentState = STATE_LOADING;\n        viewLoading.setVisibility(View.VISIBLE);\n        ivLoading.start();\n    }\n\n    @Override\n    public void stateMain() {\n        if (currentState == STATE_MAIN)\n            return;\n        hideCurrentView();\n        currentState = STATE_MAIN;\n        viewMain.setVisibility(View.VISIBLE);\n    }\n\n    private void hideCurrentView() {\n        switch (currentState) {\n            case STATE_MAIN:\n                viewMain.setVisibility(View.GONE);\n                break;\n            case STATE_LOADING:\n                ivLoading.stop();\n                viewLoading.setVisibility(View.GONE);\n                break;\n            case STATE_ERROR:\n                if (viewError != null) {\n                    viewError.setVisibility(View.GONE);\n                }\n                break;\n        }\n    }\n\n    public void setErrorResource(int errorLayoutResource) {\n        this.mErrorResource = errorLayoutResource;\n    }\n}\n'