b'package com.codeest.geeknews.ui.gold.fragment;\n\nimport android.support.v4.widget.SwipeRefreshLayout;\nimport android.support.v7.widget.LinearLayoutManager;\nimport android.support.v7.widget.RecyclerView;\n\nimport com.codeest.geeknews.R;\nimport com.codeest.geeknews.app.Constants;\nimport com.codeest.geeknews.base.RootFragment;\nimport com.codeest.geeknews.model.bean.GoldListBean;\nimport com.codeest.geeknews.presenter.gold.GoldPresenter;\nimport com.codeest.geeknews.base.contract.gold.GoldContract;\nimport com.codeest.geeknews.ui.gold.adapter.GoldListAdapter;\nimport com.codeest.geeknews.widget.GoldItemDecoration;\nimport com.codeest.geeknews.widget.TouchSwipeRefreshLayout;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport butterknife.BindView;\n\n/**\n * Created by codeest on 16/11/27.\n */\n\npublic class GoldPagerFragment extends RootFragment<GoldPresenter> implements GoldContract.View {\n\n    @BindView(R.id.view_main)\n    RecyclerView rvGoldList;\n    @BindView(R.id.swipe_refresh)\n    TouchSwipeRefreshLayout swipeRefresh;\n\n    private GoldListAdapter mAdapter;\n    private GoldItemDecoration mDecoration;\n\n    private boolean isLoadingMore = false;\n    private String mType;\n\n    @Override\n    protected void initInject() {\n        getFragmentComponent().inject(this);\n    }\n\n    @Override\n    protected int getLayoutId() {\n        return R.layout.fragment_gold_page;\n    }\n\n    @Override\n    protected void initEventAndData() {\n        super.initEventAndData();\n        mType = getArguments().getString(Constants.IT_GOLD_TYPE);\n        mDecoration = new GoldItemDecoration();\n        mAdapter = new GoldListAdapter(mContext, new ArrayList<GoldListBean>(), getArguments().getString(Constants.IT_GOLD_TYPE_STR));\n        rvGoldList.setLayoutManager(new LinearLayoutManager(mContext));\n        rvGoldList.setAdapter(mAdapter);\n        rvGoldList.addItemDecoration(mDecoration);\n        rvGoldList.addOnScrollListener(new RecyclerView.OnScrollListener() {\n            @Override\n            public void onScrolled(RecyclerView recyclerView, int dx, int dy) {\n                super.onScrolled(recyclerView, dx, dy);\n                int lastVisibleItem = ((LinearLayoutManager) rvGoldList.getLayoutManager()).findLastVisibleItemPosition();\n                int totalItemCount = rvGoldList.getLayoutManager().getItemCount();\n                if (lastVisibleItem >= totalItemCount - 2 && dy > 0) {\n                    if(!isLoadingMore){\n                        isLoadingMore = true;\n                        mPresenter.getMoreGoldData();\n                    }\n                }\n            }\n        });\n        swipeRefresh.setOnRefreshListener(new SwipeRefreshLayout.OnRefreshListener() {\n            @Override\n            public void onRefresh() {\n                if (!mAdapter.getHotFlag()) {\n                    rvGoldList.addItemDecoration(mDecoration);\n                }\n                mAdapter.setHotFlag(true);\n                mPresenter.getGoldData(mType);\n            }\n        });\n        mAdapter.setOnHotCloseListener(new GoldListAdapter.OnHotCloseListener() {\n            @Override\n            public void onClose() {\n                rvGoldList.removeItemDecoration(mDecoration);\n            }\n        });\n        stateLoading();\n        mPresenter.getGoldData(mType);\n    }\n\n    @Override\n    public void showContent(List<GoldListBean> goldListBean) {\n        if(swipeRefresh.isRefreshing()) {\n            swipeRefresh.setRefreshing(false);\n        }\n        stateMain();\n        mAdapter.updateData(goldListBean);\n        mAdapter.notifyDataSetChanged();\n    }\n\n    @Override\n    public void showMoreContent(List<GoldListBean> goldMoreListBean, int start, int end) {\n        mAdapter.updateData(goldMoreListBean);\n        mAdapter.notifyItemRangeInserted(start, end);\n        isLoadingMore = false;\n    }\n\n    @Override\n    public void stateError() {\n        super.stateError();\n        if(swipeRefresh.isRefreshing()) {\n            swipeRefresh.setRefreshing(false);\n        }\n    }\n}\n'