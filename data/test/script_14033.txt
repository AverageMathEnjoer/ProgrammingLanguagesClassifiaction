b'context("linear_mu")\ntest_that("the use of linear model for fitting mu works as expected", {\n  set.seed(1)\n  dds <- makeExampleDESeqDataSet(n=100, m=4, interceptMean=10, interceptSD=3,\n                                 dispMeanRel=function(x) 0.5, sizeFactors=c(.5,1,1,2))\n  dds <- estimateSizeFactors(dds)\n  dds1 <- estimateDispersionsGeneEst(dds, linearMu=FALSE)\n  dds2 <- estimateDispersionsGeneEst(dds, linearMu=TRUE)\n  mu1 <- assays(dds1)[["mu"]]\n  mu2 <- assays(dds2)[["mu"]]\n  #par(mfrow=c(2,2),mar=c(3,3,1,1))\n  #for (i in 1:4) {\n    #plot(mu1[,i], mu2[,i], xlab="", ylab="", log="xy")\n    #abline(0,1)\n  #}\n  cors <- diag(cor(mu1, mu2, use="complete"))\n  expect_true(all(cors > 1 - 1e-6))\n  #\n  dds2 <- estimateDispersionsFit(dds2, fitType="mean")\n  dds2 <- estimateDispersionsMAP(dds2)\n  dds2 <- nbinomWaldTest(dds2)\n  res <- results(dds2)\n})\n'