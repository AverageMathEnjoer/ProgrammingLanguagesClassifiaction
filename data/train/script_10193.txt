b'{-# LANGUAGE OverloadedStrings #-}\n\nmodule Views where\n\nimport Control.Monad.IO.Class (liftIO)\nimport Data.List (sort)\nimport Data.Text.Lazy qualified as TL\nimport Paths_hoauth2_demo\nimport Text.Mustache\nimport Text.Parsec.Error\nimport Types\nimport Web.Scotty\n\ntype CookieUser = String\n\ntpl :: FilePath -> IO (Either ParseError Template)\ntpl f =\n  -- TODO: can work with cabal v2-run demo-server but not v2-exec\n  getDataFileName ("public/templates/" ++ f ++ ".mustache")\n    >>= localAutomaticCompile\n\ntplS ::\n  FilePath ->\n  [DemoAppEnv] ->\n  IO TL.Text\ntplS path xs = do\n  template <- tpl path\n  case template of\n    Left e ->\n      return $\n        TL.unlines $\n          map TL.pack ["can not parse template " ++ path ++ ".mustache", show e]\n    Right t\' -> return $ TL.fromStrict $ substitute t\' (TemplateData $ sort xs)\n\ntplH ::\n  FilePath ->\n  [DemoAppEnv] ->\n  ActionM ()\ntplH path xs = do\n  s <- liftIO (tplS path xs)\n  html s\n\noverviewTpl :: [DemoAppEnv] -> ActionM ()\noverviewTpl = tplH "index"\n'