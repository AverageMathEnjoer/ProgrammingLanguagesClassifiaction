b'\xef\xbb\xbfusing BaiduPanDownload.Forms;\nusing BaiduPanDownload.HttpTool.Download;\nusing BaiduPanDownload.Util.FileTool;\nusing System;\nusing System.Collections.Generic;\nusing System.IO;\nusing System.Linq;\nusing System.Net;\nusing System.Text;\nusing System.Text.RegularExpressions;\nusing System.Threading;\nusing System.Web;\nusing System.Windows.Forms;\n\nnamespace BaiduPanDownload.HttpTool\n{\n    class WebDownload\n    {\n\n        public void Listen()\n        {\n            ThreadPool.QueueUserWorkItem(new WaitCallback(Listener));\n        }\n        void Listener(object obj)\n        {\n            using (HttpListener Server = new HttpListener())\n            {\n                Server.AuthenticationSchemes = AuthenticationSchemes.Anonymous;\n                Server.Prefixes.Add("http://127.0.0.1:36728/Download/");\n                try\n                {\n                    Server.Start();\n                    while (true)\n                    {\n                        HttpListenerContext ctx = Server.GetContext();\n                        ctx.Response.StatusCode = 200;\n                        string Url = ctx.Request.QueryString["Url"];\n                        //\xe7\x9b\xb4\xe6\x8e\xa5\xe7\x94\xa8QueryString\xe4\xbc\x9a\xe4\xb9\xb1\xe7\xa0\x81\n                        string Name = HttpUtility.UrlDecode(GetData(ctx.Request.RawUrl, "&Name=", "&Cookies"));\n                        Name = Name.Split(\'/\')[Name.Split(\'/\').Length - 1];\n                        string Cookies = ctx.Request.QueryString["Cookies"];\n                        if (Url == null || Name == string.Empty || Cookies == null)\n                        {\n                            LogTool.WriteLogInfo(typeof(WebDownload), "\xe7\xbd\x91\xe9\xa1\xb5\xe7\x9b\x91\xe5\x90\xac\xe5\x99\xa8\xe6\x8e\xa5\xe6\x94\xb6\xe5\x88\xb0\xe9\x9d\x9e\xe6\xb3\x95\xe6\x95\xb0\xe6\x8d\xae");\n                            ctx.Response.Close();\n                            continue;\n                        }\n                        new Thread(() =>\n                        {\n                            new BaiduPanDownload.Forms.Download()\n                            {\n                                Url = Url,\n                                FileName = Name,\n                                Cookies = new CookiesData\n                                {\n                                    BDUSS = GetData(Cookies, "BDUSS=", ";pcsett="),\n                                    PCSETT = GetData(Cookies, ";pcsett=", "end")\n                                }\n                            }.ShowDialog();\n                        }).Start();\n                        ctx.Response.Close();\n                    }\n                }catch(Exception ex)\n                {\n                    LogTool.WriteLogError(typeof(WebDownload),"\xe7\x9b\x91\xe5\x90\xac\xe7\xbd\x91\xe9\xa1\xb5\xe8\xaf\xb7\xe6\xb1\x82\xe6\x97\xb6\xe5\x87\xba\xe7\x8e\xb0\xe9\x94\x99\xe8\xaf\xaf!",ex);\n                    MessageBox.Show("\xe7\x9b\x91\xe5\x90\xac\xe7\xbd\x91\xe9\xa1\xb5\xe8\xaf\xb7\xe6\xb1\x82\xe6\x97\xb6\xe5\x87\xba\xe7\x8e\xb0\xe9\x94\x99\xe8\xaf\xaf: "+ex.Message+"\\r\\n\xe8\xbf\x99\xe4\xb8\xaa\xe9\x94\x99\xe8\xaf\xaf\xe4\xbc\x9a\xe5\xaf\xbc\xe8\x87\xb4\xe6\x97\xa0\xe6\xb3\x95\xe7\x9b\x91\xe5\x90\xac\xe6\xb5\x8f\xe8\xa7\x88\xe5\x99\xa8\xe7\x9a\x84\xe4\xb8\x8b\xe8\xbd\xbd\xe8\xaf\xb7\xe6\xb1\x82,\xe4\xbd\x86\xe6\x98\xaf\xe4\xb8\x8d\xe5\xbd\xb1\xe5\x93\x8d\xe8\xbd\xaf\xe4\xbb\xb6\xe7\x9a\x84\xe6\xad\xa3\xe5\xb8\xb8\xe4\xbd\xbf\xe7\x94\xa8,\xe5\xa6\x82\xe6\x9e\x9c\xe4\xb8\x80\xe7\x9b\xb4\xe5\x87\xba\xe7\x8e\xb0\xe8\xbf\x99\xe4\xb8\xaa\xe9\x94\x99\xe8\xaf\xaf\xe8\xaf\xb7\xe5\x9c\xa8\xe8\xae\xbe\xe7\xbd\xae\xe9\x87\x8c\xe9\x9d\xa2\xe5\x85\xb3\xe9\x97\xad\xe7\x9b\x91\xe5\x90\xac");\n                }\n\n            }\n        }\n        string GetData(string str,string p1,string p2)\n        {\n            Regex rg = new Regex("(?<=(" + p1 + "))[.\\\\s\\\\S]*?(?=(" + p2 + "))", RegexOptions.Multiline | RegexOptions.Singleline);\n            return rg.Match(str).Value;\n        }\n    }\n}\n'