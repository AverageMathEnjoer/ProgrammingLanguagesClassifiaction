b'package com.codeest.geeknews.ui.wechat.fragment;\n\nimport android.support.v4.widget.SwipeRefreshLayout;\nimport android.support.v7.widget.LinearLayoutManager;\nimport android.support.v7.widget.RecyclerView;\n\nimport com.codeest.geeknews.R;\nimport com.codeest.geeknews.base.RootFragment;\nimport com.codeest.geeknews.model.bean.WXItemBean;\nimport com.codeest.geeknews.presenter.wechat.WechatPresenter;\nimport com.codeest.geeknews.base.contract.wechat.WechatContract;\nimport com.codeest.geeknews.ui.wechat.adapter.WechatAdapter;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport butterknife.BindView;\n\n/**\n * Created by codeest on 16/8/29.\n */\n\npublic class WechatMainFragment extends RootFragment<WechatPresenter> implements WechatContract.View {\n\n    @BindView(R.id.view_main)\n    RecyclerView rvWechatList;\n    @BindView(R.id.swipe_refresh)\n    SwipeRefreshLayout swipeRefresh;\n\n    WechatAdapter mAdapter;\n    List<WXItemBean> mList;\n\n    boolean isLoadingMore = false;\n\n    @Override\n    protected void initInject() {\n        getFragmentComponent().inject(this);\n    }\n\n    @Override\n    protected int getLayoutId() {\n        return R.layout.view_common_list;\n    }\n\n    @Override\n    protected void initEventAndData() {\n        super.initEventAndData();\n        mList = new ArrayList<>();\n        mAdapter = new WechatAdapter(mContext,mList);\n        rvWechatList.setLayoutManager(new LinearLayoutManager(mContext));\n        rvWechatList.setAdapter(mAdapter);\n        rvWechatList.addOnScrollListener(new RecyclerView.OnScrollListener() {\n            @Override\n            public void onScrolled(RecyclerView recyclerView, int dx, int dy) {\n                super.onScrolled(recyclerView, dx, dy);\n                int lastVisibleItem = ((LinearLayoutManager) rvWechatList.getLayoutManager()).findLastVisibleItemPosition();\n                int totalItemCount = rvWechatList.getLayoutManager().getItemCount();\n                if (lastVisibleItem >= totalItemCount - 2 && dy > 0) {  //\xe8\xbf\x98\xe5\x89\xa92\xe4\xb8\xaaItem\xe6\x97\xb6\xe5\x8a\xa0\xe8\xbd\xbd\xe6\x9b\xb4\xe5\xa4\x9a\n                    if(!isLoadingMore){\n                        isLoadingMore = true;\n                        mPresenter.getMoreWechatData();\n                    }\n                }\n            }\n        });\n        swipeRefresh.setOnRefreshListener(new SwipeRefreshLayout.OnRefreshListener() {\n            @Override\n            public void onRefresh() {\n                mPresenter.getWechatData();\n            }\n        });\n        stateLoading();\n        mPresenter.getWechatData();\n    }\n\n    @Override\n    public void showContent(List<WXItemBean> list) {\n        if(swipeRefresh.isRefreshing()) {\n            swipeRefresh.setRefreshing(false);\n        }\n        stateMain();\n        mList.clear();\n        mList.addAll(list);\n        mAdapter.notifyDataSetChanged();\n    }\n\n    @Override\n    public void showMoreContent(List<WXItemBean> list) {\n        stateMain();\n        mList.addAll(list);\n        mAdapter.notifyDataSetChanged();\n        isLoadingMore = false;\n    }\n\n    @Override\n    public void stateError() {\n        super.stateError();\n        if(swipeRefresh.isRefreshing()) {\n            swipeRefresh.setRefreshing(false);\n        }\n    }\n}\n'