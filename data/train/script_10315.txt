b'import com.github.eprendre.tingshu.utils.Book\nimport com.github.eprendre.tingshu.utils.Episode\nimport com.github.kittinunf.fuel.Fuel\nimport com.github.kittinunf.fuel.json.responseJson\nimport org.jsoup.Jsoup\nimport org.junit.Test\nimport java.net.URLEncoder\n\nclass BiliBiliTest {\n\n    @Test\n    fun bookDetail() {\n//        val url = "https://m.bilibili.com/video/BV1W54y1C7jc"\n//        val url = "https://m.bilibili.com/video/BV1Jf4y1C7m8"\n        val url = "https://m.bilibili.com/video/BV1Ft411W7Wp"\n        val doc = Jsoup.connect(url).testConfig(false).get()\n        val elements = doc.select(".m-video-part-new > ul > li")\n        val episodes = ArrayList<Episode>()\n        if (elements.isEmpty()) {\n            episodes.add(Episode("1p", url))\n        } else {\n            elements.forEachIndexed { index, element ->\n                val title = element.text()\n                val page = index + 1\n                episodes.add(Episode(title, "$url?p=$page"))\n            }\n        }\n\n        episodes.take(5).forEach {\n            println(it)\n        }\n        assert(episodes.size > 0)\n    }\n\n    @Test\n    fun search() {\n        val keywords = "\xe6\x88\x91\xe7\x9a\x84\xe5\x90\xac\xe4\xb9\xa6"\n        val page = 1\n        val encodedKeywords = URLEncoder.encode(keywords, "utf-8")\n\n        val url = "https://api.bilibili.com/x/web-interface/search/all/v2?keyword=${encodedKeywords}&page=${page}&pagesize=20"\n        val data = Fuel.get(url).responseJson().third.get().obj().getJSONObject("data")\n        val numPages = data.getInt("numPages")\n        val list = ArrayList<Book>()\n        val results = data.getJSONArray("result")\n        run loop@{\n            (0 until results.length()).forEach {\n                val result = results.getJSONObject(it)\n                if (result.getString("result_type") == "video") {\n                    val videos = result.getJSONArray("data")\n                    (0 until videos.length()).forEach { index ->\n                        val videoObj = videos.getJSONObject(index)\n                        val coverUrl = "https:" + videoObj.getString("pic")\n                        val title = videoObj.getString("title")\n                            .replace("<em class=\\"keyword\\">", "")\n                            .replace("</em>", "")\n                        val author = ""\n                        val artist = videoObj.getString("author")\n                        val bookUrl = "https://m.bilibili.com/video/" + videoObj.getString("bvid")\n                        val status = "\xe6\x92\xad\xe6\x94\xbe\xe6\xac\xa1\xe6\x95\xb0: " + videoObj.getInt("play")\n                        val intro = videoObj.getString("description")\n\n                        list.add(Book(coverUrl, bookUrl, title, author, artist).apply {\n                            this.status = status\n                            this.intro = intro\n//                            this.sourceId =\n                        })\n                    }\n                    return@loop\n                }\n            }\n        }\n        list.take(5).forEach {\n            println(it)\n        }\n        assert(list.size > 0)\n    }\n}'