b'package com.codeest.geeknews.ui.zhihu.adapter;\n\nimport android.content.Context;\nimport android.support.v4.content.ContextCompat;\nimport android.support.v7.widget.RecyclerView;\nimport android.text.SpannableString;\nimport android.text.Spanned;\nimport android.text.TextUtils;\nimport android.text.style.ForegroundColorSpan;\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.widget.TextView;\n\nimport com.codeest.geeknews.R;\nimport com.codeest.geeknews.component.ImageLoader;\nimport com.codeest.geeknews.model.bean.CommentBean;\nimport com.codeest.geeknews.util.DateUtil;\nimport com.codeest.geeknews.widget.CircleImageView;\n\nimport java.util.List;\n\nimport butterknife.BindView;\nimport butterknife.ButterKnife;\n\n/**\n * Created by codeest on 16/8/19.\n */\n\npublic class CommentAdapter extends RecyclerView.Adapter<CommentAdapter.ViewHolder>{\n\n    private LayoutInflater inflater;\n    private List<CommentBean.CommentsBean> mList;\n    private Context mContext;\n\n    private static final int STATE_NULL = 0;    //\xe6\x9c\xaa\xe7\x9f\xa5\n    private static final int STATE_NONE = 1;    //\xe6\x97\xa0\xe9\x9c\x80\xe5\xb1\x95\xe5\xbc\x80\n    private static final int STATE_EXPAND = 2;  //\xe5\xb7\xb2\xe5\xb1\x95\xe5\xbc\x80\n    private static final int STATE_SHRINK = 3;  //\xe5\xb7\xb2\xe6\x94\xb6\xe7\xbc\xa9\n\n    private static final int MAX_LINE = 2;  //\xe8\xb5\xb7\xe5\xa7\x8b\xe6\x9c\x80\xe5\xa4\x9a\xe6\x98\xbe\xe7\xa4\xba2\xe8\xa1\x8c\n\n    public CommentAdapter(Context mContext,List<CommentBean.CommentsBean> mList) {\n        this.mList = mList;\n        this.mContext = mContext;\n        inflater = LayoutInflater.from(mContext);\n    }\n\n    @Override\n    public ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {\n        return new ViewHolder(inflater.inflate(R.layout.item_comment,parent,false));\n    }\n\n    @Override\n    public void onBindViewHolder(final ViewHolder holder, int position) {\n        CommentBean.CommentsBean info = mList.get(position);\n        ImageLoader.load(mContext,info.getAvatar(),holder.civFace);\n        holder.tvName.setText(info.getAuthor());\n        holder.tvContent.setText(info.getContent());\n        holder.tvTime.setText(DateUtil.formatTime2String(info.getTime()));\n        holder.tvLike.setText(String.valueOf(info.getLikes()));\n        if (info.getReply_to() != null && info.getReply_to().getId() != 0) {\n            holder.tvReply.setVisibility(View.VISIBLE);\n            SpannableString ss = new SpannableString("@" + info.getReply_to().getAuthor() + ": " + info.getReply_to().getContent());\n            ss.setSpan(new ForegroundColorSpan(ContextCompat.getColor(mContext,R.color.comment_at)), 0,info.getReply_to().getAuthor().length() + 2 , Spanned.SPAN_INCLUSIVE_INCLUSIVE);\n//            holder.tvReply.setText(String.format("@%s: %s",info.getReply_to().getAuthor(),info.getReply_to().getContent()));\n            holder.tvReply.setText(ss);\n            if (info.getReply_to().getExpandState() == STATE_NULL) {    //\xe6\x9c\xaa\xe7\x9f\xa5\n                holder.tvReply.post(new Runnable() {\n                    @Override\n                    public void run() {\n                        if (holder.tvReply.getLineCount() > MAX_LINE) {\n                            holder.tvReply.setMaxLines(MAX_LINE);\n                            holder.tvExpand.setVisibility(View.VISIBLE);\n                            holder.tvExpand.setText("\xe5\xb1\x95\xe5\xbc\x80");\n                            mList.get(holder.getAdapterPosition()).getReply_to().setExpandState(STATE_SHRINK);\n                            holder.tvExpand.setOnClickListener(new OnStateClickListener(holder.getAdapterPosition(), holder.tvReply));\n                        } else {\n                            holder.tvExpand.setVisibility(View.GONE);\n                            mList.get(holder.getAdapterPosition()).getReply_to().setExpandState(STATE_NONE);\n                        }\n                    }\n                });\n            } else if(info.getReply_to().getExpandState() == STATE_NONE) {  //\xe6\x97\xa0\xe9\x9c\x80\xe5\xb1\x95\xe5\xbc\x80\n                holder.tvExpand.setVisibility(View.GONE);\n            } else if(info.getReply_to().getExpandState() == STATE_EXPAND) {    //\xe5\xb7\xb2\xe5\xb1\x95\xe5\xbc\x80\n                holder.tvReply.setMaxLines(Integer.MAX_VALUE);\n                holder.tvExpand.setText("\xe6\x94\xb6\xe8\xb5\xb7");\n                holder.tvExpand.setVisibility(View.VISIBLE);\n                holder.tvExpand.setOnClickListener(new OnStateClickListener(holder.getAdapterPosition(), holder.tvReply));\n            } else {    //\xe5\xb7\xb2\xe6\x94\xb6\xe7\xbc\xa9\n                holder.tvReply.setMaxLines(MAX_LINE);\n                holder.tvExpand.setText("\xe5\xb1\x95\xe5\xbc\x80");\n                holder.tvExpand.setVisibility(View.VISIBLE);\n                holder.tvExpand.setOnClickListener(new OnStateClickListener(holder.getAdapterPosition(), holder.tvReply));\n            }\n        } else {\n            holder.tvReply.setVisibility(View.GONE);\n            holder.tvExpand.setVisibility(View.GONE);\n        }\n    }\n\n    @Override\n    public int getItemCount() {\n        return mList.size();\n    }\n\n    private class OnStateClickListener implements View.OnClickListener {\n\n        TextView replyView;\n        int position;\n\n        public OnStateClickListener(int position,TextView replyView) {\n            this.position = position;\n            this.replyView = replyView;\n        }\n\n        @Override\n        public void onClick(View view) {\n            TextView tv = (TextView) view;\n            if (mList.get(position).getReply_to().getExpandState() == STATE_SHRINK) {\n                tv.setText("\xe6\x94\xb6\xe8\xb5\xb7");\n                replyView.setMaxLines(Integer.MAX_VALUE);\n                replyView.setEllipsize(null);\n                mList.get(position).getReply_to().setExpandState(STATE_EXPAND);\n            } else {\n                tv.setText("\xe5\xb1\x95\xe5\xbc\x80");\n                replyView.setMaxLines(MAX_LINE);\n                replyView.setEllipsize(TextUtils.TruncateAt.END);\n                mList.get(position).getReply_to().setExpandState(STATE_SHRINK);\n            }\n        }\n    }\n\n    public static class ViewHolder extends RecyclerView.ViewHolder{\n\n        @BindView(R.id.civ_comment_face)\n        CircleImageView civFace;\n        @BindView(R.id.tv_comment_name)\n        TextView tvName;\n        @BindView(R.id.tv_comment_content)\n        TextView tvContent;\n        @BindView(R.id.tv_comment_time)\n        TextView tvTime;\n        @BindView(R.id.tv_comment_expand)\n        TextView tvExpand;\n        @BindView(R.id.tv_comment_like)\n        TextView tvLike;\n        @BindView(R.id.tv_comment_reply)\n        TextView tvReply;\n\n        public ViewHolder(View itemView) {\n            super(itemView);\n            ButterKnife.bind(this,itemView);\n        }\n    }\n\n}\n'