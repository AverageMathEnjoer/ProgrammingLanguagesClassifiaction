b'package com.yyydjk.library;\n\nimport android.content.Context;\nimport android.content.res.TypedArray;\nimport android.support.annotation.NonNull;\nimport android.text.TextUtils;\nimport android.util.AttributeSet;\nimport android.util.DisplayMetrics;\nimport android.util.TypedValue;\nimport android.view.Gravity;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.view.animation.AnimationUtils;\nimport android.widget.FrameLayout;\nimport android.widget.LinearLayout;\nimport android.widget.TextView;\n\nimport java.util.List;\n\n\n/**\n * Created by dongjunkun on 2015/6/17.\n */\npublic class DropDownMenu extends LinearLayout {\n\n    //\xe9\xa1\xb6\xe9\x83\xa8\xe8\x8f\x9c\xe5\x8d\x95\xe5\xb8\x83\xe5\xb1\x80\n    private LinearLayout tabMenuView;\n    //\xe5\xba\x95\xe9\x83\xa8\xe5\xae\xb9\xe5\x99\xa8\xef\xbc\x8c\xe5\x8c\x85\xe5\x90\xabpopupMenuViews\xef\xbc\x8cmaskView\n    private FrameLayout containerView;\n    //\xe5\xbc\xb9\xe5\x87\xba\xe8\x8f\x9c\xe5\x8d\x95\xe7\x88\xb6\xe5\xb8\x83\xe5\xb1\x80\n    private FrameLayout popupMenuViews;\n    //\xe9\x81\xae\xe7\xbd\xa9\xe5\x8d\x8a\xe9\x80\x8f\xe6\x98\x8eView\xef\xbc\x8c\xe7\x82\xb9\xe5\x87\xbb\xe5\x8f\xaf\xe5\x85\xb3\xe9\x97\xadDropDownMenu\n    private View maskView;\n    //tabMenuView\xe9\x87\x8c\xe9\x9d\xa2\xe9\x80\x89\xe4\xb8\xad\xe7\x9a\x84tab\xe4\xbd\x8d\xe7\xbd\xae\xef\xbc\x8c-1\xe8\xa1\xa8\xe7\xa4\xba\xe6\x9c\xaa\xe9\x80\x89\xe4\xb8\xad\n    private int current_tab_position = -1;\n\n    //\xe5\x88\x86\xe5\x89\xb2\xe7\xba\xbf\xe9\xa2\x9c\xe8\x89\xb2\n    private int dividerColor = 0xffcccccc;\n    //tab\xe9\x80\x89\xe4\xb8\xad\xe9\xa2\x9c\xe8\x89\xb2\n    private int textSelectedColor = 0xff890c85;\n    //tab\xe6\x9c\xaa\xe9\x80\x89\xe4\xb8\xad\xe9\xa2\x9c\xe8\x89\xb2\n    private int textUnselectedColor = 0xff111111;\n    //\xe9\x81\xae\xe7\xbd\xa9\xe9\xa2\x9c\xe8\x89\xb2\n    private int maskColor = 0x88888888;\n    //tab\xe5\xad\x97\xe4\xbd\x93\xe5\xa4\xa7\xe5\xb0\x8f\n    private int menuTextSize = 14;\n\n    //tab\xe9\x80\x89\xe4\xb8\xad\xe5\x9b\xbe\xe6\xa0\x87\n    private int menuSelectedIcon;\n    //tab\xe6\x9c\xaa\xe9\x80\x89\xe4\xb8\xad\xe5\x9b\xbe\xe6\xa0\x87\n    private int menuUnselectedIcon;\n\n    private float menuHeighPercent = 0.5f;\n\n\n    public DropDownMenu(Context context) {\n        super(context, null);\n    }\n\n    public DropDownMenu(Context context, AttributeSet attrs) {\n        this(context, attrs, 0);\n    }\n\n    public DropDownMenu(Context context, AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n\n        setOrientation(VERTICAL);\n\n        //\xe4\xb8\xbaDropDownMenu\xe6\xb7\xbb\xe5\x8a\xa0\xe8\x87\xaa\xe5\xae\x9a\xe4\xb9\x89\xe5\xb1\x9e\xe6\x80\xa7\n        int menuBackgroundColor = 0xffffffff;\n        int underlineColor = 0xffcccccc;\n        TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.DropDownMenu);\n        underlineColor = a.getColor(R.styleable.DropDownMenu_ddunderlineColor, underlineColor);\n        dividerColor = a.getColor(R.styleable.DropDownMenu_dddividerColor, dividerColor);\n        textSelectedColor = a.getColor(R.styleable.DropDownMenu_ddtextSelectedColor, textSelectedColor);\n        textUnselectedColor = a.getColor(R.styleable.DropDownMenu_ddtextUnselectedColor, textUnselectedColor);\n        menuBackgroundColor = a.getColor(R.styleable.DropDownMenu_ddmenuBackgroundColor, menuBackgroundColor);\n        maskColor = a.getColor(R.styleable.DropDownMenu_ddmaskColor, maskColor);\n        menuTextSize = a.getDimensionPixelSize(R.styleable.DropDownMenu_ddmenuTextSize, menuTextSize);\n        menuSelectedIcon = a.getResourceId(R.styleable.DropDownMenu_ddmenuSelectedIcon, menuSelectedIcon);\n        menuUnselectedIcon = a.getResourceId(R.styleable.DropDownMenu_ddmenuUnselectedIcon, menuUnselectedIcon);\n        menuHeighPercent = a.getFloat(R.styleable.DropDownMenu_ddmenuMenuHeightPercent,menuHeighPercent);\n        a.recycle();\n\n        //\xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96tabMenuView\xe5\xb9\xb6\xe6\xb7\xbb\xe5\x8a\xa0\xe5\x88\xb0tabMenuView\n        tabMenuView = new LinearLayout(context);\n        LayoutParams params = new LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.WRAP_CONTENT);\n        tabMenuView.setOrientation(HORIZONTAL);\n        tabMenuView.setBackgroundColor(menuBackgroundColor);\n        tabMenuView.setLayoutParams(params);\n        addView(tabMenuView, 0);\n\n        //\xe4\xb8\xbatabMenuView\xe6\xb7\xbb\xe5\x8a\xa0\xe4\xb8\x8b\xe5\x88\x92\xe7\xba\xbf\n        View underLine = new View(getContext());\n        underLine.setLayoutParams(new LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, dpTpPx(1.0f)));\n        underLine.setBackgroundColor(underlineColor);\n        addView(underLine, 1);\n\n        //\xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96containerView\xe5\xb9\xb6\xe5\xb0\x86\xe5\x85\xb6\xe6\xb7\xbb\xe5\x8a\xa0\xe5\x88\xb0DropDownMenu\n        containerView = new FrameLayout(context);\n        containerView.setLayoutParams(new FrameLayout.LayoutParams(FrameLayout.LayoutParams.MATCH_PARENT, FrameLayout.LayoutParams.MATCH_PARENT));\n        addView(containerView, 2);\n\n    }\n\n    /**\n     * \xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96DropDownMenu\n     *\n     * @param tabTexts\n     * @param popupViews\n     * @param contentView\n     */\n    public void setDropDownMenu(@NonNull List<String> tabTexts, @NonNull List<View> popupViews, @NonNull View contentView) {\n        if (tabTexts.size() != popupViews.size()) {\n            throw new IllegalArgumentException("params not match, tabTexts.size() should be equal popupViews.size()");\n        }\n\n        for (int i = 0; i < tabTexts.size(); i++) {\n            addTab(tabTexts, i);\n        }\n        containerView.addView(contentView, 0);\n\n        maskView = new View(getContext());\n        maskView.setLayoutParams(new FrameLayout.LayoutParams(FrameLayout.LayoutParams.MATCH_PARENT, FrameLayout.LayoutParams.MATCH_PARENT));\n        maskView.setBackgroundColor(maskColor);\n        maskView.setOnClickListener(new OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                closeMenu();\n            }\n        });\n        containerView.addView(maskView, 1);\n        maskView.setVisibility(GONE);\n        if (containerView.getChildAt(2) != null){\n            containerView.removeViewAt(2);\n        }\n\n        popupMenuViews = new FrameLayout(getContext());\n        popupMenuViews.setLayoutParams(new FrameLayout.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, (int) (DeviceUtils.getScreenSize(getContext()).y*menuHeighPercent)));\n        popupMenuViews.setVisibility(GONE);\n        containerView.addView(popupMenuViews, 2);\n\n        for (int i = 0; i < popupViews.size(); i++) {\n            popupViews.get(i).setLayoutParams(new ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.WRAP_CONTENT));\n            popupMenuViews.addView(popupViews.get(i), i);\n        }\n\n    }\n\n    private void addTab(@NonNull List<String> tabTexts, int i) {\n        final TextView tab = new TextView(getContext());\n        tab.setSingleLine();\n        tab.setEllipsize(TextUtils.TruncateAt.END);\n        tab.setGravity(Gravity.CENTER);\n        tab.setTextSize(TypedValue.COMPLEX_UNIT_PX,menuTextSize);\n        tab.setLayoutParams(new LayoutParams(0, ViewGroup.LayoutParams.WRAP_CONTENT, 1.0f));\n        tab.setTextColor(textUnselectedColor);\n        tab.setCompoundDrawablesWithIntrinsicBounds(null, null, getResources().getDrawable(menuUnselectedIcon), null);\n        tab.setText(tabTexts.get(i));\n        tab.setPadding(dpTpPx(5), dpTpPx(12), dpTpPx(5), dpTpPx(12));\n        //\xe6\xb7\xbb\xe5\x8a\xa0\xe7\x82\xb9\xe5\x87\xbb\xe4\xba\x8b\xe4\xbb\xb6\n        tab.setOnClickListener(new OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                switchMenu(tab);\n            }\n        });\n        tabMenuView.addView(tab);\n        //\xe6\xb7\xbb\xe5\x8a\xa0\xe5\x88\x86\xe5\x89\xb2\xe7\xba\xbf\n        if (i < tabTexts.size() - 1) {\n            View view = new View(getContext());\n            view.setLayoutParams(new LayoutParams(dpTpPx(0.5f), ViewGroup.LayoutParams.MATCH_PARENT));\n            view.setBackgroundColor(dividerColor);\n            tabMenuView.addView(view);\n        }\n    }\n\n    /**\n     * \xe6\x94\xb9\xe5\x8f\x98tab\xe6\x96\x87\xe5\xad\x97\n     *\n     * @param text\n     */\n    public void setTabText(String text) {\n        if (current_tab_position != -1) {\n            ((TextView) tabMenuView.getChildAt(current_tab_position)).setText(text);\n        }\n    }\n\n    public void setTabClickable(boolean clickable) {\n        for (int i = 0; i < tabMenuView.getChildCount(); i = i + 2) {\n            tabMenuView.getChildAt(i).setClickable(clickable);\n        }\n    }\n\n    /**\n     * \xe5\x85\xb3\xe9\x97\xad\xe8\x8f\x9c\xe5\x8d\x95\n     */\n    public void closeMenu() {\n        if (current_tab_position != -1) {\n            ((TextView) tabMenuView.getChildAt(current_tab_position)).setTextColor(textUnselectedColor);\n            ((TextView) tabMenuView.getChildAt(current_tab_position)).setCompoundDrawablesWithIntrinsicBounds(null, null,\n                    getResources().getDrawable(menuUnselectedIcon), null);\n            popupMenuViews.setVisibility(View.GONE);\n            popupMenuViews.setAnimation(AnimationUtils.loadAnimation(getContext(), R.anim.dd_menu_out));\n            maskView.setVisibility(GONE);\n            maskView.setAnimation(AnimationUtils.loadAnimation(getContext(), R.anim.dd_mask_out));\n            current_tab_position = -1;\n        }\n\n    }\n\n    /**\n     * DropDownMenu\xe6\x98\xaf\xe5\x90\xa6\xe5\xa4\x84\xe4\xba\x8e\xe5\x8f\xaf\xe8\xa7\x81\xe7\x8a\xb6\xe6\x80\x81\n     *\n     * @return\n     */\n    public boolean isShowing() {\n        return current_tab_position != -1;\n    }\n\n    /**\n     * \xe5\x88\x87\xe6\x8d\xa2\xe8\x8f\x9c\xe5\x8d\x95\n     *\n     * @param target\n     */\n    private void switchMenu(View target) {\n        System.out.println(current_tab_position);\n        for (int i = 0; i < tabMenuView.getChildCount(); i = i + 2) {\n            if (target == tabMenuView.getChildAt(i)) {\n                if (current_tab_position == i) {\n                    closeMenu();\n                } else {\n                    if (current_tab_position == -1) {\n                        popupMenuViews.setVisibility(View.VISIBLE);\n                        popupMenuViews.setAnimation(AnimationUtils.loadAnimation(getContext(), R.anim.dd_menu_in));\n                        maskView.setVisibility(VISIBLE);\n                        maskView.setAnimation(AnimationUtils.loadAnimation(getContext(), R.anim.dd_mask_in));\n                        popupMenuViews.getChildAt(i / 2).setVisibility(View.VISIBLE);\n                    } else {\n                        popupMenuViews.getChildAt(i / 2).setVisibility(View.VISIBLE);\n                    }\n                    current_tab_position = i;\n                    ((TextView) tabMenuView.getChildAt(i)).setTextColor(textSelectedColor);\n                    ((TextView) tabMenuView.getChildAt(i)).setCompoundDrawablesWithIntrinsicBounds(null, null,\n                            getResources().getDrawable(menuSelectedIcon), null);\n                }\n            } else {\n                ((TextView) tabMenuView.getChildAt(i)).setTextColor(textUnselectedColor);\n                ((TextView) tabMenuView.getChildAt(i)).setCompoundDrawablesWithIntrinsicBounds(null, null,\n                        getResources().getDrawable(menuUnselectedIcon), null);\n                popupMenuViews.getChildAt(i / 2).setVisibility(View.GONE);\n            }\n        }\n    }\n\n    public int dpTpPx(float value) {\n        DisplayMetrics dm = getResources().getDisplayMetrics();\n        return (int) (TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, value, dm) + 0.5);\n    }\n}\n'