b'package com.codeest.geeknews.ui.gank.fragment;\n\nimport android.app.ActivityOptions;\nimport android.content.Intent;\nimport android.support.v4.widget.SwipeRefreshLayout;\nimport android.support.v7.widget.RecyclerView;\nimport android.support.v7.widget.StaggeredGridLayoutManager;\nimport android.view.View;\n\nimport com.codeest.geeknews.R;\nimport com.codeest.geeknews.app.Constants;\nimport com.codeest.geeknews.base.BaseFragment;\nimport com.codeest.geeknews.model.bean.GankItemBean;\nimport com.codeest.geeknews.presenter.gank.GirlPresenter;\nimport com.codeest.geeknews.base.contract.gank.GirlContract;\nimport com.codeest.geeknews.ui.gank.activity.GirlDetailActivity;\nimport com.codeest.geeknews.ui.gank.adapter.GirlAdapter;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport butterknife.BindView;\n\n/**\n * Created by codeest on 16/8/19.\n */\n\npublic class GirlFragment extends BaseFragment<GirlPresenter> implements GirlContract.View {\n\n    @BindView(R.id.view_main)\n    RecyclerView rvGirlContent;\n    @BindView(R.id.swipe_refresh)\n    SwipeRefreshLayout swipeRefresh;\n\n    private static final int SPAN_COUNT = 2;\n\n    GirlAdapter mAdapter;\n    List<GankItemBean> mList;\n    StaggeredGridLayoutManager mStaggeredGridLayoutManager;\n\n    private boolean isLoadingMore = false;\n\n    @Override\n    protected void initInject() {\n        getFragmentComponent().inject(this);\n    }\n\n    @Override\n    protected int getLayoutId() {\n        return R.layout.view_common_list;\n    }\n\n    @Override\n    protected void initEventAndData() {\n        mList = new ArrayList<>();\n        mAdapter = new GirlAdapter(mContext, mList);\n        mStaggeredGridLayoutManager = new StaggeredGridLayoutManager(SPAN_COUNT,StaggeredGridLayoutManager.VERTICAL);\n        mStaggeredGridLayoutManager.setGapStrategy(StaggeredGridLayoutManager.GAP_HANDLING_NONE);\n        //fix issue #52 https://github.com/codeestX/GeekNews/issues/52\n        mStaggeredGridLayoutManager.setItemPrefetchEnabled(false);\n        rvGirlContent.setLayoutManager(mStaggeredGridLayoutManager);\n        rvGirlContent.setAdapter(mAdapter);\n        swipeRefresh.setOnRefreshListener(new SwipeRefreshLayout.OnRefreshListener() {\n            @Override\n            public void onRefresh() {\n                mPresenter.getGirlData();\n            }\n        });\n        rvGirlContent.addOnScrollListener(new RecyclerView.OnScrollListener() {\n            @Override\n            public void onScrolled(RecyclerView recyclerView, int dx, int dy) {\n                super.onScrolled(recyclerView, dx, dy);\n                int[] visibleItems = mStaggeredGridLayoutManager.findLastVisibleItemPositions(null);\n                int lastItem = Math.max(visibleItems[0],visibleItems[1]);\n                if (lastItem > mAdapter.getItemCount() - 5 && !isLoadingMore && dy > 0 ) {\n                    isLoadingMore = true;\n                    mPresenter.getMoreGirlData();\n                }\n            }\n        });\n        mAdapter.setOnItemClickListener(new GirlAdapter.OnItemClickListener() {\n            @Override\n            public void onItemClickListener(int position, View shareView) {\n                Intent intent = new Intent();\n                intent.setClass(mContext, GirlDetailActivity.class);\n                intent.putExtra(Constants.IT_GANK_GRIL_URL, mList.get(position).getUrl());\n                intent.putExtra(Constants.IT_GANK_GRIL_ID, mList.get(position).get_id());\n                ActivityOptions options = ActivityOptions.makeSceneTransitionAnimation(mActivity, shareView, "shareView");\n                mContext.startActivity(intent,options.toBundle());\n            }\n        });\n        stateLoading();\n        mPresenter.getGirlData();\n    }\n\n    @Override\n    public void stateError() {\n        super.stateError();\n        if (swipeRefresh.isRefreshing()) {\n            swipeRefresh.setRefreshing(false);\n        }\n    }\n\n    @Override\n    public void showContent(List<GankItemBean> list) {\n        if (swipeRefresh.isRefreshing()) {\n            swipeRefresh.setRefreshing(false);\n        }\n        stateMain();\n        mList.clear();\n        mList.addAll(list);\n        mAdapter.notifyDataSetChanged();\n    }\n\n    @Override\n    public void showMoreContent(List<GankItemBean> list) {\n        isLoadingMore = false;\n        mList.addAll(list);\n        for(int i =mList.size() - GirlPresenter.NUM_OF_PAGE ; i < mList.size(); i++) {    //\xe4\xbd\xbf\xe7\x94\xa8notifyDataSetChanged\xe5\xb7\xb2\xe5\x8a\xa0\xe8\xbd\xbd\xe7\x9a\x84\xe5\x9b\xbe\xe7\x89\x87\xe4\xbc\x9a\xe6\x9c\x89\xe9\x97\xaa\xe7\x83\x81\xef\xbc\x8c\xe9\x81\x82\xe4\xbd\xbf\xe7\x94\xa8inserted\xe9\x80\x90\xe4\xb8\xaa\xe6\x8f\x92\xe5\x85\xa5\n            mAdapter.notifyItemInserted(i);\n        }\n    }\n}\n'