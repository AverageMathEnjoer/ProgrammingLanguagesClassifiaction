b'\xef\xbb\xbfusing System;\nusing System.Collections.Generic;\nusing System.Net;\nusing System.Text;\nusing System.Threading.Tasks;\nusing FluentValidation;\nusing Microsoft.AspNetCore.Http;\n\nnamespace Core.Extensions\n{\n    public class ExceptionMiddleware\n    {\n        private RequestDelegate _next;\n\n        public ExceptionMiddleware(RequestDelegate next)\n        {\n            _next = next;\n        }\n\n        public async Task InvokeAsync(HttpContext httpContext)\n        {\n            try\n            {\n                await _next(httpContext);\n            }\n            catch (Exception e)\n            {\n                await HandleExceptionAsync(httpContext,e);\n            }\n        }\n\n        private Task HandleExceptionAsync(HttpContext httpContext, Exception e)\n        {\n            httpContext.Response.ContentType = "application/json";\n            httpContext.Response.StatusCode = (int) HttpStatusCode.InternalServerError;\n\n            string message = "Internal Server Error";\n            if (e.GetType()==typeof(ValidationException))\n            {\n                message = e.Message;\n            }\n\n            return httpContext.Response.WriteAsync(new ErrorDetails\n            {\n                StatusCode = httpContext.Response.StatusCode,\n                Message = message\n            }.ToString());\n        }\n    }\n}\n'