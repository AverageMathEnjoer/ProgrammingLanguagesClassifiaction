b'package com.quyunshuo.androidbaseframemvvm.common\n\nimport android.annotation.SuppressLint\nimport android.app.Application\nimport android.content.Context\nimport android.util.Log\nimport com.alibaba.android.arouter.launcher.ARouter\nimport com.google.auto.service.AutoService\nimport com.quyunshuo.androidbaseframemvvm.base.app.ApplicationLifecycle\nimport com.quyunshuo.androidbaseframemvvm.base.BaseApplication\nimport com.quyunshuo.androidbaseframemvvm.base.constant.VersionStatus\nimport com.quyunshuo.androidbaseframemvvm.base.utils.ProcessUtils\nimport com.quyunshuo.androidbaseframemvvm.base.utils.SpUtils\nimport com.quyunshuo.androidbaseframemvvm.base.utils.network.NetworkStateClient\nimport com.tencent.bugly.crashreport.CrashReport\nimport com.tencent.smtt.export.external.TbsCoreSettings\nimport com.tencent.smtt.sdk.QbSdk\nimport com.tencent.smtt.sdk.QbSdk.PreInitCallback\n\n/**\n * \xe9\xa1\xb9\xe7\x9b\xae\xe7\x9b\xb8\xe5\x85\xb3\xe7\x9a\x84Application\n *\n * @author Qu Yunshuo\n * @since 4/16/21 3:37 PM\n */\n@AutoService(ApplicationLifecycle::class)\nclass CommonApplication : ApplicationLifecycle {\n\n    companion object {\n        // \xe5\x85\xa8\xe5\xb1\x80CommonApplication\n        @SuppressLint("StaticFieldLeak")\n        lateinit var mCommonApplication: CommonApplication\n    }\n\n    /**\n     * \xe5\x90\x8c[Application.attachBaseContext]\n     * @param context Context\n     */\n    override fun onAttachBaseContext(context: Context) {\n        mCommonApplication = this\n    }\n\n    /**\n     * \xe5\x90\x8c[Application.onCreate]\n     * @param application Application\n     */\n    override fun onCreate(application: Application) {}\n\n    /**\n     * \xe5\x90\x8c[Application.onTerminate]\n     * @param application Application\n     */\n    override fun onTerminate(application: Application) {}\n\n    /**\n     * \xe4\xb8\xbb\xe7\xba\xbf\xe7\xa8\x8b\xe5\x89\x8d\xe5\x8f\xb0\xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96\n     * @return MutableList<() -> String> \xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96\xe6\x96\xb9\xe6\xb3\x95\xe9\x9b\x86\xe5\x90\x88\n     */\n    override fun initByFrontDesk(): MutableList<() -> String> {\n        val list = mutableListOf<() -> String>()\n        // \xe4\xbb\xa5\xe4\xb8\x8b\xe5\x8f\xaa\xe9\x9c\x80\xe8\xa6\x81\xe5\x9c\xa8\xe4\xb8\xbb\xe8\xbf\x9b\xe7\xa8\x8b\xe5\xbd\x93\xe4\xb8\xad\xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96 \xe6\x8c\x89\xe9\x9c\x80\xe8\xa6\x81\xe8\xb0\x83\xe6\x95\xb4\n        if (ProcessUtils.isMainProcess(BaseApplication.context)) {\n            list.add { initMMKV() }\n            list.add { initARouter() }\n            list.add { initNetworkStateClient() }\n        }\n        list.add { initTencentBugly() }\n        return list\n    }\n\n    /**\n     * \xe4\xb8\x8d\xe9\x9c\x80\xe8\xa6\x81\xe7\xab\x8b\xe5\x8d\xb3\xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96\xe7\x9a\x84\xe6\x94\xbe\xe5\x9c\xa8\xe8\xbf\x99\xe9\x87\x8c\xe8\xbf\x9b\xe8\xa1\x8c\xe5\x90\x8e\xe5\x8f\xb0\xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96\n     */\n    override fun initByBackstage() {\n        initX5WebViewCore()\n    }\n\n    /**\n     * \xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96\xe7\xbd\x91\xe7\xbb\x9c\xe7\x8a\xb6\xe6\x80\x81\xe7\x9b\x91\xe5\x90\xac\xe5\xae\xa2\xe6\x88\xb7\xe7\xab\xaf\n     * @return Unit\n     */\n    private fun initNetworkStateClient(): String {\n        NetworkStateClient.register()\n        return "NetworkStateClient -->> init complete"\n    }\n\n    /**\n     * \xe8\x85\xbe\xe8\xae\xafTBS WebView X5 \xe5\x86\x85\xe6\xa0\xb8\xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96\n     */\n    private fun initX5WebViewCore() {\n        // dex2oat\xe4\xbc\x98\xe5\x8c\x96\xe6\x96\xb9\xe6\xa1\x88\n        val map = HashMap<String, Any>()\n        map[TbsCoreSettings.TBS_SETTINGS_USE_SPEEDY_CLASSLOADER] = true\n        map[TbsCoreSettings.TBS_SETTINGS_USE_DEXLOADER_SERVICE] = true\n        QbSdk.initTbsSettings(map)\n\n        // \xe5\x85\x81\xe8\xae\xb8\xe4\xbd\xbf\xe7\x94\xa8\xe9\x9d\x9ewifi\xe7\xbd\x91\xe7\xbb\x9c\xe8\xbf\x9b\xe8\xa1\x8c\xe4\xb8\x8b\xe8\xbd\xbd\n        QbSdk.setDownloadWithoutWifi(true)\n\n        // \xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96\n        QbSdk.initX5Environment(BaseApplication.context, object : PreInitCallback {\n\n            override fun onCoreInitFinished() {\n                Log.d("ApplicationInit", " TBS X5 init finished")\n            }\n\n            override fun onViewInitFinished(p0: Boolean) {\n                // \xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96\xe5\xae\x8c\xe6\x88\x90\xe7\x9a\x84\xe5\x9b\x9e\xe8\xb0\x83\xef\xbc\x8c\xe4\xb8\xbatrue\xe8\xa1\xa8\xe7\xa4\xbax5\xe5\x86\x85\xe6\xa0\xb8\xe5\x8a\xa0\xe8\xbd\xbd\xe6\x88\x90\xe5\x8a\x9f\xef\xbc\x8c\xe5\x90\xa6\xe5\x88\x99\xe8\xa1\xa8\xe7\xa4\xbax5\xe5\x86\x85\xe6\xa0\xb8\xe5\x8a\xa0\xe8\xbd\xbd\xe5\xa4\xb1\xe8\xb4\xa5\xef\xbc\x8c\xe4\xbc\x9a\xe8\x87\xaa\xe5\x8a\xa8\xe5\x88\x87\xe6\x8d\xa2\xe5\x88\xb0\xe7\xb3\xbb\xe7\xbb\x9f\xe5\x86\x85\xe6\xa0\xb8\n                Log.d("ApplicationInit", " TBS X5 init is $p0")\n            }\n        })\n    }\n\n    /**\n     * \xe8\x85\xbe\xe8\xae\xaf MMKV \xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96\n     */\n    private fun initMMKV(): String {\n        val result = SpUtils.initMMKV(BaseApplication.context)\n        return "MMKV -->> $result"\n    }\n\n    /**\n     * \xe9\x98\xbf\xe9\x87\x8c\xe8\xb7\xaf\xe7\x94\xb1 ARouter \xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96\n     */\n    private fun initARouter(): String {\n        // \xe6\xb5\x8b\xe8\xaf\x95\xe7\x8e\xaf\xe5\xa2\x83\xe4\xb8\x8b\xe6\x89\x93\xe5\xbc\x80ARouter\xe7\x9a\x84\xe6\x97\xa5\xe5\xbf\x97\xe5\x92\x8c\xe8\xb0\x83\xe8\xaf\x95\xe6\xa8\xa1\xe5\xbc\x8f \xe6\xad\xa3\xe5\xbc\x8f\xe7\x8e\xaf\xe5\xa2\x83\xe9\x9c\x80\xe8\xa6\x81\xe5\x85\xb3\xe9\x97\xad\n        if (BuildConfig.VERSION_TYPE != VersionStatus.RELEASE) {\n            ARouter.openLog()     // \xe6\x89\x93\xe5\x8d\xb0\xe6\x97\xa5\xe5\xbf\x97\n            ARouter.openDebug()   // \xe5\xbc\x80\xe5\x90\xaf\xe8\xb0\x83\xe8\xaf\x95\xe6\xa8\xa1\xe5\xbc\x8f(\xe5\xa6\x82\xe6\x9e\x9c\xe5\x9c\xa8InstantRun\xe6\xa8\xa1\xe5\xbc\x8f\xe4\xb8\x8b\xe8\xbf\x90\xe8\xa1\x8c\xef\xbc\x8c\xe5\xbf\x85\xe9\xa1\xbb\xe5\xbc\x80\xe5\x90\xaf\xe8\xb0\x83\xe8\xaf\x95\xe6\xa8\xa1\xe5\xbc\x8f\xef\xbc\x81\xe7\xba\xbf\xe4\xb8\x8a\xe7\x89\x88\xe6\x9c\xac\xe9\x9c\x80\xe8\xa6\x81\xe5\x85\xb3\xe9\x97\xad,\xe5\x90\xa6\xe5\x88\x99\xe6\x9c\x89\xe5\xae\x89\xe5\x85\xa8\xe9\xa3\x8e\xe9\x99\xa9)\n        }\n        ARouter.init(BaseApplication.application)\n        return "ARouter -->> init complete"\n    }\n\n    /**\n     * \xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96 \xe8\x85\xbe\xe8\xae\xafBugly\n     * \xe6\xb5\x8b\xe8\xaf\x95\xe7\x8e\xaf\xe5\xa2\x83\xe5\xba\x94\xe8\xaf\xa5\xe4\xb8\x8e\xe6\xad\xa3\xe5\xbc\x8f\xe7\x8e\xaf\xe5\xa2\x83\xe7\x9a\x84\xe6\x97\xa5\xe5\xbf\x97\xe6\x94\xb6\xe9\x9b\x86\xe6\xb8\xa0\xe9\x81\x93\xe5\x88\x86\xe9\x9a\x94\xe5\xbc\x80\n     * \xe7\x9b\xae\xe5\x89\x8d\xe6\x9c\x89\xe4\xb8\xa4\xe4\xb8\xaa\xe6\xb8\xa0\xe9\x81\x93 \xe6\xb5\x8b\xe8\xaf\x95\xe7\x89\x88\xe6\x9c\xac/\xe6\xad\xa3\xe5\xbc\x8f\xe7\x89\x88\xe6\x9c\xac\n     */\n    private fun initTencentBugly(): String {\n        // \xe7\xac\xac\xe4\xb8\x89\xe4\xb8\xaa\xe5\x8f\x82\xe6\x95\xb0\xe4\xb8\xbaSDK\xe8\xb0\x83\xe8\xaf\x95\xe6\xa8\xa1\xe5\xbc\x8f\xe5\xbc\x80\xe5\x85\xb3\n        CrashReport.initCrashReport(\n            BaseApplication.context,\n            BaseApplication.context.getString(R.string.BUGLY_APP_ID),\n            BuildConfig.VERSION_TYPE != VersionStatus.RELEASE\n        )\n        return "Bugly -->> init complete"\n    }\n}'