b'package com.naman14.timber.fragments;\n\nimport android.app.Activity;\nimport android.content.Context;\nimport android.os.AsyncTask;\nimport android.os.Bundle;\nimport android.preference.PreferenceManager;\nimport androidx.fragment.app.Fragment;\nimport androidx.appcompat.app.ActionBar;\nimport androidx.appcompat.app.AppCompatActivity;\nimport androidx.recyclerview.widget.LinearLayoutManager;\nimport androidx.recyclerview.widget.RecyclerView;\nimport androidx.appcompat.widget.Toolbar;\nimport android.view.LayoutInflater;\nimport android.view.Menu;\nimport android.view.MenuInflater;\nimport android.view.MenuItem;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.widget.ProgressBar;\n\nimport com.afollestad.appthemeengine.ATE;\nimport com.naman14.timber.R;\nimport com.naman14.timber.adapters.FolderAdapter;\nimport com.naman14.timber.dialogs.StorageSelectDialog;\nimport com.naman14.timber.utils.PreferencesUtility;\nimport com.naman14.timber.widgets.DividerItemDecoration;\nimport com.naman14.timber.widgets.FastScroller;\n\nimport java.io.File;\n\n/**\n * Created by nv95 on 10.11.16.\n */\n\npublic class FoldersFragment extends Fragment implements StorageSelectDialog.OnDirSelectListener {\n\n    private FolderAdapter mAdapter;\n    private RecyclerView recyclerView;\n    private FastScroller fastScroller;\n    private ProgressBar mProgressBar;\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n        View rootView = inflater.inflate(\n                R.layout.fragment_folders, container, false);\n\n        Toolbar toolbar = (Toolbar) rootView.findViewById(R.id.toolbar);\n        ((AppCompatActivity) getActivity()).setSupportActionBar(toolbar);\n\n        ActionBar ab = ((AppCompatActivity) getActivity()).getSupportActionBar();\n        ab.setHomeAsUpIndicator(R.drawable.ic_menu);\n        ab.setDisplayHomeAsUpEnabled(true);\n        ab.setTitle(R.string.folders);\n\n        recyclerView = (RecyclerView) rootView.findViewById(R.id.recyclerview);\n        fastScroller = (FastScroller) rootView.findViewById(R.id.fastscroller);\n        mProgressBar = (ProgressBar) rootView.findViewById(R.id.progressBar);\n\n        recyclerView.setLayoutManager(new LinearLayoutManager(getActivity()));\n\n        if (getActivity() != null)\n            new loadFolders().execute("");\n        return rootView;\n    }\n\n    @Override\n    public void onViewCreated(View view, Bundle savedInstanceState) {\n        super.onViewCreated(view, savedInstanceState);\n        boolean dark = PreferenceManager.getDefaultSharedPreferences(getActivity()).getBoolean("dark_theme", false);\n        if (dark) {\n            ATE.apply(this, "dark_theme");\n        } else {\n            ATE.apply(this, "light_theme");\n        }\n        if (mAdapter != null) {\n            mAdapter.applyTheme(dark);\n            mAdapter.notifyDataSetChanged();\n        }\n    }\n\n    private void setItemDecoration() {\n        recyclerView.addItemDecoration(new DividerItemDecoration(getActivity(), DividerItemDecoration.VERTICAL_LIST));\n    }\n\n    @Override\n    public void onActivityCreated(final Bundle savedInstanceState) {\n        super.onActivityCreated(savedInstanceState);\n        setHasOptionsMenu(true);\n    }\n\n    @Override\n    public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {\n        super.onCreateOptionsMenu(menu, inflater);\n        inflater.inflate(R.menu.menu_folders, menu);\n    }\n\n    @Override\n    public boolean onOptionsItemSelected(MenuItem item) {\n        if (item.getItemId() == R.id.action_storages) {\n            new StorageSelectDialog(getActivity())\n                    .setDirSelectListener(this)\n                    .show();\n        }\n        return super.onOptionsItemSelected(item);\n    }\n\n    public void updateTheme() {\n        Context context = getActivity();\n        if (context != null) {\n            boolean dark = PreferenceManager.getDefaultSharedPreferences(context).getBoolean("dark_theme", false);\n            mAdapter.applyTheme(dark);\n        }\n    }\n\n    @Override\n    public void onDirSelected(File dir) {\n        mAdapter.updateDataSetAsync(dir);\n    }\n\n    private class loadFolders extends AsyncTask<String, Void, String> {\n\n        @Override\n        protected String doInBackground(String... params) {\n            Activity activity = getActivity();\n            if (activity != null) {\n                mAdapter = new FolderAdapter(activity, new File(PreferencesUtility.getInstance(activity).getLastFolder()));\n                updateTheme();\n            }\n            return "Executed";\n        }\n\n        @Override\n        protected void onPostExecute(String result) {\n            recyclerView.setAdapter(mAdapter);\n            //to add spacing between cards\n            if (getActivity() != null) {\n                setItemDecoration();\n            }\n            mAdapter.notifyDataSetChanged();\n            mProgressBar.setVisibility(View.GONE);\n            fastScroller.setVisibility(View.VISIBLE);\n            fastScroller.setRecyclerView(recyclerView);\n        }\n\n        @Override\n        protected void onPreExecute() {\n        }\n    }\n}\n'