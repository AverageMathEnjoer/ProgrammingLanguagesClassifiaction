b'package com.codeest.geeknews.ui.main.activity;\n\nimport android.content.DialogInterface;\nimport android.content.Intent;\nimport android.content.pm.PackageInfo;\nimport android.content.pm.PackageManager;\nimport android.os.Bundle;\nimport android.support.annotation.Nullable;\nimport android.support.design.widget.NavigationView;\nimport android.support.v4.widget.DrawerLayout;\nimport android.support.v7.app.ActionBarDrawerToggle;\nimport android.support.v7.widget.Toolbar;\nimport android.view.Menu;\nimport android.view.MenuItem;\n\nimport com.codeest.geeknews.R;\nimport com.codeest.geeknews.app.App;\nimport com.codeest.geeknews.app.Constants;\nimport com.codeest.geeknews.base.BaseActivity;\nimport com.codeest.geeknews.component.RxBus;\nimport com.codeest.geeknews.component.UpdateService;\nimport com.codeest.geeknews.model.event.SearchEvent;\nimport com.codeest.geeknews.presenter.main.MainPresenter;\nimport com.codeest.geeknews.base.contract.main.MainContract;\nimport com.codeest.geeknews.ui.gank.fragment.GankMainFragment;\nimport com.codeest.geeknews.ui.gold.fragment.GoldMainFragment;\nimport com.codeest.geeknews.ui.main.fragment.AboutFragment;\nimport com.codeest.geeknews.ui.main.fragment.LikeFragment;\nimport com.codeest.geeknews.ui.main.fragment.SettingFragment;\nimport com.codeest.geeknews.ui.vtex.fragment.VtexMainFragment;\nimport com.codeest.geeknews.ui.wechat.fragment.WechatMainFragment;\nimport com.codeest.geeknews.ui.zhihu.fragment.ZhihuMainFragment;\nimport com.codeest.geeknews.util.SystemUtil;\nimport com.miguelcatalan.materialsearchview.MaterialSearchView;\nimport com.tbruyelle.rxpermissions2.RxPermissions;\n\nimport butterknife.BindView;\nimport me.yokeyword.fragmentation.SupportFragment;\n\n/**\n * Created by codeest on 16/8/9.\n */\n\npublic class MainActivity extends BaseActivity<MainPresenter> implements MainContract.View{\n\n    @BindView(R.id.drawer)\n    DrawerLayout mDrawerLayout;\n    @BindView(R.id.toolbar)\n    Toolbar mToolbar;\n    @BindView(R.id.navigation)\n    NavigationView mNavigationView;\n    @BindView(R.id.view_search)\n    MaterialSearchView mSearchView;\n\n    ZhihuMainFragment mZhihuFragment;\n    GankMainFragment mGankFragment;\n    WechatMainFragment mWechatFragment;\n    GoldMainFragment mGoldFragment;\n    VtexMainFragment mVtexFragment;\n    LikeFragment mLikeFragment;\n    SettingFragment mSettingFragment;\n    AboutFragment mAboutFragment;\n\n    MenuItem mLastMenuItem;\n    MenuItem mSearchMenuItem;\n    ActionBarDrawerToggle mDrawerToggle;\n\n    private int hideFragment = Constants.TYPE_ZHIHU;\n    private int showFragment = Constants.TYPE_ZHIHU;\n\n    @Override\n    protected void initInject() {\n        getActivityComponent().inject(this);\n    }\n\n    @Override\n    protected int getLayout() {\n        return R.layout.activity_main;\n    }\n\n    /**\n     * \xe7\x94\xb1\xe4\xba\x8erecreate \xe9\x9c\x80\xe8\xa6\x81\xe7\x89\xb9\xe6\xae\x8a\xe5\xa4\x84\xe7\x90\x86\xe5\xa4\x9c\xe9\x97\xb4\xe6\xa8\xa1\xe5\xbc\x8f\n     * @param savedInstanceState\n     */\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        if (savedInstanceState == null) {\n            mPresenter.setNightModeState(false);\n        } else {\n            showFragment = mPresenter.getCurrentItem();\n            hideFragment = Constants.TYPE_ZHIHU;\n            showHideFragment(getTargetFragment(showFragment), getTargetFragment(hideFragment));\n            mNavigationView.getMenu().findItem(R.id.drawer_zhihu).setChecked(false);\n            mToolbar.setTitle(mNavigationView.getMenu().findItem(getCurrentItem(showFragment)).getTitle().toString());\n            hideFragment = showFragment;\n        }\n    }\n\n    @Override\n    protected void initEventAndData() {\n        setToolBar(mToolbar,"\xe7\x9f\xa5\xe4\xb9\x8e\xe6\x97\xa5\xe6\x8a\xa5");\n        mZhihuFragment = new ZhihuMainFragment();\n        mGankFragment = new GankMainFragment();\n        mWechatFragment = new WechatMainFragment();\n        mGoldFragment = new GoldMainFragment();\n        mVtexFragment = new VtexMainFragment();\n        mLikeFragment = new LikeFragment();\n        mSettingFragment = new SettingFragment();\n        mAboutFragment = new AboutFragment();\n        mDrawerToggle = new ActionBarDrawerToggle(this, mDrawerLayout, mToolbar, R.string.drawer_open, R.string.drawer_close);\n        mDrawerToggle.syncState();\n        mDrawerLayout.addDrawerListener(mDrawerToggle);\n        mLastMenuItem = mNavigationView.getMenu().findItem(R.id.drawer_zhihu);\n        loadMultipleRootFragment(R.id.fl_main_content,0,mZhihuFragment,mWechatFragment,mGankFragment,mGoldFragment,mVtexFragment,mLikeFragment,mSettingFragment,mAboutFragment);\n        mNavigationView.setNavigationItemSelectedListener(new NavigationView.OnNavigationItemSelectedListener() {\n            @Override\n            public boolean onNavigationItemSelected(MenuItem menuItem) {\n                switch (menuItem.getItemId()) {\n                    case R.id.drawer_zhihu:\n                        showFragment = Constants.TYPE_ZHIHU;\n                        mSearchMenuItem.setVisible(false);\n                        break;\n                    case R.id.drawer_gank:\n                        showFragment = Constants.TYPE_GANK;\n                        mSearchMenuItem.setVisible(true);\n                        break;\n                    case R.id.drawer_wechat:\n                        showFragment = Constants.TYPE_WECHAT;\n                        mSearchMenuItem.setVisible(true);\n                        break;\n                    case R.id.drawer_gold:\n                        showFragment = Constants.TYPE_GOLD;\n                        mSearchMenuItem.setVisible(false);\n                        break;\n                    case R.id.drawer_vtex:\n                        showFragment = Constants.TYPE_VTEX;\n                        mSearchMenuItem.setVisible(false);\n                        break;\n                    case R.id.drawer_setting:\n                        showFragment = Constants.TYPE_SETTING;\n                        mSearchMenuItem.setVisible(false);\n                        break;\n                    case R.id.drawer_like:\n                        showFragment = Constants.TYPE_LIKE;\n                        mSearchMenuItem.setVisible(false);\n                        break;\n                    case R.id.drawer_about:\n                        showFragment = Constants.TYPE_ABOUT;\n                        mSearchMenuItem.setVisible(false);\n                        break;\n                }\n                if(mLastMenuItem != null) {\n                    mLastMenuItem.setChecked(false);\n                }\n                mLastMenuItem = menuItem;\n                mPresenter.setCurrentItem(showFragment);\n                menuItem.setChecked(true);\n                mToolbar.setTitle(menuItem.getTitle());\n                mDrawerLayout.closeDrawers();\n                showHideFragment(getTargetFragment(showFragment), getTargetFragment(hideFragment));\n                hideFragment = showFragment;\n                return true;\n            }\n        });\n        mSearchView.setOnQueryTextListener(new MaterialSearchView.OnQueryTextListener() {\n            @Override\n            public boolean onQueryTextSubmit(String query) {\n                if(showFragment == Constants.TYPE_GANK) {\n                    mGankFragment.doSearch(query);\n                } else if(showFragment == Constants.TYPE_WECHAT) {\n                    RxBus.getDefault().post(new SearchEvent(query, Constants.TYPE_WECHAT));\n                }\n                return false;\n            }\n\n            @Override\n            public boolean onQueryTextChange(String newText) {\n                return false;\n            }\n        });\n        if (!mPresenter.getVersionPoint() && SystemUtil.isWifiConnected()) {\n            mPresenter.setVersionPoint(true);\n            try {\n                PackageManager pm = getPackageManager();\n                PackageInfo pi = pm.getPackageInfo(getPackageName(), PackageManager.GET_ACTIVITIES);\n                String versionName = pi.versionName;\n                mPresenter.checkVersion(versionName);\n            } catch (PackageManager.NameNotFoundException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n\n    @Override\n    public boolean onCreateOptionsMenu(Menu menu) {\n        getMenuInflater().inflate(R.menu.main_menu, menu);\n        MenuItem item = menu.findItem(R.id.action_search);\n        item.setVisible(false);\n        mSearchView.setMenuItem(item);\n        mSearchMenuItem = item;\n        return true;\n    }\n\n    @Override\n    public void onBackPressedSupport() {\n        if (mSearchView.isSearchOpen()) {\n            mSearchView.closeSearch();\n        } else {\n            showExitDialog();\n        }\n    }\n\n    private void showExitDialog() {\n        android.support.v7.app.AlertDialog.Builder builder = new android.support.v7.app.AlertDialog.Builder(this);\n        builder.setTitle("\xe6\x8f\x90\xe7\xa4\xba");\n        builder.setMessage("\xe7\xa1\xae\xe5\xae\x9a\xe9\x80\x80\xe5\x87\xbaGeekNews\xe5\x90\x97");\n        builder.setNegativeButton("\xe5\x8f\x96\xe6\xb6\x88", null);\n        builder.setPositiveButton("\xe7\xa1\xae\xe5\xae\x9a", new DialogInterface.OnClickListener() {\n            @Override\n            public void onClick(DialogInterface dialogInterface, int i) {\n                App.getInstance().exitApp();\n            }\n        });\n        builder.show();\n    }\n\n    private SupportFragment getTargetFragment(int item) {\n        switch (item) {\n            case Constants.TYPE_ZHIHU:\n                return mZhihuFragment;\n            case Constants.TYPE_GANK:\n                return mGankFragment;\n            case Constants.TYPE_WECHAT:\n                return mWechatFragment;\n            case Constants.TYPE_GOLD:\n                return mGoldFragment;\n            case Constants.TYPE_VTEX:\n                return mVtexFragment;\n            case Constants.TYPE_LIKE:\n                return mLikeFragment;\n            case Constants.TYPE_SETTING:\n                return mSettingFragment;\n            case Constants.TYPE_ABOUT:\n                return mAboutFragment;\n        }\n        return mZhihuFragment;\n    }\n\n    private int getCurrentItem(int item) {\n        switch (item) {\n            case Constants.TYPE_ZHIHU:\n                return R.id.drawer_zhihu;\n            case Constants.TYPE_GANK:\n                return R.id.drawer_gank;\n            case Constants.TYPE_WECHAT:\n                return R.id.drawer_wechat;\n            case Constants.TYPE_GOLD:\n                return R.id.drawer_gold;\n            case Constants.TYPE_VTEX:\n                return R.id.drawer_vtex;\n            case Constants.TYPE_LIKE:\n                return R.id.drawer_like;\n            case Constants.TYPE_SETTING:\n                return R.id.drawer_setting;\n            case Constants.TYPE_ABOUT:\n                return R.id.drawer_about;\n        }\n        return R.id.drawer_zhihu;\n    }\n\n    @Override\n    public void showUpdateDialog(String versionContent) {\n        android.support.v7.app.AlertDialog.Builder builder = new android.support.v7.app.AlertDialog.Builder(this);\n        builder.setTitle("\xe6\xa3\x80\xe6\xb5\x8b\xe5\x88\xb0\xe6\x96\xb0\xe7\x89\x88\xe6\x9c\xac!");\n        builder.setMessage(versionContent);\n        builder.setNegativeButton("\xe5\x8f\x96\xe6\xb6\x88", null);\n        builder.setPositiveButton("\xe9\xa9\xac\xe4\xb8\x8a\xe6\x9b\xb4\xe6\x96\xb0", new DialogInterface.OnClickListener() {\n            @Override\n            public void onClick(DialogInterface dialogInterface, int i) {\n                checkPermissions();\n            }\n        });\n        builder.show();\n    }\n\n    @Override\n    public void startDownloadService() {\n        startService(new Intent(mContext, UpdateService.class));\n    }\n\n    public void checkPermissions() {\n        mPresenter.checkPermissions(new RxPermissions(this));\n    }\n}\n'