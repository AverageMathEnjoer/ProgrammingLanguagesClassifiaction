b'# week 2 solutions\n\n# 1\n\nlibrary(rethinking)\ndata(Howell1)\nd <- Howell1\nd2 <- d[ d$age >= 18 , ]\nHbar <- mean(d2$height)\ndat <- list(W=d2$weight,H=d2$height,Hbar=Hbar)\n\nm1 <- quap(\n    alist(\n        W ~ dnorm( mu , sigma ) ,\n        mu <- a + b*( H - Hbar ) ,\n        a ~ dnorm( 60 , 10 ) ,\n        b ~ dlnorm( 0 , 1 ) ,\n        sigma ~ dunif( 0 , 10 )\n    ) , data=dat )\n\ndat2 <- list( H=c(140,160,175,100) , Hbar=Hbar )\nh_sim <- sim( m1 , data=dat2 )\nEw <- apply(h_sim,2,mean)\nh_ci <- apply(h_sim,2,PI,prob=0.89)\n\ndatr <- cbind( H=c(140,160,175) , Ew , L89=h_ci[1,] , U89=h_ci[2,] )\nround(datr,1)\n\n# 2\n\nlibrary(rethinking)\ndata(Howell1)\nd <- Howell1\nd <- d[ d$age < 13 , ]\n\n# sim from priors\nn <- 10\na <- rnorm(n,5,1)\nb <- rlnorm(n,0,1)\n# blank(bty="n")\nplot( NULL , xlim=range(d$age) , ylim=range(d$weight) )\nfor ( i in 1:n ) abline( a[i] , b[i] , lwd=3 , col=2 )\n\nm2 <- quap(\n    alist(\n        W ~ dnorm( mu , sigma ),\n        mu <- a + b*A,\n        a ~ dnorm(5,1),\n        b ~ dlnorm(0,1),\n        sigma ~ dexp(1)\n    ), data=list(W=d$weight,A=d$age) )\n\nprecis(m2)\n\n# blank(bty="n")\nplot( d$age , d$weight , lwd=3, col=2 )\npost <- extract.samples(m2)\nfor ( i in 1:10 ) abline( post$a[i] , post$b[i] , lwd=3 , col=1 )\n\n# 3\n\nlibrary(rethinking)\ndata(Howell1)\nd <- Howell1\nd <- d[ d$age < 13 , ]\n\ndat <- list(W=d$weight,A=d$age,S=d$male+1)\n\nm3 <- quap(\n    alist(\n        W ~ dnorm( mu , sigma ),\n        mu <- a[S] + b[S]*A,\n        a[S] ~ dnorm(5,1),\n        b[S] ~ dlnorm(0,1),\n        sigma ~ dexp(1)\n    ), data=dat )\n\n# blank(bty="n")\nplot( d$age , d$weight , lwd=3, col=ifelse(d$male==1,4,2) , xlab="age (years)" , ylab="weight (kg)" )\nAseq <- 0:12\n\n# girls\nmuF <- link(m3,data=list(A=Aseq,S=rep(1,13)))\nshade( apply(muF,2,PI,0.99) , Aseq , col=col.alpha(2,0.5) )\nlines( Aseq , apply(muF,2,mean) , lwd=3 , col=2 )\n\n# boys\nmuM <- link(m3,data=list(A=Aseq,S=rep(2,13)))\nshade( apply(muM,2,PI,0.99) , Aseq , col=col.alpha(4,0.5) )\nlines( Aseq , apply(muM,2,mean) , lwd=3 , col=4 )\n\n\n# contrast at each age\nAseq <- 0:12\nmu1 <- sim(m3,data=list(A=Aseq,S=rep(1,13)))\nmu2 <- sim(m3,data=list(A=Aseq,S=rep(2,13)))\nmu_contrast <- mu1\nfor ( i in 1:13 ) mu_contrast[,i] <- mu2[,i] - mu1[,i]\nplot( NULL , xlim=c(0,13) , ylim=c(-15,15) , xlab="age" , ylab="weight difference (boys-girls)" )\n\nfor ( p in c(0.5,0.67,0.89,0.99) )\nshade( apply(mu_contrast,2,PI,prob=p) , Aseq )\n\nabline(h=0,lty=2,lwd=2)\n\nfor ( i in 1:13 ) points( mu_contrast[1:1000,i] , col=ifelse(mu_contrast[1:1000,i]>0,4,2) , lwd=3 )\n\n# 4 \n\ndata(Oxboys)\nd <- Oxboys\n\nd$delta <- NA\nfor ( i in 1:nrow(d) ) {\n    if ( d$Occasion[i] > 1 ) d$delta[i] <- d$height[i] - d$height[i-1]\n}\nd <- d[ !is.na(d$delta) , ]\n\n# simulation from priors\nn <- 1e3\nalpha <- rnorm(n,0,0.1)\nsigma <- rexp(n,3)\ndelta_sim <- rlnorm(n,alpha,sigma)\ndens(delta_sim)\n\n# the model\nm4 <- quap(\n    alist(\n        delta ~ dlnorm( alpha , sigma ),\n        alpha ~ dnorm( 0 , 0.1 ),\n        sigma ~ dexp( 3 )\n    ), data=list(delta=d$delta) )\n\n# compute posterior sum of 8 increments\npost <- extract.samples(m4)\n\ndsim <- rlnorm(1e3,post$alpha,post$sigma)\ndens(dsim)\n\ninc_sum <- sapply( 1:1000 , function(s) sum(rlnorm(8,post$alpha[s],post$sigma[s])) )\ndens(inc_sum)\n\n'