b'\xef\xbb\xbfusing Asn1;\nusing System;\nusing System.Collections.Generic;\nusing System.Text;\n\nnamespace Rubeus\n{\n    // PA-S4U-X509-USER::= SEQUENCE {\n    //    user-id[0] S4UUserID,\n    //    checksum[1] Checksum\n    //}\n\n    \n    public class PA_S4U_X509_USER\n    {\n        public PA_S4U_X509_USER(byte[] key, string name, string realm, uint nonce, Interop.KERB_ETYPE eType = Interop.KERB_ETYPE.aes256_cts_hmac_sha1)\n        {\n            user_id = new S4UUserID(name, realm, nonce);\n\n            AsnElt userIDAsn = user_id.Encode();\n            AsnElt userIDSeq = AsnElt.Make(AsnElt.SEQUENCE, userIDAsn);\n            byte[] userIDBytes = userIDSeq.CopyValue();\n            byte[] cksumBytes = null;\n\n            if (eType == Interop.KERB_ETYPE.aes256_cts_hmac_sha1)\n                cksumBytes = Crypto.KerberosChecksum(key, userIDBytes, Interop.KERB_CHECKSUM_ALGORITHM.KERB_CHECKSUM_HMAC_SHA1_96_AES256, Interop.KRB_KEY_USAGE_PA_S4U_X509_USER);\n            if (eType == Interop.KERB_ETYPE.aes128_cts_hmac_sha1)\n                cksumBytes = Crypto.KerberosChecksum(key, userIDBytes, Interop.KERB_CHECKSUM_ALGORITHM.KERB_CHECKSUM_HMAC_SHA1_96_AES128, Interop.KRB_KEY_USAGE_PA_S4U_X509_USER);\n            if (eType == Interop.KERB_ETYPE.rc4_hmac)\n                cksumBytes = Crypto.KerberosChecksum(key, userIDBytes, Interop.KERB_CHECKSUM_ALGORITHM.KERB_CHECKSUM_RSA_MD4, Interop.KRB_KEY_USAGE_PA_S4U_X509_USER);\n\n            cksum = new Checksum(Interop.KERB_CHECKSUM_ALGORITHM.KERB_CHECKSUM_HMAC_SHA1_96_AES256, cksumBytes);\n        }\n\n        public AsnElt Encode()\n        {\n            AsnElt userIDAsn = user_id.Encode();\n            AsnElt userIDSeq = AsnElt.Make(AsnElt.SEQUENCE, userIDAsn);\n            userIDSeq = AsnElt.MakeImplicit(AsnElt.CONTEXT, 0, userIDSeq);\n\n            AsnElt checksumAsn = cksum.Encode();\n            checksumAsn = AsnElt.MakeImplicit(AsnElt.CONTEXT, 1, checksumAsn);\n\n            AsnElt seq = AsnElt.Make(AsnElt.SEQUENCE, new AsnElt[] { userIDSeq, checksumAsn });\n\n            return seq;\n        }\n\n        public S4UUserID user_id { get; set; }\n        public Checksum cksum { get; set; }\n    }\n}\n'