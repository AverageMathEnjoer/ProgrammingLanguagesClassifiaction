b'# simulation of simple Kopernican model showing epicycle\n\nlibrary(rethinking)\nlibrary(animation)\n\nmy_circle <- function(x=0,y=0,r=1,angle=0,...) {\n    a <- seq(angle, angle + 2 * pi, length = 360)\n    lines( r*cos(a)+x , r*sin(a)+y , ... )\n}\n# plot(NULL,xlim=c(-1,1),ylim=c(-1,1)); my_circle(0,0,0.5,lty=2)\np2c <- function(a) c(cos(a) , sin(a))\n\n# blank()\n\npar(bg = \'black\')\nplot(NULL,xlim=c(-1,1),ylim=c(-1,1),bty="n",xaxt="n",yaxt="n",xlab="",ylab="")\n\ndraw_kop_epi <- function(tx,history=FALSE,r1=1,r2=0.2,rays=FALSE,epi=FALSE,sun_x=-0.2) {\n\n    if ( history==TRUE ) {\n        xs <- rep(NA,tx)\n        ys <- rep(NA,tx)\n        for ( ttx in 1:tx ) {\n            xy <- p2c( k1[ttx] )*r1\n            xy2 <- xy + p2c( k2[ttx] )*r2\n            xs[ttx] <- xy2[1]\n            ys[ttx] <- xy2[2]\n        }\n        lines( xs , ys , lty=1 , lwd=2 , col=col.alpha(4,0.5) )\n    }\n\n    if ( epi==TRUE )\n    my_circle(0,0,r=r1,lty=2,lwd=0.5,col="white")\n\n    xy <- p2c( k1[tx] )*r1\n    if ( epi==TRUE ) {\n        my_circle( xy[1] , xy[2] , angle=k1[tx] , r=r2 , lty=2 , lwd=0.5 , col="white" )\n        points(0,0,pch=3,col="white",lwd=2)\n    }\n\n    xy2 <- xy + p2c( k2[tx] )*r2\n    points( xy2[1] , xy2[2] , pch=16 , col=4 , cex=2 ) # earth\n    points( sun_x , 0 , pch=16 , col="yellow" , cex=4 ) # sun\n\n    if ( rays==TRUE ) {\n        # lines from sun to earth\n        for ( j in 1:tx )\n            if ( j/25 == floor(j/25) ) {\n                xy <- p2c( k1[j] )*r1\n                xy2 <- xy + p2c( k2[j] )*r2\n                lines( c(sun_x,xy2[1]) , c(0,xy2[2]) , lwd=0.5 , col="yellow" , lty=2 )\n            }\n    }\n}\n\nmpts <- 300\nk1 <- seq( 0 , 2 * pi , length = mpts)\nk2 <- seq( 0 , 2 * 2 * pi , length = mpts )\n\nani.record(reset = TRUE)  # clear history before recording\n\n# first orbit without epicycles shown\nfor ( i in 1:length(k1) ) {\n    par(bg = \'black\')\n    par(xpd=NA)\n    plot(c(-1, 1), c(-1, 1), type = "n", asp = 1, axes = FALSE, \n            xlab = "", ylab = "")\n    draw_kop_epi( i , history=TRUE , r1=1 , r2=0.1 , rays=FALSE , epi=FALSE )\n    ani.record()  # record the current frame\n    par(bg = \'white\')\n}\n# second orbit with epicycles\nfor ( i in 1:length(k1) ) {\n    par(bg = \'black\')\n    par(xpd=NA)\n    plot(c(-1, 1), c(-1, 1), type = "n", asp = 1, axes = FALSE, \n            xlab = "", ylab = "")\n    draw_kop_epi( i , history=TRUE , r1=1 , r2=0.1 , rays=FALSE , epi=TRUE )\n    ani.record()  # record the current frame\n    par(bg = \'white\')\n}\n# third orbit with epicycles and sun segments\nfor ( i in 1:length(k1) ) {\n    par(bg = \'black\')\n    par(xpd=NA)\n    plot(c(-1, 1), c(-1, 1), type = "n", asp = 1, axes = FALSE, \n            xlab = "", ylab = "")\n    draw_kop_epi( i , history=TRUE , r1=1 , r2=0.1 , rays=TRUE , epi=TRUE )\n    ani.record()  # record the current frame\n    par(bg = \'white\')\n}\n\noopts = ani.options(interval = 0.02)\nani.replay()\n\n# ani.saveqz(dpi=150)\n\n# convert -alpha remove -background white -delay 5 -loop 0 frame*.png kopernicus_epi.gif\n\n# convert -delay 5 kopernicus_epi.gif kopernicus_epi.gif\n'