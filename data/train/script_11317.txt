b'/*\n * Copyright (C) 2015 Naman Dwivedi\n *\n * Licensed under the GNU General Public License v3\n *\n * This is free software: you can redistribute it and/or modify it\n * under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or (at your option) any later version.\n *\n * This software is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * See the GNU General Public License for more details.\n */\n\npackage com.naman14.timber.fragments;\n\nimport android.graphics.Rect;\nimport android.os.AsyncTask;\nimport android.os.Bundle;\nimport androidx.fragment.app.Fragment;\nimport androidx.recyclerview.widget.GridLayoutManager;\nimport androidx.recyclerview.widget.RecyclerView;\nimport android.view.LayoutInflater;\nimport android.view.Menu;\nimport android.view.MenuInflater;\nimport android.view.MenuItem;\nimport android.view.View;\nimport android.view.ViewGroup;\n\nimport com.naman14.timber.R;\nimport com.naman14.timber.adapters.AlbumAdapter;\nimport com.naman14.timber.dataloaders.AlbumLoader;\nimport com.naman14.timber.models.Album;\nimport com.naman14.timber.utils.PreferencesUtility;\nimport com.naman14.timber.utils.SortOrder;\nimport com.naman14.timber.widgets.BaseRecyclerView;\nimport com.naman14.timber.widgets.DividerItemDecoration;\nimport com.naman14.timber.widgets.FastScroller;\n\nimport java.util.List;\n\npublic class AlbumFragment extends Fragment {\n\n    private AlbumAdapter mAdapter;\n    private BaseRecyclerView recyclerView;\n    private FastScroller fastScroller;\n    private GridLayoutManager layoutManager;\n    private RecyclerView.ItemDecoration itemDecoration;\n    private PreferencesUtility mPreferences;\n    private boolean isGrid;\n\n    @Override\n    public void onCreate(final Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mPreferences = PreferencesUtility.getInstance(getActivity());\n        isGrid = mPreferences.isAlbumsInGrid();\n    }\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n        View rootView = inflater.inflate(\n                R.layout.fragment_recyclerview, container, false);\n\n        recyclerView = rootView.findViewById(R.id.recyclerview);\n        fastScroller = rootView.findViewById(R.id.fastscroller);\n\n        recyclerView.setEmptyView(getActivity(), rootView.findViewById(R.id.list_empty), "No media found");\n\n        setLayoutManager();\n\n        if (getActivity() != null)\n            new loadAlbums().execute("");\n        return rootView;\n    }\n\n    private void setLayoutManager() {\n        if (isGrid) {\n            layoutManager = new GridLayoutManager(getActivity(), 2);\n            fastScroller.setVisibility(View.GONE);\n        } else {\n            layoutManager = new GridLayoutManager(getActivity(), 1);\n            fastScroller.setVisibility(View.VISIBLE);\n            fastScroller.setRecyclerView(recyclerView);\n        }\n        recyclerView.setLayoutManager(layoutManager);\n    }\n\n    private void setItemDecoration() {\n        if (isGrid) {\n            int spacingInPixels = getActivity().getResources().getDimensionPixelSize(R.dimen.spacing_card_album_grid);\n            itemDecoration = new SpacesItemDecoration(spacingInPixels);\n        } else {\n            itemDecoration = new DividerItemDecoration(getActivity(), DividerItemDecoration.VERTICAL_LIST);\n        }\n        recyclerView.addItemDecoration(itemDecoration);\n    }\n\n    private void updateLayoutManager(int column) {\n        recyclerView.removeItemDecoration(itemDecoration);\n        recyclerView.setAdapter(new AlbumAdapter(getActivity(), AlbumLoader.getAllAlbums(getActivity())));\n        layoutManager.setSpanCount(column);\n        layoutManager.requestLayout();\n        setItemDecoration();\n    }\n\n    private void reloadAdapter() {\n        new AsyncTask<Void, Void, Void>() {\n            @Override\n            protected Void doInBackground(final Void... unused) {\n                List<Album> albumList = AlbumLoader.getAllAlbums(getActivity());\n                mAdapter.updateDataSet(albumList);\n                return null;\n            }\n\n            @Override\n            protected void onPostExecute(Void aVoid) {\n                mAdapter.notifyDataSetChanged();\n            }\n        }.execute();\n    }\n\n    @Override\n    public void onActivityCreated(final Bundle savedInstanceState) {\n        super.onActivityCreated(savedInstanceState);\n        setHasOptionsMenu(true);\n    }\n\n    @Override\n    public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {\n        super.onCreateOptionsMenu(menu, inflater);\n        inflater.inflate(R.menu.album_sort_by, menu);\n        inflater.inflate(R.menu.menu_show_as, menu);\n\n    }\n\n    @Override\n    public boolean onOptionsItemSelected(MenuItem item) {\n        switch (item.getItemId()) {\n            case R.id.menu_sort_by_az:\n                mPreferences.setAlbumSortOrder(SortOrder.AlbumSortOrder.ALBUM_A_Z);\n                reloadAdapter();\n                return true;\n            case R.id.menu_sort_by_za:\n                mPreferences.setAlbumSortOrder(SortOrder.AlbumSortOrder.ALBUM_Z_A);\n                reloadAdapter();\n                return true;\n            case R.id.menu_sort_by_year:\n                mPreferences.setAlbumSortOrder(SortOrder.AlbumSortOrder.ALBUM_YEAR);\n                reloadAdapter();\n                return true;\n            case R.id.menu_sort_by_artist:\n                mPreferences.setAlbumSortOrder(SortOrder.AlbumSortOrder.ALBUM_ARTIST);\n                reloadAdapter();\n                return true;\n            case R.id.menu_sort_by_number_of_songs:\n                mPreferences.setAlbumSortOrder(SortOrder.AlbumSortOrder.ALBUM_NUMBER_OF_SONGS);\n                reloadAdapter();\n                return true;\n            case R.id.menu_show_as_list:\n                mPreferences.setAlbumsInGrid(false);\n                isGrid = false;\n                updateLayoutManager(1);\n                return true;\n            case R.id.menu_show_as_grid:\n                mPreferences.setAlbumsInGrid(true);\n                isGrid = true;\n                updateLayoutManager(2);\n                return true;\n        }\n        return super.onOptionsItemSelected(item);\n    }\n\n    public class SpacesItemDecoration extends RecyclerView.ItemDecoration {\n        private int space;\n\n        public SpacesItemDecoration(int space) {\n            this.space = space;\n        }\n\n        @Override\n        public void getItemOffsets(Rect outRect, View view,\n                                   RecyclerView parent, RecyclerView.State state) {\n\n\n            outRect.left = space;\n            outRect.top = space;\n            outRect.right = space;\n            outRect.bottom = space;\n\n        }\n    }\n\n    private class loadAlbums extends AsyncTask<String, Void, String> {\n\n        @Override\n        protected String doInBackground(String... params) {\n            if (getActivity() != null)\n                mAdapter = new AlbumAdapter(getActivity(), AlbumLoader.getAllAlbums(getActivity()));\n            return "Executed";\n        }\n\n        @Override\n        protected void onPostExecute(String result) {\n            recyclerView.setAdapter(mAdapter);\n            //to add spacing between cards\n            if (getActivity() != null) {\n                setItemDecoration();\n            }\n\n        }\n\n        @Override\n        protected void onPreExecute() {\n        }\n    }\n}\n\n'