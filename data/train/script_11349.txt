b'\xef\xbb\xbfusing RonSijm.ButtFish.Devices;\n\nnamespace RonSijm.ButtFish;\n\npublic class DeviceBroadcaster\n{\n    private readonly ICharacterEncoder _characterEncoder;\n\n    public DeviceBroadcaster(ICharacterEncoder characterEncoder)\n    {\n        _characterEncoder = characterEncoder;\n    }\n\n    public async Task SendNextMoveToDevice(string nextPosition, IList<IDeviceAbstraction> devices)\n    {\n        Console.WriteLine(nextPosition);\n\n        foreach (var nextPositionChar in nextPosition)\n        {\n            var morseCodeForChar = _characterEncoder.EncodeCharacter(nextPositionChar);\n\n            if (morseCodeForChar == null)\n            {\n                continue;\n            }\n\n            Console.Write($"({nextPositionChar})");\n\n            foreach (var durationToSend in morseCodeForChar.Select(morseCodeChar => morseCodeChar == \'.\' ? TimeUnitConfig.DotTime : TimeUnitConfig.DashTime))\n            {\n                Task.WaitAll(devices.Select(device => device.SendDuration(durationToSend)).ToArray());\n\n                // Wait 1 time unit\n                Console.Write(" ");\n                await Task.Delay(TimeUnitConfig.SpaceBetweenSymbols);\n            }\n\n            // wait 3 time units\n            await Task.Delay(TimeUnitConfig.SpaceBetweenLetters);\n        }\n\n        Console.WriteLine();\n        Console.WriteLine("Finished sending command to device.", Color.Green);\n    }\n}'