b'package id.zelory.compressor.constraint\n\nimport android.graphics.Bitmap\nimport android.graphics.BitmapFactory\nimport com.natpryce.hamkrest.assertion.assertThat\nimport com.natpryce.hamkrest.equalTo\nimport com.natpryce.hamkrest.isA\nimport id.zelory.compressor.calculateInSampleSize\nimport id.zelory.compressor.decodeSampledBitmapFromFile\nimport id.zelory.compressor.determineImageRotation\nimport id.zelory.compressor.overWrite\nimport io.mockk.every\nimport io.mockk.mockk\nimport io.mockk.mockkStatic\nimport io.mockk.unmockkAll\nimport io.mockk.verify\nimport org.junit.After\nimport org.junit.Test\nimport java.io.File\n\n/**\n * Created on : January 25, 2020\n * Author     : zetbaitsu\n * Name       : Zetra\n * GitHub     : https://github.com/zetbaitsu\n */\nclass ResolutionConstraintTest {\n\n    @After\n    fun teardown() {\n        unmockkAll()\n    }\n\n    @Test\n    fun `when sampled size is greater than 1, constraint should not satisfied`() {\n        // Given\n        mockkStatic(BitmapFactory::class)\n        every { BitmapFactory.decodeFile(any(), any()) } returns mockk()\n        mockkStatic("id.zelory.compressor.UtilKt")\n        every { calculateInSampleSize(any(), any(), any()) } returns 2\n\n        val constraint = ResolutionConstraint(100, 100)\n\n        // When + Then\n        assertThat(constraint.isSatisfied(mockk(relaxed = true)), equalTo(false))\n    }\n\n    @Test\n    fun `when sampled size is equal 1, constraint should satisfied`() {\n        // Given\n        mockkStatic(BitmapFactory::class)\n        every { BitmapFactory.decodeFile(any(), any()) } returns mockk()\n        mockkStatic("id.zelory.compressor.UtilKt")\n        every { calculateInSampleSize(any(), any(), any()) } returns 1\n\n        val constraint = ResolutionConstraint(100, 100)\n\n        // When + Then\n        assertThat(constraint.isSatisfied(mockk(relaxed = true)), equalTo(true))\n    }\n\n    @Test\n    fun `when trying satisfy constraint, it should subsampling image and overwrite file`() {\n        // Given\n        mockkStatic("id.zelory.compressor.UtilKt")\n\n        val sampledBitmap = mockk<Bitmap>(relaxed = true)\n        every { decodeSampledBitmapFromFile(any(), any(), any()) } returns sampledBitmap\n\n        val rotatedBitmap = mockk<Bitmap>(relaxed = true)\n        every { determineImageRotation(any(), any()) } returns rotatedBitmap\n\n        every { overWrite(any(), any(), any(), any()) } returns mockk()\n\n        val imageFile = mockk<File>(relaxed = true)\n        val (width, height) = (1280 to 720)\n        val constraint = ResolutionConstraint(width, height)\n\n        // When\n        constraint.satisfy(imageFile)\n\n        // Then\n        verify {\n            decodeSampledBitmapFromFile(imageFile, width, height)\n            determineImageRotation(imageFile, sampledBitmap)\n            overWrite(imageFile, rotatedBitmap, any(), any())\n        }\n    }\n\n    @Test\n    fun `verify extension`() {\n        // Given\n        val compression = Compression()\n\n        // When\n        compression.resolution(100, 100)\n\n        // Then\n        assertThat(compression.constraints.first(), isA<ResolutionConstraint>())\n    }\n}'