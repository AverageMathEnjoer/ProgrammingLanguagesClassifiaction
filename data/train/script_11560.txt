b'package com.codeest.geeknews.ui.main.fragment;\n\nimport android.app.Activity;\nimport android.content.DialogInterface;\nimport android.content.pm.PackageInfo;\nimport android.content.pm.PackageManager;\nimport android.os.Bundle;\nimport android.support.annotation.Nullable;\nimport android.support.v7.widget.AppCompatCheckBox;\nimport android.widget.CompoundButton;\nimport android.widget.LinearLayout;\nimport android.widget.TextView;\n\nimport com.codeest.geeknews.R;\nimport com.codeest.geeknews.app.Constants;\nimport com.codeest.geeknews.base.BaseFragment;\nimport com.codeest.geeknews.component.ACache;\nimport com.codeest.geeknews.component.RxBus;\nimport com.codeest.geeknews.model.bean.VersionBean;\nimport com.codeest.geeknews.model.event.NightModeEvent;\nimport com.codeest.geeknews.presenter.main.SettingPresenter;\nimport com.codeest.geeknews.base.contract.main.SettingContract;\nimport com.codeest.geeknews.ui.main.activity.MainActivity;\nimport com.codeest.geeknews.util.ShareUtil;\n\nimport java.io.File;\n\nimport butterknife.BindView;\nimport butterknife.OnClick;\n\n/**\n * Created by codeest on 16/8/23.\n */\n\npublic class SettingFragment extends BaseFragment<SettingPresenter> implements CompoundButton.OnCheckedChangeListener, SettingContract.View{\n\n    @BindView(R.id.cb_setting_cache)\n    AppCompatCheckBox cbSettingCache;\n    @BindView(R.id.cb_setting_image)\n    AppCompatCheckBox cbSettingImage;\n    @BindView(R.id.cb_setting_night)\n    AppCompatCheckBox cbSettingNight;\n    @BindView(R.id.ll_setting_feedback)\n    LinearLayout llSettingFeedback;\n    @BindView(R.id.tv_setting_clear)\n    TextView tvSettingClear;\n    @BindView(R.id.ll_setting_clear)\n    LinearLayout llSettingClear;\n    @BindView(R.id.tv_setting_update)\n    TextView tvSettingUpdate;\n    @BindView(R.id.ll_setting_update)\n    LinearLayout llSettingUpdate;\n\n    private File cacheFile;\n    private String versionName;\n    private boolean isNull = true;\n\n    @Override\n    protected void initInject() {\n        getFragmentComponent().inject(this);\n    }\n\n    @Override\n    protected int getLayoutId() {\n        return R.layout.fragment_setting;\n    }\n\n    @Override\n    protected void initEventAndData() {\n        cacheFile = new File(Constants.PATH_CACHE);\n        tvSettingClear.setText(ACache.getCacheSize(cacheFile));\n        cbSettingCache.setChecked(mPresenter.getAutoCacheState());\n        cbSettingImage.setChecked(mPresenter.getNoImageState());\n        cbSettingNight.setChecked(mPresenter.getNightModeState());\n        cbSettingCache.setOnCheckedChangeListener(this);\n        cbSettingImage.setOnCheckedChangeListener(this);\n        cbSettingNight.setOnCheckedChangeListener(this);\n        try {\n            PackageManager pm = getActivity().getPackageManager();\n            PackageInfo pi = pm.getPackageInfo(getActivity().getPackageName(), PackageManager.GET_ACTIVITIES);\n            versionName = pi.versionName;\n            tvSettingUpdate.setText(String.format("\xe5\xbd\x93\xe5\x89\x8d\xe7\x89\x88\xe6\x9c\xac\xe5\x8f\xb7 v%s",versionName));\n        } catch (PackageManager.NameNotFoundException e) {\n            e.printStackTrace();\n        }\n    }\n\n    @Override\n    public void onCreate(@Nullable Bundle savedInstanceState) {\n        isNull = savedInstanceState == null;\n        super.onCreate(savedInstanceState);\n    }\n\n    @OnClick(R.id.ll_setting_feedback)\n    void doFeedBack() {\n        ShareUtil.sendEmail(mContext, "\xe9\x80\x89\xe6\x8b\xa9\xe9\x82\xae\xe4\xbb\xb6\xe5\xae\xa2\xe6\x88\xb7\xe7\xab\xaf:");\n    }\n\n    @OnClick(R.id.ll_setting_clear)\n    void doClear() {\n        ACache.deleteDir(cacheFile);\n        tvSettingClear.setText(ACache.getCacheSize(cacheFile));\n    }\n\n    @OnClick(R.id.ll_setting_update)\n    void doUpdate() {\n        mPresenter.checkVersion(versionName);\n    }\n\n    @Override\n    public void onCheckedChanged(CompoundButton compoundButton, boolean b) {\n        switch (compoundButton.getId()) {\n            case R.id.cb_setting_night:\n                if (isNull) {   //\xe9\x98\xb2\xe6\xad\xa2\xe5\xa4\x9c\xe9\x97\xb4\xe6\xa8\xa1\xe5\xbc\x8fMainActivity\xe6\x89\xa7\xe8\xa1\x8creCreate\xe5\x90\x8e\xe9\x87\x8d\xe5\xa4\x8d\xe8\xb0\x83\xe7\x94\xa8\n                    mPresenter.setNightModeState(b);\n                    NightModeEvent event = new NightModeEvent();\n                    event.setNightMode(b);\n                    RxBus.getDefault().post(event);\n                }\n                break;\n            case R.id.cb_setting_image:\n                mPresenter.setNoImageState(b);\n                break;\n            case R.id.cb_setting_cache:\n                mPresenter.setAutoCacheState(b);\n                break;\n        }\n    }\n\n    @Override\n    public void showUpdateDialog(VersionBean bean) {\n        StringBuilder content = new StringBuilder("\xe7\x89\x88\xe6\x9c\xac\xe5\x8f\xb7: v");\n        content.append(bean.getCode());\n        content.append("\\r\\n");\n        content.append("\xe7\x89\x88\xe6\x9c\xac\xe5\xa4\xa7\xe5\xb0\x8f: ");\n        content.append(bean.getSize());\n        content.append("\\r\\n");\n        content.append("\xe6\x9b\xb4\xe6\x96\xb0\xe5\x86\x85\xe5\xae\xb9:\\r\\n");\n        content.append(bean.getDes().replace("\\\\r\\\\n","\\r\\n"));\n        android.support.v7.app.AlertDialog.Builder builder = new android.support.v7.app.AlertDialog.Builder(mContext);\n        builder.setTitle("\xe6\xa3\x80\xe6\xb5\x8b\xe5\x88\xb0\xe6\x96\xb0\xe7\x89\x88\xe6\x9c\xac!");\n        builder.setMessage(content);\n        builder.setNegativeButton("\xe5\x8f\x96\xe6\xb6\x88", null);\n        builder.setPositiveButton("\xe9\xa9\xac\xe4\xb8\x8a\xe6\x9b\xb4\xe6\x96\xb0", new DialogInterface.OnClickListener() {\n            @Override\n            public void onClick(DialogInterface dialogInterface, int i) {\n                Activity mActivity = getActivity();\n                if (mActivity instanceof MainActivity) {\n                    ((MainActivity) mActivity).checkPermissions();\n                }\n            }\n        });\n        builder.show();\n    }\n}\n'