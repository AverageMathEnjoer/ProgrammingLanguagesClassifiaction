b'package io.github.javiewer.adapter;\n\nimport android.app.Activity;\nimport android.app.AlertDialog;\nimport android.app.ProgressDialog;\nimport android.content.ClipData;\nimport android.content.ClipboardManager;\nimport android.content.Context;\nimport android.content.DialogInterface;\nimport android.content.Intent;\nimport android.net.Uri;\nimport androidx.recyclerview.widget.RecyclerView;\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.widget.TextView;\nimport android.widget.Toast;\n\nimport java.util.List;\n\nimport butterknife.BindView;\nimport butterknife.ButterKnife;\nimport io.github.javiewer.R;\nimport io.github.javiewer.adapter.item.DownloadLink;\nimport io.github.javiewer.adapter.item.MagnetLink;\nimport io.github.javiewer.network.provider.DownloadLinkProvider;\nimport okhttp3.ResponseBody;\nimport retrofit2.Call;\nimport retrofit2.Callback;\nimport retrofit2.Response;\n\n/**\n * Project: JAViewer\n */\npublic class DownloadLinkAdapter extends ItemAdapter<DownloadLink, DownloadLinkAdapter.ViewHolder> {\n\n    private Activity mParentActivity;\n\n    private DownloadLinkProvider provider;\n\n    public DownloadLinkAdapter(List<DownloadLink> links, Activity mParentActivity, DownloadLinkProvider provider) {\n        super(links);\n        this.mParentActivity = mParentActivity;\n        this.provider = provider;\n    }\n\n    @Override\n    public ViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {\n        View v = LayoutInflater.from(parent.getContext()).inflate(R.layout.layout_download, parent, false);\n        return new ViewHolder(v);\n    }\n\n    @Override\n    public void onBindViewHolder(final ViewHolder holder, int position) {\n        final DownloadLink link = getItems().get(position);\n\n        holder.parse(link);\n\n        holder.mView.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                if (!link.hasMagnetLink()) {\n                    final ProgressDialog mDialog;\n                    mDialog = new ProgressDialog(mParentActivity);\n                    mDialog.setTitle("\xe8\xaf\xb7\xe7\xa8\x8d\xe5\x90\x8e");\n                    mDialog.setMessage("\xe6\xad\xa3\xe5\x9c\xa8\xe8\x8e\xb7\xe5\x8f\x96\xe7\xa3\x81\xe5\x8a\x9b\xe9\x93\xbe\xe6\x8e\xa5");\n                    mDialog.setIndeterminate(false);\n                    mDialog.setCancelable(false);\n                    mDialog.show();\n\n                    Call<ResponseBody> call = provider.get(link.getLink());\n                    call.enqueue(new Callback<ResponseBody>() {\n                        @Override\n                        public void onResponse(Call<ResponseBody> call, Response<ResponseBody> response) {\n                            try {\n                                MagnetLink magnetLink = provider.parseMagnetLink(response.body().string());\n                                onMagnetGet(magnetLink.getMagnetLink());\n                            } catch (Throwable e) {\n                                onFailure(call, e);\n                            }\n\n                            mDialog.dismiss();\n                        }\n\n                        @Override\n                        public void onFailure(Call<ResponseBody> call, Throwable t) {\n                            t.printStackTrace();\n                        }\n                    });\n                } else {\n                    onMagnetGet(link.getMagnetLink());\n                }\n            }\n        });\n    }\n\n    public void onMagnetGet(final String magnetLink) {\n        if (!magnetLink.isEmpty()) {\n            AlertDialog mDialog = new AlertDialog.Builder(mParentActivity)\n                    .setTitle("\xe7\xa3\x81\xe5\x8a\x9b\xe9\x93\xbe\xe6\x8e\xa5")\n                    .setMessage(magnetLink)\n                    .setNeutralButton("\xe5\xa4\x8d\xe5\x88\xb6\xe5\x88\xb0\xe5\x89\xaa\xe8\xb4\xb4\xe6\x9d\xbf", new DialogInterface.OnClickListener() {\n                        @Override\n                        public void onClick(DialogInterface dialog, int which) {\n                            ClipboardManager clip = (ClipboardManager) mParentActivity.getSystemService(Context.CLIPBOARD_SERVICE);\n                            clip.setPrimaryClip(ClipData.newPlainText("magnet-link", magnetLink));\n                            Toast.makeText(mParentActivity, "\xe7\xa3\x81\xe5\x8a\x9b\xe9\x93\xbe\xe6\x8e\xa5\xef\xbc\x9a" + magnetLink + " \xe5\xb7\xb2\xe5\xa4\x8d\xe5\x88\xb6\xe5\x88\xb0\xe5\x89\xaa\xe8\xb4\xb4\xe6\x9d\xbf", Toast.LENGTH_SHORT).show();\n                        }\n                    })\n                    .setPositiveButton("\xe6\x89\x93\xe5\xbc\x80", new DialogInterface.OnClickListener() {\n                        @Override\n                        public void onClick(DialogInterface dialog, int which) {\n                            Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(magnetLink));\n                            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n                            mParentActivity.startActivity(intent);\n                        }\n                    })\n                    .setNegativeButton("\xe5\x8f\x96\xe6\xb6\x88", null)\n                    .show();\n\n        } else {\n            Toast.makeText(mParentActivity, "\xe7\xa3\x81\xe5\x8a\x9b\xe9\x93\xbe\xe6\x8e\xa5\xe8\x8e\xb7\xe5\x8f\x96\xe5\xa4\xb1\xe8\xb4\xa5", Toast.LENGTH_SHORT).show();\n        }\n    }\n\n    public static class ViewHolder extends RecyclerView.ViewHolder {\n\n        @BindView(R.id.download_title)\n        public TextView mTextTitle;\n\n        @BindView(R.id.download_size)\n        public TextView mTextSize;\n\n        @BindView(R.id.download_date)\n        public TextView mTextDate;\n\n        @BindView(R.id.layout_download)\n        public View mView;\n\n        public ViewHolder(View view) {\n            super(view);\n            ButterKnife.bind(this, view);\n        }\n\n        public void parse(DownloadLink link) {\n            mTextSize.setText(link.getSize());\n            mTextTitle.setText(link.getTitle());\n            mTextDate.setText(link.getDate());\n        }\n    }\n}\n'