b'skip_on_cran()\n\nlibrary(WDI)\n\n\ntest_that("extra includes last updated", {\n   x <- WDI(extra = TRUE)\n   expect_true("lastupdated" %in% colnames(x))\n})\n\n# breaks on travis but works locally\ntest_that(\'WDIcache\', {\n    cache = WDIcache()\n    expect_type(cache, \'list\')\n    expect_gte(nrow(cache$series), 20000)\n    # web cache = stored cache\n    old <- WDIsearch(\'gdp.*capita.*constant\')\n    new <- WDIsearch("gdp.*capita.*constant", cache = cache)\n    row.names(old) <- row.names(new) <- NULL\n    expect_identical(old, new)\n})\n\ntest_that(\'Bad indicator\' , {\n    expect_warning(expect_s3_class(\n        WDI(indicator = c(\'NY.GDP.PCAP.KD\', \'test\'), country = \'US\', start = 1990, end = 1991),\n        \'data.frame\'))\n    expect_error(expect_null(\n        WDI(indicator = c(\'bad\', \'test\'), country = \'US\', start = 1990, end = 1990)))\n})\n\ntest_that(\'Bad country\', {\n    expect_error(WDI(country = c(\'bad\')))\n    expect_warning(WDI(country = c(\'CA\', \'bad\'), start = 1990, end = 1991))\n})\n\ntest_that(\'Bad year\', {\n    expect_error(WDI(start = 1950))\n    expect_error(WDI(start = 1991, end = 1990))\n    expect_error(WDI(start = \'1990M2\', end = \'1990M1\'))\n})\n\ntest_that(\'WDI\', {\n    # 1 country 1 indicator\n    x <- WDI(country=\'US\', indicator=\'NY.GDP.PCAP.KD\', start = 1990, end = 1991)\n    expect_s3_class(x, \'data.frame\')\n    expect_equal(dim(x), c(2, 5))\n\n    # 3 countries 1 indicator\n    x <- WDI(country=c(\'CA\', \'MX\', \'US\'),\n             indicator=\'NY.GDP.PCAP.KD\',\n             start=1990, end=1991)\n    expect_s3_class(x, \'data.frame\')\n    expect_equal(dim(x), c(6, 5))\n    expect_equal(length(unique(x$iso2c)), 3)\n\n    # multiple indicators\n    ind <- c("NY.GDP.PCAP.KD", "NY.GDP.PCAP.KN", "NY.GDP.PCAP.PP.KD")\n    x <- WDI(indicator = ind, start=1990, end=1991)\n    expect_gte(nrow(x), 30)\n    expect_equal(ncol(x), 7)\n\n    # bad countries\n    co <- c(\'BADCOUNTRY_one\', \'BADCOUNTRY_two\', \'CA\', \'MX\', \'US\')\n    x <- expect_warning(WDI(country = co, start=1990, end=1991))\n    expect_equal(length(unique(x$iso2c)), 3)\n\n    # bad indicator\n    ind <- c("blah blah", "NY.GDP.PCAP.KD", "NY.GDP.PCAP.KN", "NY.GDP.PCAP.PP.KD", "NY.GDP.PCAP.PP.KD.87")\n    x <- expect_warning(WDI(indicator = ind, start=1990, end=1991))\n    expect_gte(nrow(x), 30)\n    expect_equal(ncol(x), 7)\n\n})\n\ntest_that(\'WDI(extra = TRUE)\', {\n    x <- WDI(country=\'US\', indicator=\'NY.GDP.PCAP.KD\',\n             start=1991, end=1992, extra = TRUE)\n    expect_s3_class(x, \'data.frame\')\n    expect_equal(dim(x), c(2, 13))\n\n})\n\ntest_that("extra = TRUE provides observation status", {\n    x <- WDI(country=\'US\', indicator=\'NY.GDP.PCAP.KD\',\n             start=1991, end=1992, extra = TRUE)\n    expect_true("status" %in% names(x))\n    expect_true(is.character(x$status))\n})\n\ntest_that("behavior of start/end dates with latest", {\n   expect_silent(\n        WDI("all", "AG.AGR.TRAC.NO", start = NULL, end = NULL, latest = 5)\n    )\n    expect_silent(\n        WDI("all", "AG.AGR.TRAC.NO", start = 1980, end = 2000, latest = 5)\n    )\n})\n\ntest_that("latest provides a dataframe", {\n   y <- WDI("all", "AG.AGR.TRAC.NO", start = NULL, end = NULL, latest = 5)\n    expect_s3_class(y, "data.frame")\n\n   z <- WDI("all", "AG.AGR.TRAC.NO", latest = 5)\n   expect_s3_class(z, "data.frame")\n})\n\ntest_that("check that language doesn\'t change output format", {\n    x <- suppressWarnings(\n        WDI("all", "AG.AGR.TRAC.NO", language = "vi")\n    )\n    expect_s3_class(x, "data.frame")\n})\n\ntest_that("default language is english", {\n    x <- WDI("all", "AG.AGR.TRAC.NO")\n    y <- WDI("all", "AG.AGR.TRAC.NO", language = "en")\n    expect_true(identical(x, y))\n})\n\ntest_that("NULL language is equivalent to english", {\n   x <- WDI("all", "AG.AGR.TRAC.NO", language = NULL)\n   y <- WDI("all", "AG.AGR.TRAC.NO", language = "en")\n   expect_true(identical(x, y))\n})\n\ntest_that("error if language not in list", {\n    expect_error(\n        WDI("all", "AG.AGR.TRAC.NO", language = "xyz")\n    )\n})\n\ntest_that("warning if language only supported partially", {\n    expect_warning(\n        WDI("all", "AG.AGR.TRAC.NO", language = "vi")\n    )\n})\n\ntest_that("languages_supported produces a list", {\n    expect_type(\n        languages_supported(),\n        "list"\n    )\n})\n\n\ntest_that("rename on the fly", {\n    ind <- c("women_private_sector" = "BI.PWK.PRVS.FE.ZS", "women_public_sector" = "BI.PWK.PUBS.FE.ZS")\n    x <- WDI(country = \'CA\', indicator = ind)\n    expect_identical(\n        colnames(x),\n        c("country", "iso2c", "iso3c", "year", "women_private_sector", "women_public_sector"))\n})\n\n\ntest_that("fix iso codes wrongly attributed to iso2 or iso3, issue #54", {\n  dat <- WDI(indicator = c("DT.ODA.ODAT.GN.ZS", "DT.ODA.ODAT.GD.ZS"),\n             country = c("AO","CG","SA","MZ"), start = 2000, end = 2020)\n  \n  expect_equal(unique(dat$iso3c), c("AGO", "COG", "MOZ", "SAU"))\n  \n  expect_equal(unique(dat$iso2c), c("AO", "CG", "MZ", "SA"))\n})\n\n'