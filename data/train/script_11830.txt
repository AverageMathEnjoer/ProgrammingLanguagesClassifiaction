b'\xef\xbb\xbfusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Windows.Forms;\n\nnamespace Aerial.Controls\n{\n    public class EntitiesTreeView : TreeView\n    {\n        private Dictionary<string, Asset> Movies;\n        private bool updatingChecked = false;\n        public EntitiesTreeView()\n        {\n            CheckBoxes = true;\n            FullRowSelect = true;\n            Location = new System.Drawing.Point(7, 19);\n            Name = "tvMovies";\n            ShowLines = false;\n            ShowPlusMinus = false;\n            Size = new System.Drawing.Size(138, 229);\n            TabIndex = 15;\n            AfterCheck += new TreeViewEventHandler(tvMovies_AfterCheck);\n        }\n\n        public void BuildTree(List<Asset> movies, List<string> selectedEntities)\n        {\n            updatingChecked = true;\n            TreeNode root = new TreeNode(movies[0].accessibilityLabel);\n            Nodes.Add(root);\n            Movies = new Dictionary<string, Asset>();\n            bool allChecked = true;\n            foreach (var m in movies)\n            {\n                if (m.accessibilityLabel != root.Text)\n                {\n                    // checked root\n                    if (allChecked) root.Checked = true;\n                    // new root\n                    root = new TreeNode(m.accessibilityLabel);\n                    Nodes.Add(root);\n                }\n                // add node\n                var newNode = new TreeNode(m.TimeAndIdNumbered());\n                root.Nodes.Add(newNode);\n                newNode.Checked = selectedEntities.Contains(newNode.FullPath);\n                allChecked = allChecked && newNode.Checked;\n                Movies.Add(root.Nodes[root.Nodes.Count - 1].FullPath, m);\n            }\n\n            ExpandAll();\n\n            updatingChecked = false;\n\n            StartPlayer();\n        }\n\n        private void StartPlayer()\n        {\n            SelectedNode = Nodes[0].Nodes[0];\n            Select();\n            TopNode.EnsureVisible();\n            Nodes[0].EnsureVisible();\n        }\n\n        public string ConcatChosenEntities()\n        {\n            var selected = "";\n            foreach (TreeNode root in Nodes)\n                foreach (TreeNode n in root.Nodes)\n                    if (n.Checked)\n                        selected += ";" + n.FullPath;\n\n            return selected + ";";\n        }\n\n\n        private void tvMovies_AfterCheck(object sender, TreeViewEventArgs e)\n        {\n            if (updatingChecked) return;\n\n            updatingChecked = true;\n\n            if (!e.Node.FullPath.Contains("\\\\"))\n            {\n                foreach (TreeNode node in e.Node.Nodes)\n                    node.Checked = e.Node.Checked;\n            }\n            else\n            {\n                foreach (TreeNode n in e.Node.Parent.Nodes)\n                {\n                    if (!n.Checked)\n                    {\n                        e.Node.Parent.Checked = false;\n                        return;\n                    }\n                }\n                e.Node.Parent.Checked = true;\n            }\n\n            updatingChecked = false;\n        }\n\n        internal string GetUrl(string fullPath)\n        {\n            return Movies[fullPath].url;\n        }\n    }\n}\n'