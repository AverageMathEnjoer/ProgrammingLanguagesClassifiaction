b'package icu.nullptr.twifucker.hook\n\nimport com.github.kyuubiran.ezxhelper.ClassUtils.loadClass\nimport com.github.kyuubiran.ezxhelper.HookFactory.`-Static`.createHook\nimport com.github.kyuubiran.ezxhelper.Log\nimport com.github.kyuubiran.ezxhelper.finders.FieldFinder\nimport com.github.kyuubiran.ezxhelper.finders.MethodFinder\nimport icu.nullptr.twifucker.afterMeasure\nimport icu.nullptr.twifucker.modulePrefs\n\nobject JsonTimelineTweetHook : BaseHook() {\n    override val name: String\n        get() = "JsonTimelineTweetHook"\n\n    override fun init() {\n        if (!modulePrefs.getBoolean("disable_promoted_content", true)) return\n\n        val jsonTimelineTweetClass =\n            loadClass("com.twitter.model.json.timeline.urt.JsonTimelineTweet")\n        val jsonTimelineTweetMapperClass =\n            loadClass("com.twitter.model.json.timeline.urt.JsonTimelineTweet\\$\\$JsonObjectMapper")\n\n        val jsonTweetResultsClass =\n            FieldFinder.fromClass(loadClass("com.twitter.model.json.core.JsonTweetResults"))\n                .first().type\n        val jsonTweetResultsField =\n            FieldFinder.fromClass(jsonTimelineTweetClass).filterByType(jsonTweetResultsClass)\n                .first()\n        val jsonTweetIdField =\n            FieldFinder.fromClass(jsonTimelineTweetClass).filterByType(String::class.java).first()\n\n        val jsonPromotedContentUrtClass =\n            loadClass("com.twitter.model.json.timeline.urt.JsonPromotedContentUrt")\n        val jsonPromotedContentUrtField =\n            FieldFinder.fromClass(jsonTimelineTweetClass).filterByType(jsonPromotedContentUrtClass)\n                .first()\n\n        MethodFinder.fromClass(jsonTimelineTweetMapperClass).filterByName("_parse")\n            .filterByReturnType(jsonTimelineTweetClass).first().createHook {\n                afterMeasure(name) { param ->\n                    param.result ?: return@afterMeasure\n                    jsonPromotedContentUrtField.get(param.result) ?: return@afterMeasure\n                    jsonTweetResultsField.set(param.result, null)\n                    jsonTweetIdField.set(param.result, null) // saved search timeline\n                    Log.d("Removed promoted timeline tweet")\n                }\n            }\n    }\n}'