b'\xef\xbb\xbfusing BaiduPanDownload.Data;\nusing BaiduPanDownload.HttpTool.Download;\nusing BaiduPanDownload.Managers;\nusing BaiduPanDownload.Util.FileTool;\nusing System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Data;\nusing System.Drawing;\nusing System.IO;\nusing System.Linq;\nusing System.Net;\nusing System.Runtime.InteropServices;\nusing System.Text;\nusing System.Threading;\nusing System.Windows.Forms;\n\nnamespace BaiduPanDownload.Forms\n{\n    public partial class Download : Form\n    {\n        /// <summary>\n        /// \xe4\xb8\x8b\xe8\xbd\xbd\xe9\x93\xbe\xe6\x8e\xa5\n        /// </summary>\n        public string Url { get; set; }\n        /// <summary>\n        /// \xe6\x96\x87\xe4\xbb\xb6\xe5\x90\x8d\n        /// </summary>\n        public string FileName { get; set; }\n        /// <summary>\n        /// Cookies\n        /// </summary>\n        public CookiesData Cookies { get; set; }\n        /// <summary>\n        /// \xe7\xbd\x91\xe7\x9b\x98\xe6\x96\x87\xe4\xbb\xb6\xe4\xbf\xa1\xe6\x81\xaf\n        /// </summary>\n        public DiskFileInfo Info { get; set; }\n\n        [DllImport("user32.dll", CharSet = CharSet.Auto)]\n        public static extern bool SwitchToThisWindow(IntPtr hWnd, bool fAltTab);\n\n        public Download()\n        {\n            InitializeComponent();\n        }\n\n        private void Download_Load(object sender, EventArgs e)\n        {\n            SwitchToThisWindow(this.Handle, true);\n            new Thread(() => { init(); }).Start();\n        }\n        void init()\n        {\n            \n            textBox2.Text = Program.config.DownloadPath;\n            string DriveName = textBox2.Text.Substring(0, 1);\n            DiskInfo_Lab.Text = DriveName + "\xe7\x9b\x98\xe5\x89\xa9\xe4\xbd\x99\xe7\xa9\xba\xe9\x97\xb4: " + (getSizeGB(GetFreeSpace(DriveName)) < 1 ? getSizeMB(GetFreeSpace(DriveName)) + "MB" : getSizeGB(GetFreeSpace(DriveName)) + "GB");\n            //\xe4\xbb\x8e\xe7\xbd\x91\xe7\x9b\x98\xe4\xb8\x8b\xe8\xbd\xbd\n            if (Info != null)\n            {\n                long Size = 0;\n                foreach (var SubFile in Info.getFileList())\n                {\n                    textBox1.Text += $"https://pcs.baidu.com/rest/2.0/pcs/file?method=download&access_token={Program.config.Access_Token}&path=" + Uri.EscapeDataString(SubFile.path)+"\\r\\n";\n                    Size += SubFile.size;\n                }\n                Name_Lab.Text = "\xe6\x96\x87\xe4\xbb\xb6\xe5\x90\x8d: " + Info.getName();\n                Size_Lab.Text = "\xe6\x96\x87\xe4\xbb\xb6\xe5\xa4\xa7\xe5\xb0\x8f: " + (getSizeGB(Size)<1?getSizeMB(Size)+"MB":getSizeGB(Size)+"GB");\n                button2.Enabled = true;\n                return;\n            }\n            textBox1.Text += Url + "\\r\\n\xe8\xbf\x99\xe6\x98\xaf\xe7\x94\xb1\xe7\xbd\x91\xe9\xa1\xb5\xe6\x8f\x90\xe5\x8f\x96\xe7\x9a\x84\xe9\x93\xbe\xe6\x8e\xa5,\xe5\x8f\xaf\xe8\x83\xbd\xe6\x97\xa0\xe6\xb3\x95\xe6\xad\xa3\xe5\xb8\xb8\xe4\xb8\x8b\xe8\xbd\xbd";\n            Name_Lab.Text = "\xe6\x96\x87\xe4\xbb\xb6\xe5\x90\x8d: "+FileName;\n            try\n            {\n                HttpWebRequest Request = WebRequest.Create(Url) as HttpWebRequest;\n                Request.Referer = "http://pan.baidu.com/disk/home";\n                Cookie ck = new Cookie("BDUSS", Cookies.BDUSS);\n                ck.Domain = ".baidu.com";\n                Request.CookieContainer = new CookieContainer();\n                Request.CookieContainer.Add(ck);\n                ck = new Cookie("pcsett", Cookies.PCSETT);\n                ck.Domain = ".baidu.com";\n                Request.CookieContainer.Add(ck);\n                using (HttpWebResponse Response = Request.GetResponse() as HttpWebResponse){\n                    Size_Lab.Text = "\xe6\x96\x87\xe4\xbb\xb6\xe5\xa4\xa7\xe5\xb0\x8f: " + (getSizeGB(Response.ContentLength) < 1 ? getSizeMB(Response.ContentLength) + "MB" : getSizeGB(Response.ContentLength) + "GB");\n                }\n                button2.Enabled = true;\n            }\n            catch(Exception ex)\n            {\n                LogTool.WriteLogError(typeof(Download),"\xe8\x8e\xb7\xe5\x8f\x96\xe6\x96\x87\xe4\xbb\xb6\xe4\xbf\xa1\xe6\x81\xaf\xe6\x97\xb6\xe5\x87\xba\xe7\x8e\xb0\xe9\x94\x99\xe8\xaf\xaf",ex);\n                MessageBox.Show("\xe8\x8e\xb7\xe5\x8f\x96\xe6\x96\x87\xe4\xbb\xb6\xe4\xbf\xa1\xe6\x81\xaf\xe6\x97\xb6\xe5\x87\xba\xe7\x8e\xb0\xe9\x94\x99\xe8\xaf\xaf!","\xe9\x94\x99\xe8\xaf\xaf");\n            }\n        }\n\n        float getSizeGB(long byt)\n        {\n            return (float)byt / 1024 / 1024 / 1024;\n        }\n\n        float getSizeMB(long byt)\n        {\n            return (float)byt / 1024 / 1024;\n        }\n\n        long GetFreeSpace(string driveDirectoryName)\n        {\n            try\n            {\n                return new DriveInfo(driveDirectoryName).AvailableFreeSpace;\n            }\n            catch\n            {\n                return -1L;\n            }\n        }\n\n        private void button2_Click(object sender, EventArgs e)\n        {\n\n            //\xe4\xbb\x8e\xe7\xbd\x91\xe7\x9b\x98\xe4\xb8\x8b\xe8\xbd\xbd\n            if (!Directory.Exists(textBox2.Text))\n            {\n                MessageBox.Show("\xe4\xb8\x8b\xe8\xbd\xbd\xe8\xb7\xaf\xe5\xbe\x84\xe4\xb8\x8d\xe5\xad\x98\xe5\x9c\xa8!");\n                return;\n            }\n            if (Info != null)\n            {\n                foreach (var SubFile in Info.getFileList())\n                {\n                    TaskManager.GetTastManager.CreateDownloadTask($"https://pcs.baidu.com/rest/2.0/pcs/file?method=download&access_token={Program.config.Access_Token}&path=" + Uri.EscapeDataString(SubFile.path), textBox2.Text + "\\\\" + SubFile.getName());\n                }\n                this.Close();\n                return;\n            }\n            MessageBox.Show("\xe8\xad\xa6\xe5\x91\x8a:\xe7\x99\xbe\xe5\xba\xa6\xe5\xaf\xb9\xe5\x88\x86\xe4\xba\xab\xe7\x9a\x84\xe9\x93\xbe\xe6\x8e\xa5\xe6\x9c\x89\xe6\x97\xb6\xe9\x97\xb4\xe9\x99\x90\xe5\x88\xb6,\xe8\xaf\xb7\xe5\x9c\xa8\xe7\x9f\xad\xe6\x97\xb6\xe9\x97\xb4\xe5\x86\x85\xe4\xb8\x8b\xe8\xbd\xbd\xe5\xae\x8c\xe6\x88\x90,\xe8\xb6\x85\xe8\xbf\x87\xe4\xb8\x80\xe5\xa4\xa9\xe5\xbe\x88\xe6\x9c\x89\xe5\x8f\xaf\xe8\x83\xbd\xe6\x97\xa0\xe6\xb3\x95\xe6\x96\xad\xe7\x82\xb9\xe7\xbb\xad\xe4\xbc\xa0");\n            TaskManager.GetTastManager.CreateDownloadTask(Url,textBox2.Text+"\\\\"+FileName,Cookies,Program.config.NetSpeed*2);\n            this.Close();\n        }\n\n        private void button1_Click(object sender, EventArgs e)\n        {\n            FolderBrowserDialog folderBrowserDialog = new FolderBrowserDialog();\n            folderBrowserDialog.Description = "\xe8\xaf\xb7\xe9\x80\x89\xe6\x8b\xa9\xe4\xb8\x8b\xe8\xbd\xbd\xe7\x9b\xae\xe5\xbd\x95";\n            if (folderBrowserDialog.ShowDialog() == DialogResult.OK)\n            {\n                textBox2.Text = folderBrowserDialog.SelectedPath;\n            }\n        }\n    }\n}\n'