b'{-# LANGUAGE QuasiQuotes #-}\n\n-- | [\xe5\xbe\xae\xe5\x8d\x9a\xe6\x8e\x88\xe6\x9d\x83\xe6\x9c\xba\xe5\x88\xb6](https://open.weibo.com/wiki/%E6%8E%88%E6%9D%83%E6%9C%BA%E5%88%B6)\nmodule Network.OAuth2.Provider.Weibo where\n\nimport Data.Aeson\nimport Data.Map.Strict qualified as Map\nimport Data.Set qualified as Set\nimport Data.Text.Lazy (Text)\nimport GHC.Generics\nimport Network.OAuth.OAuth2\nimport Network.OAuth2.Experiment\nimport URI.ByteString.QQ\n\ndata Weibo = Weibo deriving (Eq, Show)\n\ntype instance IdpUserInfo Weibo = WeiboUID\n\ndefaultWeiboApp :: IdpApplication \'AuthorizationCode Weibo\ndefaultWeiboApp =\n  AuthorizationCodeIdpApplication\n    { idpAppName = "default-weibo-App"\n    , idpAppClientId = ""\n    , idpAppClientSecret = ""\n    , idpAppScope = Set.empty\n    , idpAppAuthorizeState = "CHANGE_ME"\n    , idpAppAuthorizeExtraParams = Map.empty\n    , idpAppRedirectUri = [uri|http://localhost|]\n    , idpAppTokenRequestAuthenticationMethod = ClientSecretBasic\n    , idp = defaultWeiboIdp\n    }\n\ndefaultWeiboIdp :: Idp Weibo\ndefaultWeiboIdp =\n  Idp\n    { idpFetchUserInfo = authGetJSONWithAuthMethod @_ @(IdpUserInfo Weibo) AuthInRequestQuery\n    , idpUserInfoEndpoint = [uri|https://api.weibo.com/2/account/get_uid.json|]\n    , idpAuthorizeEndpoint = [uri|https://api.weibo.com/oauth2/authorize|]\n    , idpTokenEndpoint = [uri|https://api.weibo.com/oauth2/access_token|]\n    }\n\n-- | http://open.weibo.com/wiki/2/users/show\ndata WeiboUser = WeiboUser\n  { id :: Integer\n  , name :: Text\n  , screenName :: Text\n  }\n  deriving (Show, Generic)\n\nnewtype WeiboUID = WeiboUID {uid :: Integer}\n  deriving (Show, Generic)\n\ninstance FromJSON WeiboUID\n\ninstance FromJSON WeiboUser where\n  parseJSON = genericParseJSON defaultOptions {fieldLabelModifier = camelTo2 \'_\'}\n'