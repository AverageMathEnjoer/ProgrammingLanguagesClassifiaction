b'package com.codeest.geeknews.ui.gank.activity;\n\nimport android.app.Activity;\nimport android.app.ActivityOptions;\nimport android.content.Context;\nimport android.content.Intent;\nimport android.support.v7.widget.Toolbar;\nimport android.view.KeyEvent;\nimport android.view.Menu;\nimport android.view.MenuItem;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.widget.TextView;\n\nimport com.codeest.geeknews.R;\nimport com.codeest.geeknews.app.App;\nimport com.codeest.geeknews.app.Constants;\nimport com.codeest.geeknews.base.SimpleActivity;\nimport com.codeest.geeknews.model.bean.RealmLikeBean;\nimport com.codeest.geeknews.model.db.RealmHelper;\nimport com.codeest.geeknews.model.prefs.ImplPreferencesHelper;\nimport com.codeest.geeknews.util.ShareUtil;\nimport com.codeest.geeknews.util.SystemUtil;\nimport com.tencent.smtt.sdk.WebChromeClient;\nimport com.tencent.smtt.sdk.WebSettings;\nimport com.tencent.smtt.sdk.WebView;\nimport com.tencent.smtt.sdk.WebViewClient;\n\nimport butterknife.BindView;\n\n/**\n * Created by codeest on 16/8/20.\n */\n\npublic class TechDetailActivity extends SimpleActivity {\n\n    @BindView(R.id.tool_bar)\n    Toolbar toolBar;\n    @BindView(R.id.wv_tech_content)\n    WebView wvTechContent;\n    @BindView(R.id.tv_progress)\n    TextView tvProgress;\n\n    RealmHelper mRealmHelper;\n    ImplPreferencesHelper mImplPreferencesHelper;\n    MenuItem menuItem;\n\n    String title,url,imgUrl,id;\n    int type;\n    boolean isLiked;\n\n    @Override\n    protected int getLayout() {\n        return R.layout.activity_tech_detail;\n    }\n\n    @Override\n    protected void initEventAndData() {\n        mRealmHelper = App.getAppComponent().realmHelper();\n        mImplPreferencesHelper = App.getAppComponent().preferencesHelper();\n        Intent intent = getIntent();\n        type = intent.getExtras().getInt(Constants.IT_GANK_DETAIL_TYPE);\n        title = intent.getExtras().getString(Constants.IT_GANK_DETAIL_TITLE);\n        url = intent.getExtras().getString(Constants.IT_GANK_DETAIL_URL);\n        imgUrl = intent.getExtras().getString(Constants.IT_GANK_DETAIL_IMG_URL);\n        id = intent.getExtras().getString(Constants.IT_GANK_DETAIL_ID);\n        setToolBar(toolBar,title);\n        WebSettings settings = wvTechContent.getSettings();\n        if (mImplPreferencesHelper.getNoImageState()) {\n            settings.setBlockNetworkImage(true);\n        }\n        if (mImplPreferencesHelper.getAutoCacheState()) {\n            settings.setAppCacheEnabled(true);\n            settings.setDomStorageEnabled(true);\n            settings.setDatabaseEnabled(true);\n            if (SystemUtil.isNetworkConnected()) {\n                settings.setCacheMode(WebSettings.LOAD_DEFAULT);\n            } else {\n                settings.setCacheMode(WebSettings.LOAD_CACHE_ONLY);\n            }\n        }\n        settings.setJavaScriptEnabled(true);\n        settings.setLoadWithOverviewMode(true);\n        settings.setLayoutAlgorithm(WebSettings.LayoutAlgorithm.SINGLE_COLUMN);\n        settings.setSupportZoom(true);\n        wvTechContent.setWebViewClient(new WebViewClient(){\n            @Override\n            public boolean shouldOverrideUrlLoading(WebView view, String url) {\n                view.loadUrl(url);\n                return true;\n            }\n        });\n        wvTechContent.setWebChromeClient(new WebChromeClient(){\n            @Override\n            public void onProgressChanged(WebView view, int newProgress) {\n                super.onProgressChanged(view, newProgress);\n                if (tvProgress == null)\n                    return;\n                if (newProgress == 100) {\n                    tvProgress.setVisibility(View.GONE);\n                } else {\n                    tvProgress.setVisibility(View.VISIBLE);\n                    ViewGroup.LayoutParams lp = tvProgress.getLayoutParams();\n                    lp.width = App.SCREEN_WIDTH * newProgress / 100;\n                }\n            }\n            @Override\n            public void onReceivedTitle(WebView view, String title) {\n                super.onReceivedTitle(view, title);\n                setTitle(title);\n            }\n        });\n        wvTechContent.loadUrl(url);\n    }\n\n    public boolean onKeyDown(int keyCode, KeyEvent event) {\n        if ((keyCode == KeyEvent.KEYCODE_BACK) && wvTechContent.canGoBack()) {\n            wvTechContent.goBack();\n            return true;\n        }\n        return super.onKeyDown(keyCode, event);\n    }\n\n    @Override\n    public boolean onCreateOptionsMenu(Menu menu) {\n        getMenuInflater().inflate(R.menu.tech_meun, menu);\n        menuItem = menu.findItem(R.id.action_like);\n        setLikeState(mRealmHelper.queryLikeId(id));\n        return true;\n    }\n\n    @Override public boolean onOptionsItemSelected(MenuItem item) {\n        int id = item.getItemId();\n        switch (id) {\n            case R.id.action_like:\n                if(isLiked) {\n                    item.setIcon(R.mipmap.ic_toolbar_like_n);\n                    mRealmHelper.deleteLikeBean(this.id);\n                    isLiked = false;\n                } else {\n                    item.setIcon(R.mipmap.ic_toolbar_like_p);\n                    RealmLikeBean bean = new RealmLikeBean();\n                    bean.setId(this.id);\n                    bean.setImage(imgUrl);\n                    bean.setUrl(url);\n                    bean.setTitle(title);\n                    bean.setType(type);\n                    bean.setTime(System.currentTimeMillis());\n                    mRealmHelper.insertLikeBean(bean);\n                    isLiked = true;\n                }\n                break;\n            case R.id.action_copy:\n                SystemUtil.copyToClipBoard(mContext,url);\n                return true;\n            case R.id.action_share:\n                ShareUtil.shareText(mContext,url,"\xe5\x88\x86\xe4\xba\xab\xe4\xb8\x80\xe7\xaf\x87\xe6\x96\x87\xe7\xab\xa0");\n        }\n        return super.onOptionsItemSelected(item);\n    }\n\n    private void setLikeState(boolean state) {\n        if(state) {\n            menuItem.setIcon(R.mipmap.ic_toolbar_like_p);\n            isLiked = true;\n        } else {\n            menuItem.setIcon(R.mipmap.ic_toolbar_like_n);\n            isLiked = false;\n        }\n    }\n\n    @Override\n    public void onBackPressedSupport() {\n        if (getSupportFragmentManager().getBackStackEntryCount() > 1) {\n            pop();\n        } else {\n            finishAfterTransition();\n        }\n    }\n\n    public static class Builder {\n\n        private String title;\n        private String url;\n        private String imgUrl;\n        private String id;\n        private int type;\n        private View shareView;\n        private Context mContext;\n        private Activity mActivity;\n\n        public Builder() {\n\n        }\n\n        public Builder setContext(Context mContext) {\n            this.mContext = mContext;\n            return this;\n        }\n\n        public Builder setTitle(String title) {\n            this.title = title;\n            return this;\n        }\n\n        public Builder setUrl(String url) {\n            this.url = url;\n            return this;\n        }\n\n        public Builder setImgUrl(String imgUrl) {\n            this.imgUrl = imgUrl;\n            return this;\n        }\n\n        public Builder setId(String id) {\n            this.id = id;\n            return this;\n        }\n\n        public Builder setType(int type) {\n            this.type = type;\n            return this;\n        }\n\n        public Builder setAnimConfig(Activity mActivity, View shareView) {\n            this.mActivity = mActivity;\n            this.shareView = shareView;\n            return this;\n        }\n    }\n\n    public static void launch(Builder builder) {\n        if (builder.shareView != null) {\n            Intent intent = new Intent();\n            intent.setClass(builder.mContext, TechDetailActivity.class);\n            intent.putExtra(Constants.IT_GANK_DETAIL_URL, builder.url);\n            intent.putExtra(Constants.IT_GANK_DETAIL_IMG_URL, builder.imgUrl);\n            intent.putExtra(Constants.IT_GANK_DETAIL_TITLE, builder.title);\n            intent.putExtra(Constants.IT_GANK_DETAIL_ID, builder.id);\n            intent.putExtra(Constants.IT_GANK_DETAIL_TYPE, builder.type);\n            ActivityOptions options = ActivityOptions.makeSceneTransitionAnimation(builder.mActivity, builder.shareView, "shareView");\n            builder.mContext.startActivity(intent,options.toBundle());\n        } else {\n            Intent intent = new Intent();\n            intent.setClass(builder.mContext, TechDetailActivity.class);\n            intent.putExtra(Constants.IT_GANK_DETAIL_URL, builder.url);\n            intent.putExtra(Constants.IT_GANK_DETAIL_IMG_URL, builder.imgUrl);\n            intent.putExtra(Constants.IT_GANK_DETAIL_TITLE, builder.title);\n            intent.putExtra(Constants.IT_GANK_DETAIL_ID, builder.id);\n            intent.putExtra(Constants.IT_GANK_DETAIL_TYPE, builder.type);\n            builder.mContext.startActivity(intent);\n        }\n    }\n}\n'