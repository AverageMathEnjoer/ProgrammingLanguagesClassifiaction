b'library(httr)\nlibrary(lubridate)\nlibrary(dplyr)\nlibrary(tibble)\nlibrary(purrrlyr)\n\nall_time_language = content(GET(\'https://api.github.com/search/repositories?q=language:r&sort=stars&order=desc\'))\nall_time_topic = content(GET(\'https://api.github.com/search/repositories?q=topic:r&sort=stars&order=desc\'))\n\nall_time_items = c(all_time_language$items, all_time_topic$items)\n\nget_last_month = as.character(as.Date(now())-30)\nget_now = as.character(Sys.Date())\n\ntrending_this_month_language = sprintf("https://api.github.com/search/repositories?q=language:r+created:>=%s&sort=stars&order=desc&", get_last_month) %>%\n     GET %>% content\n\ntrending_this_month_topic = sprintf("https://api.github.com/search/repositories?q=topic:r+created:>=%s&sort=stars&order=desc&", get_last_month) %>% \n    GET %>% content\n\ntrending_items = c(trending_this_month_language$items, trending_this_month_topic$items)\n\nnull_remove = function(x) ifelse(is.null(x),"",x)\n\ngen_list = function(x){\n    cbind(user  = x$owner$login,\n          repo = x$name,\n          stars = x$stargazers_count,\n          full_name = x$full_name,\n          html_url = x$html_url,\n          stargazers_count = x$stargazers_count,\n          description = null_remove(x$description))\n}\n\nall_time_data = cbind(do.call(rbind, lapply(all_time_items, gen_list)),\n                        from = get_now) %>% as_data_frame\n\nall_time_data = all_time_data[!duplicated(paste(all_time_data$user, all_time_data$repo)),] %>% arrange(desc(as.numeric(stars))) %>% head(30)\n\n\ntrending_data = cbind(do.call(rbind, lapply(trending_items, gen_list)),\n                      from = get_last_month,\n                      to = get_now\n                      ) %>% as_data_frame\n                    \ntrending_data = trending_data[!duplicated(paste(trending_data$user, trending_data$repo)),] %>% arrange(desc(as.numeric(stars))) %>% head(30)\n\ngen_markdown = function(x){\n    sprintf("1. [%s](%s) **%s**<br/>%s", \n            x$full_name, \n            x$html_url, \n            x$stargazers_count, \n            null_remove(x$description))\n}\n\nall_time_markdown = by_row(all_time_data, gen_markdown,.collate = "rows")$.out \n\nthis_month_markdown = by_row(trending_data, gen_markdown,.collate = "rows")$.out \n\nwrite_markdown = function(path,all,this){\n    f = file(path,open = \'w\')\n    writeLines("# Top-Starred R GitHub Repos to Follow\\n", f)\n    writeLines("Generated biweekly from [R code](https://github.com/qinwf/awesome-R/blob/master/trending_repo.R).\\n", f)\n    writeLines("## Trending\\n", f)\n    writeLines(sprintf("**Trending from %s to %s**\\n", get_last_month, get_now), f)\n    writeLines(this, f)\n    writeLines("\\n", f)\n    writeLines("## All-Time\\n", f)\n    writeLines(all, f)\n    writeLines("\\n", f)\n    close(f)\n}\n\nwrite_markdown("./r-trending.md",all_time_markdown, this_month_markdown)\n\nwrite.table(trending_data %>% select(from, to, repo, user, stars), "./trending.csv", sep = \',\',append = T, quote = T,row.names = FALSE, col.names = FALSE)\n\nwrite.table(all_time_data %>% select(from, repo, user, stars), "./all_time.csv", sep = \',\',append = T, quote = T,row.names = FALSE, col.names = FALSE)\n'