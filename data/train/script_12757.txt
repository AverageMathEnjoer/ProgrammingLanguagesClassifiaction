b'\xef\xbb\xbf\nusing BaiduPanDownload.Data;\nusing BaiduPanDownload.HttpTool;\nusing BaiduPanDownload.Util;\nusing BaiduPanDownload.Util.FileTool;\nusing Newtonsoft.Json;\nusing Newtonsoft.Json.Linq;\nusing System;\nusing System.Collections.Generic;\nusing System.ComponentModel;\nusing System.Data;\nusing System.Drawing;\nusing System.IO;\nusing System.Linq;\nusing System.Net;\nusing System.Text;\nusing System.Text.RegularExpressions;\nusing System.Threading;\nusing System.Web;\nusing System.Windows.Forms;\n\nnamespace BaiduPanDownload.Forms\n{\n    public partial class AddDownload : Form\n    {\n        Main main;\n        BaiduPanDownload.Data.DiskFileInfo info;\n        bool URLMode = false;\n        string Url = string.Empty;\n        public AddDownload(Main main, BaiduPanDownload.Data.DiskFileInfo info,bool URLMode=false,string Url="")\n        {\n            InitializeComponent();\n            this.main = main;\n            this.info = info;\n            this.URLMode = URLMode;\n            this.Url = Url;\n        }\n\n        private void AddDownload_Load(object sender, EventArgs e)\n        {\n            textBox1.Text = Program.config.DownloadPath;\n            this.TopMost = true;\n            if (URLMode)\n            {\n                FileName_Lab.Text = "\xe6\x96\x87\xe4\xbb\xb6\xe5\x90\x8d: \xe8\x8e\xb7\xe5\x8f\x96\xe4\xb8\xad";\n                FileSize_Lab.Text = "\xe6\x96\x87\xe4\xbb\xb6\xe5\xa4\xa7\xe5\xb0\x8f: \xe8\x8e\xb7\xe5\x8f\x96\xe4\xb8\xad";\n                DriveSpace_Lab.Text = textBox1.Text.Substring(0, 1) + "\xe7\x9b\x98\xe5\x89\xa9\xe4\xbd\x99\xe7\xa9\xba\xe9\x97\xb4: " + ((getSizeGB(GetFreeSpace(textBox1.Text.Substring(0, 1)))) < 1 ? getSizeMB(GetFreeSpace(textBox1.Text.Substring(0, 1))) + " MB" : getSizeGB(GetFreeSpace(textBox1.Text.Substring(0, 1))) + " GB");\n                button2.Enabled = false;\n                button2.Text = "\xe8\xaf\xb7\xe7\xad\x89\xe5\xbe\x85..";\n                return;\n            }\n            FileName_Lab.Text = "\xe6\x96\x87\xe4\xbb\xb6\xe5\x90\x8d: "+info.getName();\n            FileSize_Lab.Text = "\xe6\x96\x87\xe4\xbb\xb6\xe5\xa4\xa7\xe5\xb0\x8f: " + ((info.isdir==1)?"\xe6\x9c\xaa\xe7\x9f\xa5":(getSizeGB(info.size)<1?getSizeMB(info.size)+" MB":getSizeGB(info.size)+" GB"));\n            DriveSpace_Lab.Text = textBox1.Text.Substring(0, 1) + "\xe7\x9b\x98\xe5\x89\xa9\xe4\xbd\x99\xe7\xa9\xba\xe9\x97\xb4: " + ((getSizeGB(GetFreeSpace(textBox1.Text.Substring(0, 1))))<1?getSizeMB(GetFreeSpace(textBox1.Text.Substring(0, 1)))+" MB":getSizeGB(GetFreeSpace(textBox1.Text.Substring(0, 1)))+" GB");\n        }\n        float getSizeGB(long byt)\n        {\n            return (float)byt / 1024 / 1024 / 1024;\n        }\n\n        float getSizeMB(long byt)\n        {\n            return (float)byt / 1024 / 1024;\n        }\n\n        long GetFreeSpace(string driveDirectoryName)\n        {\n            try\n            {\n                return new DriveInfo(driveDirectoryName).AvailableFreeSpace;\n            }\n            catch\n            {\n                return 0L;\n            }\n            \n        }\n\n        private void textBox1_TextChanged(object sender, EventArgs e)\n        {\n            DriveSpace_Lab.Text = textBox1.Text.Substring(0, 1) + "\xe7\x9b\x98\xe5\x89\xa9\xe4\xbd\x99\xe7\xa9\xba\xe9\x97\xb4: " + ((getSizeGB(GetFreeSpace(textBox1.Text.Substring(0, 1)))) < 1 ? getSizeMB(GetFreeSpace(textBox1.Text.Substring(0, 1))) + " MB" : getSizeGB(GetFreeSpace(textBox1.Text.Substring(0, 1))) + " GB");\n        }\n\n        private void button1_Click(object sender, EventArgs e)\n        {\n            FolderBrowserDialog folderBrowserDialog = new FolderBrowserDialog();\n            folderBrowserDialog.Description = "\xe8\xaf\xb7\xe9\x80\x89\xe6\x8b\xa9\xe4\xb8\x8b\xe8\xbd\xbd\xe7\x9b\xae\xe5\xbd\x95";\n            if(folderBrowserDialog.ShowDialog() == DialogResult.OK)\n            {\n                textBox1.Text = folderBrowserDialog.SelectedPath;\n            }\n        }\n\n        private void button2_Click(object sender, EventArgs e)\n        {\n            this.button2.Enabled = false;\n            this.button2.Text = "\xe6\xb7\xbb\xe5\x8a\xa0\xe4\xb8\xad...";\n            AddDownloadButton();\n        }\n\n        void AddDownloadButton()\n        {\n            if (checkBox1.Checked)\n            {\n                Program.config.DownloadPath = textBox1.Text;\n                Program.config.save();\n            }\n            if (!Directory.Exists(textBox1.Text))\n            {\n                MessageBox.Show("\xe4\xb8\x8b\xe8\xbd\xbd\xe8\xb7\xaf\xe5\xbe\x84\xe4\xb8\x8d\xe5\xad\x98\xe5\x9c\xa8!");\n                this.button2.Enabled = true;\n                this.button2.Text = "\xe6\xb7\xbb\xe5\x8a\xa0\xe4\xb8\x8b\xe8\xbd\xbd";\n                return;\n            }\n            if (info.size <= Program.config.NetSpeed && info.isdir!=1)\n            {\n                MessageBox.Show("\xe6\x96\x87\xe4\xbb\xb6\xe5\xa4\xaa\xe5\xb0\x8f,\xe6\x97\xa0\xe6\xb3\x95\xe4\xb8\x8b\xe8\xbd\xbd!");\n                this.button2.Enabled = true;\n                this.button2.Text = "\xe6\xb7\xbb\xe5\x8a\xa0\xe4\xb8\x8b\xe8\xbd\xbd";\n                return;\n            }\n            if (info.isdir == 1)\n            {\n                foreach (DiskFileInfo dfi in info.getFileList())\n                {\n                    string downloadPath = (textBox1.Text + dfi.path.Replace(dfi.getName(), string.Empty).Replace("/apps/wp2pcs", string.Empty).Replace("/", "\\\\"));\n                    downloadPath = downloadPath.Substring(0, downloadPath.Length-1);\n                    if (!Directory.Exists(downloadPath))\n                    {\n                        Directory.CreateDirectory(downloadPath);\n                    }\n                    main.AddDownloadFile(dfi, downloadPath, dfi.getName());\n                }\n                this.Close();\n                return;\n            }\n            main.AddDownloadFile(info, textBox1.Text, info.getName());\n            this.Close();\n        }\n    }\n}\n'