b'package com.codeest.geeknews.component;\r\n\r\nimport android.content.Context;\r\nimport android.content.pm.PackageInfo;\r\nimport android.content.pm.PackageManager;\r\n\r\nimport com.codeest.geeknews.app.App;\r\nimport com.codeest.geeknews.util.LogUtil;\r\nimport com.codeest.geeknews.util.ToastUtil;\r\n\r\nimport java.io.PrintWriter;\r\nimport java.io.StringWriter;\r\nimport java.io.Writer;\r\n\r\n/**\r\n * Created by codeest on 2016/8/3.\r\n */\r\npublic class CrashHandler implements Thread.UncaughtExceptionHandler {\r\n\r\n    private static Thread.UncaughtExceptionHandler defaultHandler = null;\r\n\r\n    private Context context = null;\r\n\r\n    private final String TAG = CrashHandler.class.getSimpleName();\r\n\r\n    public CrashHandler(Context context) {\r\n        this.context = context;\r\n    }\r\n\r\n    /**\r\n     * \xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96,\xe8\xae\xbe\xe7\xbd\xae\xe8\xaf\xa5CrashHandler\xe4\xb8\xba\xe7\xa8\x8b\xe5\xba\x8f\xe7\x9a\x84\xe9\xbb\x98\xe8\xae\xa4\xe5\xa4\x84\xe7\x90\x86\xe5\x99\xa8\r\n     */\r\n    public static void init(CrashHandler crashHandler) {\r\n        defaultHandler = Thread.getDefaultUncaughtExceptionHandler();\r\n        Thread.setDefaultUncaughtExceptionHandler(crashHandler);\r\n    }\r\n\r\n    @Override\r\n    public void uncaughtException(Thread thread, Throwable ex) {\r\n        System.out.println(ex.toString());\r\n        LogUtil.e(TAG, ex.toString());\r\n        LogUtil.e(TAG, collectCrashDeviceInfo());\r\n        LogUtil.e(TAG, getCrashInfo(ex));\r\n        // \xe8\xb0\x83\xe7\x94\xa8\xe7\xb3\xbb\xe7\xbb\x9f\xe9\x94\x99\xe8\xaf\xaf\xe6\x9c\xba\xe5\x88\xb6\r\n        defaultHandler.uncaughtException(thread, ex);\r\n        ToastUtil.shortShow("\xe6\x8a\xb1\xe6\xad\x89,\xe7\xa8\x8b\xe5\xba\x8f\xe5\x8f\x91\xe7\x94\x9f\xe5\xbc\x82\xe5\xb8\xb8\xe5\x8d\xb3\xe5\xb0\x86\xe9\x80\x80\xe5\x87\xba");\r\n        App.getInstance().exitApp();\r\n    }\r\n\r\n    /**\r\n     * \xe5\xbe\x97\xe5\x88\xb0\xe7\xa8\x8b\xe5\xba\x8f\xe5\xb4\xa9\xe6\xba\x83\xe7\x9a\x84\xe8\xaf\xa6\xe7\xbb\x86\xe4\xbf\xa1\xe6\x81\xaf\r\n     */\r\n    public String getCrashInfo(Throwable ex) {\r\n        Writer result = new StringWriter();\r\n        PrintWriter printWriter = new PrintWriter(result);\r\n        ex.setStackTrace(ex.getStackTrace());\r\n        ex.printStackTrace(printWriter);\r\n        return result.toString();\r\n    }\r\n\r\n    /**\r\n     * \xe6\x94\xb6\xe9\x9b\x86\xe7\xa8\x8b\xe5\xba\x8f\xe5\xb4\xa9\xe6\xba\x83\xe7\x9a\x84\xe8\xae\xbe\xe5\xa4\x87\xe4\xbf\xa1\xe6\x81\xaf\r\n     */\r\n    public String collectCrashDeviceInfo() {\r\n        try {\r\n            PackageManager pm = context.getPackageManager();\r\n            PackageInfo pi = pm.getPackageInfo(context.getPackageName(), PackageManager.GET_ACTIVITIES);\r\n            String versionName = pi.versionName;\r\n            String model = android.os.Build.MODEL;\r\n            String androidVersion = android.os.Build.VERSION.RELEASE;\r\n            String manufacturer = android.os.Build.MANUFACTURER;\r\n            return versionName + "  " + model + "  " + androidVersion + "  " + manufacturer;\r\n        } catch (PackageManager.NameNotFoundException e) {\r\n            e.printStackTrace();\r\n        }\r\n        return null;\r\n    }\r\n}\r\n'