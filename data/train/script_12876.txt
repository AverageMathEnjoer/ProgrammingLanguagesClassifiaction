b'package com.codeest.geeknews.ui.gank.fragment;\n\nimport android.support.design.widget.AppBarLayout;\nimport android.support.v4.widget.SwipeRefreshLayout;\nimport android.support.v7.widget.LinearLayoutManager;\nimport android.support.v7.widget.RecyclerView;\nimport android.view.View;\nimport android.widget.ImageView;\nimport android.widget.TextView;\n\nimport com.bumptech.glide.Glide;\nimport com.codeest.geeknews.R;\nimport com.codeest.geeknews.app.Constants;\nimport com.codeest.geeknews.base.RootFragment;\nimport com.codeest.geeknews.component.ImageLoader;\nimport com.codeest.geeknews.model.bean.GankItemBean;\nimport com.codeest.geeknews.presenter.gank.TechPresenter;\nimport com.codeest.geeknews.base.contract.gank.TechContract;\nimport com.codeest.geeknews.ui.gank.activity.TechDetailActivity;\nimport com.codeest.geeknews.ui.gank.adapter.TechAdapter;\nimport com.codeest.geeknews.util.SystemUtil;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\nimport butterknife.BindView;\nimport jp.wasabeef.glide.transformations.BlurTransformation;\n\n/**\n * Created by codeest on 16/8/19.\n */\n\npublic class TechFragment extends RootFragment<TechPresenter> implements TechContract.View {\n\n    @BindView(R.id.view_main)\n    RecyclerView rvTechContent;\n    @BindView(R.id.swipe_refresh)\n    SwipeRefreshLayout swipeRefresh;\n    @BindView(R.id.iv_tech_blur)\n    ImageView ivBlur;\n    @BindView(R.id.iv_tech_origin)\n    ImageView ivOrigin;\n    @BindView(R.id.tv_tech_copyright)\n    TextView tvCopyright;\n    @BindView(R.id.tech_appbar)\n    AppBarLayout appbar;\n\n    List<GankItemBean> mList;\n    TechAdapter mAdapter;\n\n    boolean isLoadingMore = false;\n    String tech;\n    int type;\n\n    @Override\n    protected void initInject() {\n        getFragmentComponent().inject(this);\n    }\n\n    @Override\n    protected int getLayoutId() {\n        return R.layout.fragment_tech;\n    }\n\n    @Override\n    protected void initEventAndData() {\n        super.initEventAndData();\n        mPresenter.getGirlImage();\n        mList = new ArrayList<>();\n        tech = getArguments().getString(Constants.IT_GANK_TYPE);\n        type = getArguments().getInt(Constants.IT_GANK_TYPE_CODE);\n        mAdapter = new TechAdapter(mContext,mList,tech);\n        rvTechContent.setLayoutManager(new LinearLayoutManager(mContext));\n        rvTechContent.setAdapter(mAdapter);\n        stateLoading();\n        mPresenter.getGankData(tech, type);\n        mAdapter.setOnItemClickListener(new TechAdapter.OnItemClickListener() {\n            @Override\n            public void onItemClick(int position, View shareView) {\n                TechDetailActivity.launch(new TechDetailActivity.Builder()\n                        .setContext(mContext)\n                        .setId(mList.get(position).get_id())\n                        .setTitle(mList.get(position).getDesc())\n                        .setUrl(mList.get(position).getUrl())\n                        .setType(type)\n                .setAnimConfig(mActivity, shareView));\n            }\n        });\n        rvTechContent.addOnScrollListener(new RecyclerView.OnScrollListener() {\n            @Override\n            public void onScrolled(RecyclerView recyclerView, int dx, int dy) {\n                super.onScrolled(recyclerView, dx, dy);\n                int lastVisibleItem = ((LinearLayoutManager) rvTechContent.getLayoutManager()).findLastVisibleItemPosition();\n                int totalItemCount = rvTechContent.getLayoutManager().getItemCount();\n                if (lastVisibleItem >= totalItemCount - 2 && dy > 0) {  //\xe8\xbf\x98\xe5\x89\xa92\xe4\xb8\xaaItem\xe6\x97\xb6\xe5\x8a\xa0\xe8\xbd\xbd\xe6\x9b\xb4\xe5\xa4\x9a\n                    if(!isLoadingMore){\n                        isLoadingMore = true;\n                        mPresenter.getMoreGankData(tech);\n                    }\n                }\n            }\n        });\n        appbar.addOnOffsetChangedListener(new AppBarLayout.OnOffsetChangedListener() {\n            @Override\n            public void onOffsetChanged(AppBarLayout appBarLayout, int verticalOffset) {\n                if (verticalOffset >= 0) {\n                    swipeRefresh.setEnabled(true);\n                } else {\n                    swipeRefresh.setEnabled(false);\n                    float rate = (float)(SystemUtil.dp2px(mContext, 256) + verticalOffset * 2) / SystemUtil.dp2px(mContext, 256);\n                    if (rate >= 0)\n                    ivOrigin.setAlpha(rate);\n                }\n            }\n        });\n        swipeRefresh.setOnRefreshListener(new SwipeRefreshLayout.OnRefreshListener() {\n            @Override\n            public void onRefresh() {\n                mPresenter.getGankData(tech, type);\n            }\n        });\n    }\n\n    @Override\n    public void stateError() {\n        super.stateError();\n        if(swipeRefresh.isRefreshing()) {\n            swipeRefresh.setRefreshing(false);\n        }\n    }\n\n    @Override\n    public void showContent(List<GankItemBean> list) {\n        if(swipeRefresh.isRefreshing()) {\n            swipeRefresh.setRefreshing(false);\n        }\n        stateMain();\n        mList.clear();\n        mList.addAll(list);\n        mAdapter.notifyDataSetChanged();\n    }\n\n    @Override\n    public void showMoreContent(List<GankItemBean> list) {\n        stateMain();\n        mList.addAll(list);\n        mAdapter.notifyDataSetChanged();\n        isLoadingMore = false;\n    }\n\n    @Override\n    public void showGirlImage(String url, String copyright) {\n        ImageLoader.load(mContext, url, ivOrigin);\n        Glide.with(mContext).load(url).bitmapTransform(new BlurTransformation(mContext)).into(ivBlur);\n        tvCopyright.setText(String.format("by: %s",copyright));\n    }\n}\n'