b'package com.zzg.mybatis.generator.view;\n\nimport com.zzg.mybatis.generator.model.DatabaseConfig;\nimport javafx.beans.InvalidationListener;\nimport javafx.beans.Observable;\nimport javafx.beans.WeakInvalidationListener;\nimport javafx.scene.control.TreeCell;\nimport javafx.scene.control.TreeItem;\nimport javafx.scene.layout.HBox;\n\nimport java.lang.ref.WeakReference;\n\n/**\n * Created by Owen on 6/14/16.\n */\npublic class LeftDbTreeCell extends TreeCell<DatabaseConfig> {\n    private HBox hbox;\n\n    private WeakReference<TreeItem<DatabaseConfig>> treeItemRef;\n\n    private InvalidationListener treeItemGraphicListener = observable -> {\n        updateDisplay(getItem(), isEmpty());\n    };\n\n    private InvalidationListener treeItemListener = new InvalidationListener() {\n        @Override\n        public void invalidated(Observable observable) {\n            TreeItem<DatabaseConfig> oldTreeItem = treeItemRef == null ? null : treeItemRef.get();\n            if (oldTreeItem != null) {\n                oldTreeItem.graphicProperty().removeListener(weakTreeItemGraphicListener);\n            }\n\n            TreeItem<DatabaseConfig> newTreeItem = getTreeItem();\n            if (newTreeItem != null) {\n                newTreeItem.graphicProperty().addListener(weakTreeItemGraphicListener);\n                treeItemRef = new WeakReference<TreeItem<DatabaseConfig>>(newTreeItem);\n            }\n        }\n    };\n\n    private WeakInvalidationListener weakTreeItemGraphicListener =\n            new WeakInvalidationListener(treeItemGraphicListener);\n\n    private WeakInvalidationListener weakTreeItemListener =\n            new WeakInvalidationListener(treeItemListener);\n\n    public LeftDbTreeCell() {\n        treeItemProperty().addListener(weakTreeItemListener);\n\n        if (getTreeItem() != null) {\n            getTreeItem().graphicProperty().addListener(weakTreeItemGraphicListener);\n        }\n    }\n\n    void updateDisplay(DatabaseConfig item, boolean empty) {\n        if (item == null || empty) {\n            hbox = null;\n            setText(null);\n            setGraphic(null);\n        } else {\n            // update the graphic if one is set in the TreeItem\n            TreeItem<DatabaseConfig> treeItem = getTreeItem();\n            if (treeItem != null && treeItem.getGraphic() != null) {\n                hbox = null;\n                setText(item.toString());\n                setGraphic(treeItem.getGraphic());\n            } else {\n                hbox = null;\n                setText(item.getName());\n                setGraphic(null);\n            }\n        }\n    }\n\n    @Override\n    public void updateItem(DatabaseConfig item, boolean empty) {\n        super.updateItem(item, empty);\n        updateDisplay(item, empty);\n    }\n}\n'