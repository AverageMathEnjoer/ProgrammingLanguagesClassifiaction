b'/*Copyright \xc2\xa9  2017 Lyons. All rights reserved. */\npackage lyons.common.controller.user;\n\nimport javax.servlet.http.HttpServletRequest;\n\nimport org.apache.shiro.authc.DisabledAccountException;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Controller;\nimport org.springframework.ui.Model;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestMethod;\nimport org.springframework.web.bind.annotation.ResponseBody;\n\nimport lyons.common.controller.BaseController;\nimport lyons.common.exception.user.NullValueException;\nimport lyons.common.exception.user.RepeatException;\nimport lyons.common.model.user.UUser;\nimport lyons.common.service.goods.GoodsService;\nimport lyons.common.utils.ResultUtil;\nimport lyons.common.utils.VisitorUtil;\nimport lyons.common.utils.enums.AccountStaEnum;\nimport lyons.core.shiro.token.TokenManager;\n\n/**\n * @Description: \xe6\xb3\xa8\xe5\x86\x8c\xe3\x80\x81\xe7\x99\xbb\xe5\xbd\x95\xe3\x80\x81\xe9\x80\x80\xe5\x87\xba\n * @ClassName: LoginController\n * @author: lyons<zhanglei>\n * @date: 2017\xe5\xb9\xb41\xe6\x9c\x885\xe6\x97\xa5 \xe4\xb8\x8b\xe5\x8d\x888:25:47\n * @version: [1.0]\n */\n@Controller\npublic class LoginController extends BaseController\n{\n    private static Logger log = LoggerFactory.getLogger(LoginController.class);\n    \n    @Autowired\n    private GoodsService goodsService;\n    \n/*    @RequestMapping(value = "/")\n    public String requestAll() \n    {\n        log.info("\\n\\n / ==> \xe9\x87\x8d\xe5\xae\x9a\xe5\x90\x91\xe8\x87\xb3\xe9\xa6\x96\xe9\xa1\xb5 \\n");\n        \n        return "redirect:/index";\n    }*/\n    \n    @RequestMapping(value="/index")\n    public void index(Model model)\n    {\n        log.info("\\n\\n /index ==> \xe8\xb7\xb3\xe8\xbd\xac\xe5\x88\xb0\xe9\xa6\x96\xe9\xa1\xb5 \\n");\n        \n        model.addAttribute("goodsList", goodsService.findAllGoods());\n    }\n    \n    @RequestMapping("/login")\n    public String loginGet()\n    {\n        log.info("\\n\\n /login ==> GET \xe8\xaf\xb7\xe6\xb1\x82\xe7\x99\xbb\xe5\xbd\x95 \\n");\n        \n        return "admin/login";\n    }\n    \n    /**\n     * \n     * @Title: loginPost\n     * @Description: \xe7\x99\xbb\xe5\xbd\x95\n     * @param uuser\n     * @param rememberMe\n     * @param request\n     * @return: Map<String,Object>\n     */\n    @RequestMapping(value="/admin/login", method = RequestMethod.POST,\n        produces = {"application/json;charset=UTF-8"})\n    @ResponseBody\n    public String loginPost(UUser uuser,HttpServletRequest request)\n    {\n        \n        try\n        {\n             TokenManager.login(uuser);\n            \n            log.info("\\n\\n "+VisitorUtil.getIpAddress(request)+" *====\xe7\x99\xbb\xe5\xbd\x95\xe6\x88\x90\xe5\x8a\x9f====* \\n");\n            return ResultUtil.getUrlJson(request);\n        }catch(NullValueException e){\n            log.error("\\n\\n ==> \xe8\xaf\xb7\xe6\xb1\x82\xe7\xa9\xba\xe5\x80\xbc:"+e+" <==\\n"); \n            return  ResultUtil.getJson(e.getMessage());\n        }catch(RepeatException e){\n            log.error("\\n\\n ==> \xe9\x87\x8d\xe5\xa4\x8d\xe7\x99\xbb\xe5\xbd\x95:"+e+" <==\\n"); \n            return ResultUtil.getJson(e.getMessage());\n        }catch (DisabledAccountException e)\n        {\n            log.info("\\n\\n ==> \xe8\xb4\xa6\xe5\x8f\xb7\xe6\x9c\xaa\xe5\x90\xaf\xe7\x94\xa8 <== \\n");\n            return  ResultUtil.getJson(AccountStaEnum.disabled.getInfo());\n        }catch (Exception e) {\n           log.error("\\n\\n ==> \xe8\xb4\xa6\xe5\x8f\xb7\xe6\x88\x96\xe5\xaf\x86\xe7\xa0\x81\xe9\x94\x99\xe8\xaf\xaf:"+e+" <==\\n"); \n           return ResultUtil.getJson(AccountStaEnum.failed.getInfo());\n        }\n        \n    }\n    \n    /**\n     * @Title: logout\n     * @Description: \xe7\x94\xa8\xe6\x88\xb7\xe9\x80\x80\xe5\x87\xba\n     * @return: String\n     */\n    @RequestMapping("/admin/logout")\n    public String logout()\n    {\n            try\n            {\n                TokenManager.logout();\n                log.info("\\n\\n ==> \xe8\xb4\xa6\xe5\x8f\xb7\xe9\x80\x80\xe5\x87\xba\xe6\x88\x90\xe5\x8a\x9f <== \\n");\n            } catch (Exception e)\n            {\n                log.error("\\n\\n ==> \xe9\x80\x80\xe5\x87\xba\xe9\x94\x99\xe8\xaf\xaf:"+e+" <== \\n");\n            }\n        return "admin/login";\n    }\n\n    \n    \n    \n}\n'