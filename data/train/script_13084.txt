b'package lyons.control;\n\nimport java.io.IOException;\nimport java.sql.Connection;\nimport java.sql.PreparedStatement;\nimport java.sql.SQLException;\n\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\n\nimport lyons.db.DbClose;\nimport lyons.db.DbConn;\nimport lyons.entity.Register;\n\n\n/**\n * \xd7\xa2\xb2\xe1\xb4\xa6\xc0\xed\n * @author Lyons(zhanglei)\n *\n */\n\npublic class HandleRegister extends HttpServlet\n{\n\tprivate static final long serialVersionUID = 1L;\n\t/**\n\t * Constructor of the object.\n\t */\n\tpublic HandleRegister()\n\t{\n\t\tsuper();\n\t}\n\n\t/**\n\t * Destruction of the servlet. <br>\n\t */\n\tpublic void destroy()\n\t{\n\t\tsuper.destroy(); // Just puts "destroy" string in log\n\t\t// Put your code here\n\t}\n\n\n\tpublic void doGet(HttpServletRequest request, HttpServletResponse response)\n\t\t\tthrows ServletException, IOException\n\t{\n\t\tdoPost(request, response);\n\t}\n\n\tpublic void doPost(HttpServletRequest request, HttpServletResponse response)\n\t\t\tthrows ServletException, IOException\n\t{\n\n\t\tresponse.setContentType("text/html;charset=UTF-8");\n\t\trequest.setCharacterEncoding("UTF-8");\n\t\t\n\t\tRegister userBean = new Register();\n\t\trequest.setAttribute("userBean", userBean);\n\t\t\n\t\tString username = "";\n\t\tString userpass = "";\n\t\tString again_userpass = "";\n\t\tString phone = "";\n\t\tString address = "";\n\t\tString realname = "";\n\t\t\n\t\tusername = request.getParameter("username").trim();\n\t\tuserpass = request.getParameter("userpass").trim();\n\t\tagain_userpass = request.getParameter("again_userpass").trim();\n\t\tphone = request.getParameter("phone").trim();\n\t\taddress = request.getParameter("address").trim();\n\t\trealname = request.getParameter("realname").trim();\n\t\t\n\t\tif (username==null)\n\t\t{\n\t\t\tusername = "";\n\t\t}\n\t\tif (userpass==""|userpass==null)\n\t\t{\n\t\t\tuserpass = "error";\n\t\t}\n\n\t\tString regex = "[\\\\d]{11}";\n\t\tif (!(again_userpass.equals(userpass)))\n\t\t{\n\t\t\tuserBean.setBackNews("\xc1\xbd\xb4\xce\xc3\xdc\xc2\xeb\xb2\xbb\xd2\xbb\xd6\xc2,\xd7\xa2\xb2\xe1\xca\xa7\xb0\xdc");\n\t\t\trequest.getRequestDispatcher("/jsp/join/register.jsp").forward(request, response);\n\t\t}else if (phone!=null&&phone.length()>0&&!phone.matches(regex)) \n\t\t\t\t{\n\t\t\t\t\t\tuserBean.setBackNews("\xc7\xeb\xd5\xfd\xc8\xb7\xcc\xee\xd0\xb411\xce\xbb\xca\xd6\xbb\xfa\xba\xc5");\n\t\t\t\t\t\trequest.getRequestDispatcher("/jsp/join/register.jsp").forward(request, response);\n\t\t\t\t\t\treturn;\n\t\t\t\t}else \n\t\t\t\t\t{\n\t\t\t\t\t\tString backNews = ""; \n//\t\t\t\t\t\tString regex = "[\\\\w]{4,16}";\n//\t\t\t\t\t\tboolean userFlag = username.matches(regex) && userpass.length()>5;\n\t\t\t\t\t\tboolean userFlag = userpass.length()>5;\n\t\t\t\t\t\tif (userFlag)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tConnection        conn  = null;\n\t\t\t\t\t\t\tPreparedStatement pstmt = null;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tconn = DbConn.getConn();\n\t\t\t\t\t\t\tString sql = "INSERT INTO vip(username,userpass,phone,address,realname) VALUES(?,?,?,?,?)";\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\ttry\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tpstmt = conn.prepareStatement(sql);\n\t\t\t\t\t\t\t\tpstmt.setString(1,username);\n\t\t\t\t\t\t\t\tpstmt.setString(2,userpass); \n\t\t\t\t\t\t\t\tpstmt.setString(3,phone);\n\t\t\t\t\t\t\t\tpstmt.setString(4,address);\n\t\t\t\t\t\t\t\tpstmt.setString(5,realname);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tint rs = pstmt.executeUpdate();\n\t\t\t\t\t\t\t\tif (rs > 0)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbackNews = "\xd7\xa2\xb2\xe1\xb3\xc9\xb9\xa6";\n\t\t\t\t\t\t\t\t\tuserBean.setBackNews(backNews);\n\t\t\t\t\t\t\t\t\trequest.getRequestDispatcher("/jsp/join/registerSuccess.jsp").forward(request, response);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} catch (SQLException e)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t    System.out.println(e);\n\t\t\t\t\t\t\t\tbackNews = "\xb8\xc3\xd3\xc3\xbb\xa7\xc3\xfb\xd2\xd1\xb1\xbb\xd7\xa2\xb2\xe1"+"<br>";\n\t\t\t\t\t\t\t\tuserBean.setBackNews(backNews);\n\t\t\t\t\t\t\t\trequest.getRequestDispatcher("/jsp/join/register.jsp").forward(request, response);\n\t\t\t\t\t\t\t}finally\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tDbClose.close(pstmt, conn);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}else \n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuserBean.setBackNews("\xc3\xdc\xc2\xeb\xb2\xbb\xba\xcf\xb7\xa8");\n\t\t\t\t\t\t\trequest.getRequestDispatcher("/jsp/join/register.jsp").forward(request, response);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t}\n\n\tpublic void init() throws ServletException\n\t{\n\t}\n\n}\n'