b'package io.github.javiewer.fragment;\n\n\nimport android.os.Bundle;\nimport androidx.annotation.Nullable;\nimport androidx.swiperefreshlayout.widget.SwipeRefreshLayout;\nimport androidx.recyclerview.widget.LinearLayoutManager;\nimport androidx.recyclerview.widget.RecyclerView;\n\nimport java.util.List;\n\nimport io.github.javiewer.adapter.DownloadLinkAdapter;\nimport io.github.javiewer.adapter.item.DownloadLink;\nimport io.github.javiewer.network.provider.DownloadLinkProvider;\nimport io.github.javiewer.view.decoration.DownloadItemDecoration;\nimport io.github.javiewer.view.listener.BasicOnScrollListener;\nimport jp.wasabeef.recyclerview.adapters.ScaleInAnimationAdapter;\nimport jp.wasabeef.recyclerview.animators.SlideInUpAnimator;\nimport okhttp3.ResponseBody;\nimport retrofit2.Call;\n\npublic class DownloadFragment extends RecyclerFragment<DownloadLink, LinearLayoutManager> {\n\n    public DownloadLinkProvider provider;\n\n    public String keyword;\n\n    public DownloadFragment() {\n        // Required empty public constructor\n    }\n\n    @Override\n    public void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        Bundle bundle = getArguments();\n        this.provider = DownloadLinkProvider.getProvider(bundle.getString("provider"));\n        this.keyword = bundle.getString("keyword");\n    }\n\n    @Override\n    public void onActivityCreated(@Nullable Bundle savedInstanceState) {\n        /*if (JAViewer.CONFIGURATIONS.showAds()) {\n            mAdView.setVisibility(View.VISIBLE);\n            AdRequest adRequest = new AdRequest.Builder()\n                    .addTestDevice("52546C5153814CA9A9714647F5960AFE")\n                    .build();\n            mAdView.loadAd(adRequest);\n        }*/\n\n        this.setLayoutManager(new LinearLayoutManager(this.getContext()));\n        this.setAdapter(new ScaleInAnimationAdapter(new DownloadLinkAdapter(this.getItems(), this.getActivity(), this.provider)));\n        mRecyclerView.addItemDecoration(new DownloadItemDecoration());\n\n        RecyclerView.ItemAnimator animator = new SlideInUpAnimator();\n        animator.setAddDuration(300);\n        mRecyclerView.setItemAnimator(animator);\n\n        this.setOnRefreshListener(new SwipeRefreshLayout.OnRefreshListener() {\n            @Override\n            public void onRefresh() {\n                getOnScrollListener().refresh();\n            }\n        });\n\n        this.addOnScrollListener(new BasicOnScrollListener<DownloadLink>() {\n            @Override\n            public Call<ResponseBody> newCall(int page) {\n                return DownloadFragment.this.newCall(page);\n            }\n\n            @Override\n            public RecyclerView.LayoutManager getLayoutManager() {\n                return DownloadFragment.this.getLayoutManager();\n            }\n\n            @Override\n            public SwipeRefreshLayout getRefreshLayout() {\n                return DownloadFragment.this.mRefreshLayout;\n            }\n\n            @Override\n            public RecyclerView.Adapter getAdapter() {\n                return DownloadFragment.this.getAdapter();\n            }\n\n            @Override\n            public List<DownloadLink> getItems() {\n                return DownloadFragment.this.getItems();\n            }\n\n            @Override\n            public void onResult(ResponseBody response) throws Exception {\n                super.onResult(response);\n                List<DownloadLink> downloads = provider.parseDownloadLinks(response.string());\n\n                int pos = getItems().size();\n\n                if (downloads.isEmpty()) {\n                    setEnd(true);\n                } else {\n                    getItems().addAll(downloads);\n                    getAdapter().notifyItemRangeInserted(pos, downloads.size());\n                }\n            }\n        });\n\n        mRefreshLayout.post(new Runnable() {\n            @Override\n            public void run() {\n                mRefreshLayout.setRefreshing(true);\n                getOnRefreshListener().onRefresh();\n            }\n        });\n\n        super.onActivityCreated(savedInstanceState);\n    }\n\n    public Call<ResponseBody> newCall(int page) {\n        return this.provider.search(this.keyword, page);\n    }\n}\n'